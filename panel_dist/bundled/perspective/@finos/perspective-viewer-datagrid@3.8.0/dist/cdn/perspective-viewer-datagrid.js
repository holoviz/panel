var mo=Object.create;var mr=Object.defineProperty;var bo=Object.getOwnPropertyDescriptor;var yo=Object.getOwnPropertyNames;var vo=Object.getPrototypeOf,wo=Object.prototype.hasOwnProperty;var xo=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ko=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of yo(t))!wo.call(e,s)&&s!==o&&mr(e,s,{get:()=>t[s],enumerable:!(n=bo(t,s))||n.enumerable});return e};var Lt=(e,t,o)=>(o=e!=null?mo(vo(e)):{},ko(t||!e||!e.__esModule?mr(o,"default",{value:e,enumerable:!0}):o,e));var ft=xo((_t,ht)=>{(function(){var e,t,o,n,s,d,f,p,m,w,g,E,C,A,S,P,R,B,j,y,ne,I,Ee,q,U,F,le,K,ae,de,oe,ie,we,Ne,fe,me,Re,Te,De,Be,Le,ze,He,$e,be,ye,Jt,bt,je,yt,Zt,V,Qt,er,tr,rr,he,or,sr,ir,lr,nr,ar,cr,Pt,Wt,Ft,dr,_r,hr,vt,wt,fr,xe,ur,Ve,Me,Ut,re,se,Ie,xt,kt,Oe=[].slice;re=function(){var r,i,l,a,c;for(r={},c="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),a=0,i=c.length;a<i;a++)l=c[a],r["[object "+l+"]"]=l.toLowerCase();return function(_){var h;return h=Object.prototype.toString.call(_),r[h]||"object"}}(),bt=function(r,i,l){return i==null&&(i=0),l==null&&(l=1),r<i&&(r=i),r>l&&(r=l),r},se=function(r){return r.length>=3?Array.prototype.slice.call(r):r[0]},ne=function(r){var i,l;for(r._clipped=!1,r._unclipped=r.slice(0),i=l=0;l<3;i=++l)i<3?((r[i]<0||r[i]>255)&&(r._clipped=!0),r[i]<0&&(r[i]=0),r[i]>255&&(r[i]=255)):i===3&&(r[i]<0&&(r[i]=0),r[i]>1&&(r[i]=1));return r._clipped||delete r._unclipped,r},n=Math.PI,xe=Math.round,q=Math.cos,ae=Math.floor,he=Math.pow,je=Math.log,Ve=Math.sin,Me=Math.sqrt,A=Math.atan2,V=Math.max,C=Math.abs,f=n*2,s=n/3,t=n/180,d=180/n,y=function(){return arguments[0]instanceof e?arguments[0]:function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,arguments,function(){})},y.default=y,E=[],typeof ht<"u"&&ht!==null&&ht.exports!=null&&(ht.exports=y),typeof define=="function"&&define.amd?define([],function(){return y}):(fr=typeof _t<"u"&&_t!==null?_t:this,fr.chroma=y),y.version="1.4.1",g={},m=[],w=!1,e=function(){function r(){var i,l,a,c,_,h,u,b,x;for(h=this,l=[],b=0,c=arguments.length;b<c;b++)i=arguments[b],i!=null&&l.push(i);if(l.length>1&&(u=l[l.length-1]),g[u]!=null)h._rgb=ne(g[u](se(l.slice(0,-1))));else{for(w||(m=m.sort(function(L,T){return T.p-L.p}),w=!0),x=0,_=m.length;x<_&&(a=m[x],u=a.test.apply(a,l),!u);x++);u&&(h._rgb=ne(g[u].apply(g,l)))}h._rgb==null&&console.warn("unknown format: "+l),h._rgb==null&&(h._rgb=[0,0,0]),h._rgb.length===3&&h._rgb.push(1)}return r.prototype.toString=function(){return this.hex()},r}(),y._input=g;y.brewer=B={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var r,i;i=[];for(r in B)i.push(B[r.toLowerCase()]=B[r]);return i}(),Ie={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},y.colors=Ee=Ie,He=function(){var r,i,l,a,c,_,h,u,b;return i=se(arguments),c=i[0],r=i[1],l=i[2],u=(c+16)/116,h=isNaN(r)?u:u+r/500,b=isNaN(l)?u:u-l/200,u=o.Yn*$e(u),h=o.Xn*$e(h),b=o.Zn*$e(b),_=kt(3.2404542*h-1.5371385*u-.4985314*b),a=kt(-.969266*h+1.8760108*u+.041556*b),l=kt(.0556434*h-.2040259*u+1.0572252*b),[_,a,l,i.length>3?i[3]:1]},kt=function(r){return 255*(r<=.00304?12.92*r:1.055*he(r,1/2.4)-.055)},$e=function(r){return r>o.t1?r*r*r:o.t2*(r-o.t0)},o={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Pt=function(){var r,i,l,a,c,_,h,u;return a=se(arguments),l=a[0],i=a[1],r=a[2],c=hr(l,i,r),_=c[0],h=c[1],u=c[2],[116*h-16,500*(_-h),200*(h-u)]},vt=function(r){return(r/=255)<=.04045?r/12.92:he((r+.055)/1.055,2.4)},xt=function(r){return r>o.t3?he(r,1/3):r/o.t2+o.t0},hr=function(){var r,i,l,a,c,_,h;return a=se(arguments),l=a[0],i=a[1],r=a[2],l=vt(l),i=vt(i),r=vt(r),c=xt((.4124564*l+.3575761*i+.1804375*r)/o.Xn),_=xt((.2126729*l+.7151522*i+.072175*r)/o.Yn),h=xt((.0193339*l+.119192*i+.9503041*r)/o.Zn),[c,_,h]},y.lab=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["lab"]),function(){})},g.lab=He,e.prototype.lab=function(){return Pt(this._rgb)},S=function(r){var i,l,a,c,_,h,u,b,x,L,T;return r=function(){var M,k,z;for(z=[],k=0,M=r.length;k<M;k++)c=r[k],z.push(y(c));return z}(),r.length===2?(x=function(){var M,k,z;for(z=[],k=0,M=r.length;k<M;k++)c=r[k],z.push(c.lab());return z}(),_=x[0],h=x[1],i=function(M){var k,z;return z=function(){var N,W;for(W=[],k=N=0;N<=2;k=++N)W.push(_[k]+M*(h[k]-_[k]));return W}(),y.lab.apply(y,z)}):r.length===3?(L=function(){var M,k,z;for(z=[],k=0,M=r.length;k<M;k++)c=r[k],z.push(c.lab());return z}(),_=L[0],h=L[1],u=L[2],i=function(M){var k,z;return z=function(){var N,W;for(W=[],k=N=0;N<=2;k=++N)W.push((1-M)*(1-M)*_[k]+2*(1-M)*M*h[k]+M*M*u[k]);return W}(),y.lab.apply(y,z)}):r.length===4?(T=function(){var M,k,z;for(z=[],k=0,M=r.length;k<M;k++)c=r[k],z.push(c.lab());return z}(),_=T[0],h=T[1],u=T[2],b=T[3],i=function(M){var k,z;return z=function(){var N,W;for(W=[],k=N=0;N<=2;k=++N)W.push((1-M)*(1-M)*(1-M)*_[k]+3*(1-M)*(1-M)*M*h[k]+3*(1-M)*M*M*u[k]+M*M*M*b[k]);return W}(),y.lab.apply(y,z)}):r.length===5&&(l=S(r.slice(0,3)),a=S(r.slice(2,5)),i=function(M){return M<.5?l(M*2):a((M-.5)*2)}),i},y.bezier=function(r){var i;return i=S(r),i.scale=function(){return y.scale(i)},i},y.cubehelix=function(r,i,l,a,c){var _,h,u;return r==null&&(r=300),i==null&&(i=-1.5),l==null&&(l=1),a==null&&(a=1),c==null&&(c=[0,1]),_=0,re(c)==="array"?h=c[1]-c[0]:(h=0,c=[c,c]),u=function(b){var x,L,T,M,k,z,N,W,Z;return x=f*((r+120)/360+i*b),N=he(c[0]+h*b,a),z=_!==0?l[0]+b*_:l,L=z*N*(1-N)/2,M=q(x),Z=Ve(x),W=N+L*(-.14861*M+1.78277*Z),k=N+L*(-.29227*M-.90649*Z),T=N+L*(1.97294*M),y(ne([W*255,k*255,T*255,1]))},u.start=function(b){return b==null?r:(r=b,u)},u.rotations=function(b){return b==null?i:(i=b,u)},u.gamma=function(b){return b==null?a:(a=b,u)},u.hue=function(b){return b==null?l:(l=b,re(l)==="array"?(_=l[1]-l[0],_===0&&(l=l[1])):_=0,u)},u.lightness=function(b){return b==null?c:(re(b)==="array"?(c=b,h=b[1]-b[0]):(c=[b,b],h=0),u)},u.scale=function(){return y.scale(u)},u.hue(l),u},y.random=function(){var r,i,l,a;for(i="0123456789abcdef",r="#",l=a=0;a<6;l=++a)r+=i.charAt(ae(Math.random()*16));return new e(r)},E=[],me=function(r,i,l,a){var c,_,h,u;for(l==null&&(l=.5),a==null&&(a="rgb"),re(r)!=="object"&&(r=y(r)),re(i)!=="object"&&(i=y(i)),h=0,_=E.length;h<_;h++)if(c=E[h],a===c[0]){u=c[1](r,i,l,a);break}if(u==null)throw"color mode "+a+" is not supported";return u.alpha(r.alpha()+l*(i.alpha()-r.alpha()))},y.interpolate=me,e.prototype.interpolate=function(r,i,l){return me(this,r,i,l)},y.mix=me,e.prototype.mix=e.prototype.interpolate,g.rgb=function(){var r,i,l,a;i=se(arguments),l=[];for(r in i)a=i[r],l.push(a);return l},y.rgb=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["rgb"]),function(){})},e.prototype.rgb=function(r){return r==null&&(r=!0),r?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},e.prototype.rgba=function(r){return r==null&&(r=!0),r?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},m.push({p:3,test:function(r){var i;if(i=se(arguments),re(i)==="array"&&i.length===3||i.length===4&&re(i[3])==="number"&&i[3]>=0&&i[3]<=1)return"rgb"}}),g.lrgb=g.rgb,De=function(r,i,l,a){var c,_;return c=r._rgb,_=i._rgb,new e(Me(he(c[0],2)*(1-l)+he(_[0],2)*l),Me(he(c[1],2)*(1-l)+he(_[1],2)*l),Me(he(c[2],2)*(1-l)+he(_[2],2)*l),a)},p=function(r){var i,l,a,c,_,h;for(l=1/r.length,h=[0,0,0,0],c=0,a=r.length;c<a;c++)i=r[c],_=i._rgb,h[0]+=he(_[0],2)*l,h[1]+=he(_[1],2)*l,h[2]+=he(_[2],2)*l,h[3]+=_[3]*l;return h[0]=Me(h[0]),h[1]=Me(h[1]),h[2]=Me(h[2]),h[3]>1&&(h[3]=1),new e(ne(h))},E.push(["lrgb",De]),y.average=function(r,i){var l,a,c,_,h,u,b,x,L,T,M,k,z;if(i==null&&(i="rgb"),L=r.length,r=r.map(function(N){return y(N)}),b=r.splice(0,1)[0],i==="lrgb")return p(r);k=b.get(i),_=[],h=0,u=0;for(x in k)k[x]=k[x]||0,_.push(isNaN(k[x])?0:1),i.charAt(x)==="h"&&!isNaN(k[x])&&(l=k[x]/180*n,h+=q(l),u+=Ve(l));for(a=b.alpha(),M=0,T=r.length;M<T;M++){c=r[M],z=c.get(i),a+=c.alpha();for(x in k)isNaN(z[x])||(_[x]+=1,i.charAt(x)==="h"?(l=z[x]/180*n,h+=q(l),u+=Ve(l)):k[x]+=z[x])}for(x in k)if(i.charAt(x)==="h"){for(l=A(u/_[x],h/_[x])/n*180;l<0;)l+=360;for(;l>=360;)l-=360;k[x]=l}else k[x]=k[x]/_[x];return y(k,i).alpha(a/L)},oe=function(r){var i,l,a,c,_,h;if(r.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(r.length===4||r.length===7)&&(r=r.substr(1)),r.length===3&&(r=r.split(""),r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),h=parseInt(r,16),c=h>>16,a=h>>8&255,l=h&255,[c,a,l,1];if(r.match(/^#?([A-Fa-f0-9]{8})$/))return r.length===9&&(r=r.substr(1)),h=parseInt(r,16),c=h>>24&255,a=h>>16&255,l=h>>8&255,i=xe((h&255)/255*100)/100,[c,a,l,i];if(g.css!=null&&(_=g.css(r)))return _;throw"unknown color: "+r},lr=function(r,i){var l,a,c,_,h,u,b;return i==null&&(i="auto"),h=r[0],c=r[1],a=r[2],l=r[3],i==="auto"&&(i=l<1?"rgba":"rgb"),h=Math.round(h),c=Math.round(c),a=Math.round(a),b=h<<16|c<<8|a,u="000000"+b.toString(16),u=u.substr(u.length-6),_="0"+xe(l*255).toString(16),_=_.substr(_.length-2),"#"+function(){switch(i.toLowerCase()){case"rgba":return u+_;case"argb":return _+u;default:return u}}()},g.hex=function(r){return oe(r)},y.hex=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["hex"]),function(){})},e.prototype.hex=function(r){return r==null&&(r="auto"),lr(this._rgb,r)},m.push({p:4,test:function(r){if(arguments.length===1&&re(r)==="string")return"hex"}}),Ne=function(){var r,i,l,a,c,_,h,u,b,x,L,T,M,k;if(r=se(arguments),c=r[0],L=r[1],h=r[2],L===0)b=a=i=h*255;else{for(k=[0,0,0],l=[0,0,0],M=h<.5?h*(1+L):h+L-h*L,T=2*h-M,c/=360,k[0]=c+1/3,k[1]=c,k[2]=c-1/3,_=u=0;u<=2;_=++u)k[_]<0&&(k[_]+=1),k[_]>1&&(k[_]-=1),6*k[_]<1?l[_]=T+(M-T)*6*k[_]:2*k[_]<1?l[_]=M:3*k[_]<2?l[_]=T+(M-T)*(2/3-k[_])*6:l[_]=T;x=[xe(l[0]*255),xe(l[1]*255),xe(l[2]*255)],b=x[0],a=x[1],i=x[2]}return r.length>3?[b,a,i,r[3]]:[b,a,i]},ar=function(r,i,l){var a,c,_,h,u;return r!==void 0&&r.length>=3&&(h=r,r=h[0],i=h[1],l=h[2]),r/=255,i/=255,l/=255,_=Math.min(r,i,l),V=Math.max(r,i,l),c=(V+_)/2,V===_?(u=0,a=Number.NaN):u=c<.5?(V-_)/(V+_):(V-_)/(2-V-_),r===V?a=(i-l)/(V-_):i===V?a=2+(l-r)/(V-_):l===V&&(a=4+(r-i)/(V-_)),a*=60,a<0&&(a+=360),[a,u,c]},y.hsl=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["hsl"]),function(){})},g.hsl=Ne,e.prototype.hsl=function(){return ar(this._rgb)},fe=function(){var r,i,l,a,c,_,h,u,b,x,L,T,M,k,z,N,W,Z;if(r=se(arguments),c=r[0],N=r[1],Z=r[2],Z*=255,N===0)b=a=i=Z;else switch(c===360&&(c=0),c>360&&(c-=360),c<0&&(c+=360),c/=60,_=ae(c),l=c-_,h=Z*(1-N),u=Z*(1-N*l),W=Z*(1-N*(1-l)),_){case 0:x=[Z,W,h],b=x[0],a=x[1],i=x[2];break;case 1:L=[u,Z,h],b=L[0],a=L[1],i=L[2];break;case 2:T=[h,Z,W],b=T[0],a=T[1],i=T[2];break;case 3:M=[h,u,Z],b=M[0],a=M[1],i=M[2];break;case 4:k=[W,h,Z],b=k[0],a=k[1],i=k[2];break;case 5:z=[Z,h,u],b=z[0],a=z[1],i=z[2]}return[b,a,i,r.length>3?r[3]:1]},cr=function(){var r,i,l,a,c,_,h,u,b;return h=se(arguments),_=h[0],l=h[1],r=h[2],c=Math.min(_,l,r),V=Math.max(_,l,r),i=V-c,b=V/255,V===0?(a=Number.NaN,u=0):(u=i/V,_===V&&(a=(l-r)/i),l===V&&(a=2+(r-_)/i),r===V&&(a=4+(_-l)/i),a*=60,a<0&&(a+=360)),[a,u,b]},y.hsv=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["hsv"]),function(){})},g.hsv=fe,e.prototype.hsv=function(){return cr(this._rgb)},tr=function(r){var i,l,a;return re(r)==="number"&&r>=0&&r<=16777215?(a=r>>16,l=r>>8&255,i=r&255,[a,l,i,1]):(console.warn("unknown num color: "+r),[0,0,0,1])},dr=function(){var r,i,l,a;return a=se(arguments),l=a[0],i=a[1],r=a[2],(l<<16)+(i<<8)+r},y.num=function(r){return new e(r,"num")},e.prototype.num=function(r){return r==null&&(r="rgb"),dr(this._rgb,r)},g.num=tr,m.push({p:1,test:function(r){if(arguments.length===1&&re(r)==="number"&&r>=0&&r<=16777215)return"num"}}),de=function(){var r,i,l,a,c,_,h,u,b,x,L,T,M,k,z,N,W,Z,ce,D;if(l=se(arguments),u=l[0],c=l[1],i=l[2],c=c/100,h=h/100*255,r=c*255,c===0)T=h=a=i;else switch(u===360&&(u=0),u>360&&(u-=360),u<0&&(u+=360),u/=60,b=ae(u),_=u-b,x=i*(1-c),L=x+r*(1-_),ce=x+r*_,D=x+r,b){case 0:M=[D,ce,x],T=M[0],h=M[1],a=M[2];break;case 1:k=[L,D,x],T=k[0],h=k[1],a=k[2];break;case 2:z=[x,D,ce],T=z[0],h=z[1],a=z[2];break;case 3:N=[x,L,D],T=N[0],h=N[1],a=N[2];break;case 4:W=[ce,x,D],T=W[0],h=W[1],a=W[2];break;case 5:Z=[D,x,L],T=Z[0],h=Z[1],a=Z[2]}return[T,h,a,l.length>3?l[3]:1]},ir=function(){var r,i,l,a,c,_,h,u,b;return b=se(arguments),u=b[0],c=b[1],i=b[2],h=Math.min(u,c,i),V=Math.max(u,c,i),a=V-h,l=a*100/255,r=h/(255-a)*100,a===0?_=Number.NaN:(u===V&&(_=(c-i)/a),c===V&&(_=2+(i-u)/a),i===V&&(_=4+(u-c)/a),_*=60,_<0&&(_+=360)),[_,l,r]},y.hcg=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["hcg"]),function(){})},g.hcg=de,e.prototype.hcg=function(){return ir(this._rgb)},U=function(r){var i,l,a,c,_,h,u,b;if(r=r.toLowerCase(),y.colors!=null&&y.colors[r])return oe(y.colors[r]);if(_=r.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(u=_.slice(1,4),c=h=0;h<=2;c=++h)u[c]=+u[c];u[3]=1}else if(_=r.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(u=_.slice(1,5),c=b=0;b<=3;c=++b)u[c]=+u[c];else if(_=r.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(u=_.slice(1,4),c=i=0;i<=2;c=++i)u[c]=xe(u[c]*2.55);u[3]=1}else if(_=r.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(u=_.slice(1,5),c=l=0;l<=2;c=++l)u[c]=xe(u[c]*2.55);u[3]=+u[3]}else(_=r.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(a=_.slice(1,4),a[1]*=.01,a[2]*=.01,u=Ne(a),u[3]=1):(_=r.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(a=_.slice(1,4),a[1]*=.01,a[2]*=.01,u=Ne(a),u[3]=+_[4]);return u},sr=function(r){var i;if(i=r[3]<1?"rgba":"rgb",i==="rgb")return i+"("+r.slice(0,3).map(xe).join(",")+")";if(i==="rgba")return i+"("+r.slice(0,3).map(xe).join(",")+","+r[3]+")"},wt=function(r){return xe(r*100)/100},we=function(r,i){var l;return l=i<1?"hsla":"hsl",r[0]=wt(r[0]||0),r[1]=wt(r[1]*100)+"%",r[2]=wt(r[2]*100)+"%",l==="hsla"&&(r[3]=i),l+"("+r.join(",")+")"},g.css=function(r){return U(r)},y.css=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["css"]),function(){})},e.prototype.css=function(r){if(r==null&&(r="rgb"),r.slice(0,3)==="rgb")return sr(this._rgb);if(r.slice(0,3)==="hsl")return we(this.hsl(),this.alpha())},g.named=function(r){return oe(Ie[r])},m.push({p:5,test:function(r){if(arguments.length===1&&Ie[r]!=null)return"named"}}),e.prototype.name=function(r){var i,l;arguments.length&&(Ie[r]&&(this._rgb=oe(Ie[r])),this._rgb[3]=1),i=this.hex("rgb");for(l in Ie)if(i===Ie[l])return l;return i},be=function(){var r,i,l,a;return a=se(arguments),l=a[0],r=a[1],i=a[2],i=i*t,[l,q(i)*r,Ve(i)*r]},ye=function(){var r,i,l,a,c,_,h,u,b,x,L;return l=se(arguments),u=l[0],c=l[1],h=l[2],x=be(u,c,h),r=x[0],i=x[1],a=x[2],L=He(r,i,a),b=L[0],_=L[1],a=L[2],[b,_,a,l.length>3?l[3]:1]},ze=function(){var r,i,l,a,c,_;return _=se(arguments),c=_[0],r=_[1],i=_[2],l=Me(r*r+i*i),a=(A(i,r)*d+360)%360,xe(l*1e4)===0&&(a=Number.NaN),[c,l,a]},Wt=function(){var r,i,l,a,c,_,h;return _=se(arguments),c=_[0],l=_[1],i=_[2],h=Pt(c,l,i),a=h[0],r=h[1],i=h[2],ze(a,r,i)},y.lch=function(){var r;return r=se(arguments),new e(r,"lch")},y.hcl=function(){var r;return r=se(arguments),new e(r,"hcl")},g.lch=ye,g.hcl=function(){var r,i,l,a;return a=se(arguments),i=a[0],r=a[1],l=a[2],ye([l,r,i])},e.prototype.lch=function(){return Wt(this._rgb)},e.prototype.hcl=function(){return Wt(this._rgb).reverse()},or=function(r){var i,l,a,c,_,h,u,b,x;return r==null&&(r="rgb"),b=se(arguments),u=b[0],c=b[1],i=b[2],u=u/255,c=c/255,i=i/255,_=1-Math.max(u,Math.max(c,i)),a=_<1?1/(1-_):0,l=(1-u-_)*a,h=(1-c-_)*a,x=(1-i-_)*a,[l,h,x,_]},I=function(){var r,i,l,a,c,_,h,u,b;return i=se(arguments),a=i[0],h=i[1],b=i[2],_=i[3],r=i.length>4?i[4]:1,_===1?[0,0,0,r]:(u=a>=1?0:255*(1-a)*(1-_),c=h>=1?0:255*(1-h)*(1-_),l=b>=1?0:255*(1-b)*(1-_),[u,c,l,r])},g.cmyk=function(){return I(se(arguments))},y.cmyk=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["cmyk"]),function(){})},e.prototype.cmyk=function(){return or(this._rgb)},g.gl=function(){var r,i,l,a,c;for(a=function(){var _,h;_=se(arguments),h=[];for(i in _)c=_[i],h.push(c);return h}.apply(this,arguments),r=l=0;l<=2;r=++l)a[r]*=255;return a},y.gl=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["gl"]),function(){})},e.prototype.gl=function(){var r;return r=this._rgb,[r[0]/255,r[1]/255,r[2]/255,r[3]]},Ft=function(r,i,l){var a;return a=se(arguments),r=a[0],i=a[1],l=a[2],r=yt(r),i=yt(i),l=yt(l),.2126*r+.7152*i+.0722*l},yt=function(r){return r/=255,r<=.03928?r/12.92:he((r+.055)/1.055,2.4)},Le=function(r,i,l,a){var c,_;return c=r._rgb,_=i._rgb,new e(c[0]+l*(_[0]-c[0]),c[1]+l*(_[1]-c[1]),c[2]+l*(_[2]-c[2]),a)},E.push(["rgb",Le]),e.prototype.luminance=function(r,i){var l,a,c,_,h;return i==null&&(i="rgb"),arguments.length?(_=this._rgb,r===0?_=[0,0,0,this._rgb[3]]:r===1?_=[255,255,255,this[3]]:(l=Ft(this._rgb),a=1e-7,c=20,h=function(u,b){var x,L;return L=u.interpolate(b,.5,i),x=L.luminance(),Math.abs(r-x)<a||!c--?L:x>r?h(u,L):h(L,b)},l>r?_=h(y("black"),this).rgba():_=h(this,y("white")).rgba()),y(_).alpha(this.alpha())):Ft(this._rgb)},Ut=function(r){var i,l,a,c;return c=r/100,c<66?(a=255,l=-155.25485562709179-.44596950469579133*(l=c-2)+104.49216199393888*je(l),i=c<20?0:-254.76935184120902+.8274096064007395*(i=c-10)+115.67994401066147*je(i)):(a=351.97690566805693+.114206453784165*(a=c-55)-40.25366309332127*je(a),l=325.4494125711974+.07943456536662342*(l=c-50)-28.0852963507957*je(l),i=255),[a,l,i]},_r=function(){var r,i,l,a,c,_,h,u,b;for(h=se(arguments),_=h[0],l=h[1],r=h[2],c=1e3,a=4e4,i=.4;a-c>i;)b=(a+c)*.5,u=Ut(b),u[2]/u[0]>=r/_?a=b:c=b;return xe(b)},y.temperature=y.kelvin=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["temperature"]),function(){})},g.temperature=g.kelvin=g.K=Ut,e.prototype.temperature=function(){return _r(this._rgb)},e.prototype.kelvin=e.prototype.temperature,y.contrast=function(r,i){var l,a,c,_;return((c=re(r))==="string"||c==="number")&&(r=new e(r)),((_=re(i))==="string"||_==="number")&&(i=new e(i)),l=r.luminance(),a=i.luminance(),l>a?(l+.05)/(a+.05):(a+.05)/(l+.05)},y.distance=function(r,i,l){var a,c,_,h,u,b,x;l==null&&(l="lab"),((u=re(r))==="string"||u==="number")&&(r=new e(r)),((b=re(i))==="string"||b==="number")&&(i=new e(i)),_=r.get(l),h=i.get(l),x=0;for(c in _)a=(_[c]||0)-(h[c]||0),x+=a*a;return Math.sqrt(x)},y.deltaE=function(r,i,l,a){var c,_,h,u,b,x,L,T,M,k,z,N,W,Z,ce,D,Ce,ke,$,Q,pe,v,O,G,Y,H,X;for(l==null&&(l=1),a==null&&(a=1),((Ce=re(r))==="string"||Ce==="number")&&(r=new e(r)),((ke=re(i))==="string"||ke==="number")&&(i=new e(i)),$=r.lab(),c=$[0],h=$[1],b=$[2],Q=i.lab(),_=Q[0],u=Q[1],x=Q[2],L=Me(h*h+b*b),T=Me(u*u+x*x),O=c<16?.511:.040975*c/(1+.01765*c),pe=.0638*L/(1+.0131*L)+.638,D=L<1e-6?0:A(b,h)*180/n;D<0;)D+=360;for(;D>=360;)D-=360;return G=D>=164&&D<=345?.56+C(.2*q(n*(D+168)/180)):.36+C(.4*q(n*(D+35)/180)),M=L*L*L*L,ce=Me(M/(M+1900)),v=pe*(ce*G+1-ce),Z=c-_,W=L-T,z=h-u,N=b-x,k=z*z+N*N-W*W,Y=Z/(l*O),H=W/(a*pe),X=v,Me(Y*Y+H*H+k/(X*X))},e.prototype.get=function(r){var i,l,a,c,_,h;return a=this,_=r.split("."),c=_[0],i=_[1],h=a[c](),i?(l=c.indexOf(i),l>-1?h[l]:console.warn("unknown channel "+i+" in mode "+c)):h},e.prototype.set=function(r,i){var l,a,c,_,h,u;if(c=this,h=r.split("."),_=h[0],l=h[1],l)if(u=c[_](),a=_.indexOf(l),a>-1)if(re(i)==="string")switch(i.charAt(0)){case"+":u[a]+=+i;break;case"-":u[a]+=+i;break;case"*":u[a]*=+i.substr(1);break;case"/":u[a]/=+i.substr(1);break;default:u[a]=+i}else u[a]=i;else console.warn("unknown channel "+l+" in mode "+_);else u=i;return y(u,_).alpha(c.alpha())},e.prototype.clipped=function(){return this._rgb._clipped||!1},e.prototype.alpha=function(r){return arguments.length?y.rgb([this._rgb[0],this._rgb[1],this._rgb[2],r]):this._rgb[3]},e.prototype.darken=function(r){var i,l;return r==null&&(r=1),l=this,i=l.lab(),i[0]-=o.Kn*r,y.lab(i).alpha(l.alpha())},e.prototype.brighten=function(r){return r==null&&(r=1),this.darken(-r)},e.prototype.darker=e.prototype.darken,e.prototype.brighter=e.prototype.brighten,e.prototype.saturate=function(r){var i,l;return r==null&&(r=1),l=this,i=l.lch(),i[1]+=r*o.Kn,i[1]<0&&(i[1]=0),y.lch(i).alpha(l.alpha())},e.prototype.desaturate=function(r){return r==null&&(r=1),this.saturate(-r)},e.prototype.premultiply=function(){var r,i;return i=this.rgb(),r=this.alpha(),y(i[0]*r,i[1]*r,i[2]*r,r)},P=function(r,i,l){if(!P[l])throw"unknown blend mode "+l;return P[l](r,i)},R=function(r){return function(i,l){var a,c;return a=y(l).rgb(),c=y(i).rgb(),y(r(a,c),"rgb")}},K=function(r){return function(i,l){var a,c,_;for(_=[],a=c=0;c<=3;a=++c)_[a]=r(i[a],l[a]);return _}},er=function(r,i){return r},Qt=function(r,i){return r*i/255},F=function(r,i){return r>i?i:r},Jt=function(r,i){return r>i?r:i},ur=function(r,i){return 255*(1-(1-r/255)*(1-i/255))},rr=function(r,i){return i<128?2*r*i/255:255*(1-2*(1-r/255)*(1-i/255))},j=function(r,i){return 255*(1-(1-i/255)/(r/255))},le=function(r,i){return r===255||(r=255*(i/255)/(1-r/255),r>255)?255:r},P.normal=R(K(er)),P.multiply=R(K(Qt)),P.screen=R(K(ur)),P.overlay=R(K(rr)),P.darken=R(K(F)),P.lighten=R(K(Jt)),P.dodge=R(K(le)),P.burn=R(K(j)),y.blend=P,y.analyze=function(r){var i,l,a,c;for(a={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},l=0,i=r.length;l<i;l++)c=r[l],c!=null&&!isNaN(c)&&(a.values.push(c),a.sum+=c,c<a.min&&(a.min=c),c>a.max&&(a.max=c),a.count+=1);return a.domain=[a.min,a.max],a.limits=function(_,h){return y.limits(a,_,h)},a},y.scale=function(r,i){var l,a,c,_,h,u,b,x,L,T,M,k,z,N,W,Z,ce,D,Ce,ke,$,Q,pe;return T="rgb",M=y("#ccc"),W=0,u=!1,h=[0,1],N=[],z=[0,0],l=!1,c=[],k=!1,L=0,x=1,_=!1,a={},Z=!0,b=1,Q=function(v){var O,G,Y,H,X,te;if(v==null&&(v=["#fff","#000"]),v!=null&&re(v)==="string"&&y.brewer!=null&&(v=y.brewer[v]||y.brewer[v.toLowerCase()]||v),re(v)==="array"){for(v.length===1&&(v=[v[0],v[0]]),v=v.slice(0),O=Y=0,H=v.length-1;0<=H?Y<=H:Y>=H;O=0<=H?++Y:--Y)G=v[O],re(G)==="string"&&(v[O]=y(G));for(N.length=0,O=te=0,X=v.length-1;0<=X?te<=X:te>=X;O=0<=X?++te:--te)N.push(O/(v.length-1))}return $(),c=v},Ce=function(v){var O,G;if(l!=null){for(G=l.length-1,O=0;O<G&&v>=l[O];)O++;return O-1}return 0},pe=function(v){return v},ce=function(v){var O,G,Y,H,X;return X=v,l.length>2&&(H=l.length-1,O=Ce(v),Y=l[0]+(l[1]-l[0])*(0+W*.5),G=l[H-1]+(l[H]-l[H-1])*(1-W*.5),X=L+(l[O]+(l[O+1]-l[O])*.5-Y)/(G-Y)*(x-L)),X},ke=function(v,O){var G,Y,H,X,te,ee,_e,J;if(O==null&&(O=!1),isNaN(v)||v===null)return M;if(O?J=v:l&&l.length>2?(G=Ce(v),J=G/(l.length-2)):x!==L?J=(v-L)/(x-L):J=1,O||(J=pe(J)),b!==1&&(J=he(J,b)),J=z[0]+J*(1-z[0]-z[1]),J=Math.min(1,Math.max(0,J)),X=Math.floor(J*1e4),Z&&a[X])Y=a[X];else{if(re(c)==="array")for(H=te=0,_e=N.length-1;0<=_e?te<=_e:te>=_e;H=0<=_e?++te:--te){if(ee=N[H],J<=ee){Y=c[H];break}if(J>=ee&&H===N.length-1){Y=c[H];break}if(J>ee&&J<N[H+1]){J=(J-ee)/(N[H+1]-ee),Y=y.interpolate(c[H],c[H+1],J,T);break}}else re(c)==="function"&&(Y=c(J));Z&&(a[X]=Y)}return Y},$=function(){return a={}},Q(r),D=function(v){var O;return O=y(ke(v)),k&&O[k]?O[k]():O},D.classes=function(v){var O;return v!=null?(re(v)==="array"?(l=v,h=[v[0],v[v.length-1]]):(O=y.analyze(h),v===0?l=[O.min,O.max]:l=y.limits(O,"e",v)),D):l},D.domain=function(v){var O,G,Y,H,X,te,ee;if(!arguments.length)return h;if(L=v[0],x=v[v.length-1],N=[],Y=c.length,v.length===Y&&L!==x)for(X=0,H=v.length;X<H;X++)G=v[X],N.push((G-L)/(x-L));else for(O=ee=0,te=Y-1;0<=te?ee<=te:ee>=te;O=0<=te?++ee:--ee)N.push(O/(Y-1));return h=[L,x],D},D.mode=function(v){return arguments.length?(T=v,$(),D):T},D.range=function(v,O){return Q(v,O),D},D.out=function(v){return k=v,D},D.spread=function(v){return arguments.length?(W=v,D):W},D.correctLightness=function(v){return v==null&&(v=!0),_=v,$(),_?pe=function(O){var G,Y,H,X,te,ee,_e,J,ue;for(G=ke(0,!0).lab()[0],Y=ke(1,!0).lab()[0],_e=G>Y,H=ke(O,!0).lab()[0],te=G+(Y-G)*O,X=H-te,J=0,ue=1,ee=20;Math.abs(X)>.01&&ee-- >0;)(function(){return _e&&(X*=-1),X<0?(J=O,O+=(ue-O)*.5):(ue=O,O+=(J-O)*.5),H=ke(O,!0).lab()[0],X=H-te})();return O}:pe=function(O){return O},D},D.padding=function(v){return v!=null?(re(v)==="number"&&(v=[v,v]),z=v,D):z},D.colors=function(v,O){var G,Y,H,X,te,ee,_e,J,ue;if(arguments.length<2&&(O="hex"),ee=[],arguments.length===0)ee=c.slice(0);else if(v===1)ee=[D(.5)];else if(v>1)Y=h[0],G=h[1]-Y,ee=function(){_e=[];for(var ge=0;0<=v?ge<v:ge>v;0<=v?ge++:ge--)_e.push(ge);return _e}.apply(this).map(function(ge){return D(Y+ge/(v-1)*G)});else{if(r=[],J=[],l&&l.length>2)for(H=ue=1,te=l.length;1<=te?ue<te:ue>te;H=1<=te?++ue:--ue)J.push((l[H-1]+l[H])*.5);else J=h;ee=J.map(function(ge){return D(ge)})}return y[O]&&(ee=ee.map(function(ge){return ge[O]()})),ee},D.cache=function(v){return v!=null?(Z=v,D):Z},D.gamma=function(v){return v!=null?(b=v,D):b},D.nodata=function(v){return v!=null?(M=y(v),D):M},D},y.scales==null&&(y.scales={}),y.scales.cool=function(){return y.scale([y.hsl(180,1,.9),y.hsl(250,.7,.4)])},y.scales.hot=function(){return y.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},y.analyze=function(r,i,l){var a,c,_,h,u,b,x;if(u={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},l==null&&(l=function(){return!0}),a=function(L){L!=null&&!isNaN(L)&&(u.values.push(L),u.sum+=L,L<u.min&&(u.min=L),L>u.max&&(u.max=L),u.count+=1)},x=function(L,T){if(l(L,T))return i!=null&&re(i)==="function"?a(i(L)):i!=null&&re(i)==="string"||re(i)==="number"?a(L[i]):a(L)},re(r)==="array")for(h=0,_=r.length;h<_;h++)b=r[h],x(b);else for(c in r)b=r[c],x(b,c);return u.domain=[u.min,u.max],u.limits=function(L,T){return y.limits(u,L,T)},u},y.limits=function(r,i,l){var a,c,_,h,u,b,x,L,T,M,k,z,N,W,Z,ce,D,Ce,ke,$,Q,pe,v,O,G,Y,H,X,te,ee,_e,J,ue,ge,Xe,Ke,Je,Ze,Qe,et,pr,tt,rt,ot,st,it,lt,nt,at,ct,go,Pe,Et,gr,Ae,dt;if(i==null&&(i="equal"),l==null&&(l=7),re(r)==="array"&&(r=y.analyze(r)),G=r.min,V=r.max,go=r.sum,Ae=r.values.sort(function(Ht,jt){return Ht-jt}),l===1)return[G,V];if(v=[],i.substr(0,1)==="c"&&(v.push(G),v.push(V)),i.substr(0,1)==="e"){for(v.push(G),$=_e=1,Xe=l-1;1<=Xe?_e<=Xe:_e>=Xe;$=1<=Xe?++_e:--_e)v.push(G+$/l*(V-G));v.push(V)}else if(i.substr(0,1)==="l"){if(G<=0)throw"Logarithmic scales are only possible for values > 0";for(Y=Math.LOG10E*je(G),O=Math.LOG10E*je(V),v.push(G),$=dt=1,Ke=l-1;1<=Ke?dt<=Ke:dt>=Ke;$=1<=Ke?++dt:--dt)v.push(he(10,Y+$/l*(O-Y)));v.push(V)}else if(i.substr(0,1)==="q"){for(v.push(G),$=a=1,tt=l-1;1<=tt?a<=tt:a>=tt;$=1<=tt?++a:--a)J=(Ae.length-1)*$/l,ue=ae(J),ue===J?v.push(Ae[ue]):(ge=J-ue,v.push(Ae[ue]*(1-ge)+Ae[ue+1]*ge));v.push(V)}else if(i.substr(0,1)==="k"){for(X=Ae.length,W=new Array(X),Ce=new Array(l),ct=!0,te=0,ce=null,ce=[],ce.push(G),$=c=1,rt=l-1;1<=rt?c<=rt:c>=rt;$=1<=rt?++c:--c)ce.push(G+$/l*(V-G));for(ce.push(V);ct;){for(Q=_=0,ot=l-1;0<=ot?_<=ot:_>=ot;Q=0<=ot?++_:--_)Ce[Q]=0;for($=h=0,st=X-1;0<=st?h<=st:h>=st;$=0<=st?++h:--h){for(gr=Ae[$],H=Number.MAX_VALUE,Q=u=0,it=l-1;0<=it?u<=it:u>=it;Q=0<=it?++u:--u)ke=C(ce[Q]-gr),ke<H&&(H=ke,Z=Q);Ce[Z]++,W[$]=Z}for(ee=new Array(l),Q=b=0,lt=l-1;0<=lt?b<=lt:b>=lt;Q=0<=lt?++b:--b)ee[Q]=null;for($=x=0,nt=X-1;0<=nt?x<=nt:x>=nt;$=0<=nt?++x:--x)D=W[$],ee[D]===null?ee[D]=Ae[$]:ee[D]+=Ae[$];for(Q=L=0,at=l-1;0<=at?L<=at:L>=at;Q=0<=at?++L:--L)ee[Q]*=1/Ce[Q];for(ct=!1,Q=T=0,Je=l-1;0<=Je?T<=Je:T>=Je;Q=0<=Je?++T:--T)if(ee[Q]!==ce[$]){ct=!0;break}ce=ee,te++,te>200&&(ct=!1)}for(pe={},Q=M=0,Ze=l-1;0<=Ze?M<=Ze:M>=Ze;Q=0<=Ze?++M:--M)pe[Q]=[];for($=k=0,Qe=X-1;0<=Qe?k<=Qe:k>=Qe;$=0<=Qe?++k:--k)D=W[$],pe[D].push(Ae[$]);for(Pe=[],Q=z=0,et=l-1;0<=et?z<=et:z>=et;Q=0<=et?++z:--z)Pe.push(pe[Q][0]),Pe.push(pe[Q][pe[Q].length-1]);for(Pe=Pe.sort(function(Ht,jt){return Ht-jt}),v.push(Pe[0]),$=N=1,pr=Pe.length-1;N<=pr;$=N+=2)Et=Pe[$],!isNaN(Et)&&v.indexOf(Et)===-1&&v.push(Et)}return v},ie=function(r,i,l){var a,c,_,h;return a=se(arguments),r=a[0],i=a[1],l=a[2],isNaN(r)&&(r=0),r/=360,r<1/3?(c=(1-i)/3,h=(1+i*q(f*r)/q(s-f*r))/3,_=1-(c+h)):r<2/3?(r-=1/3,h=(1-i)/3,_=(1+i*q(f*r)/q(s-f*r))/3,c=1-(h+_)):(r-=2/3,_=(1-i)/3,c=(1+i*q(f*r)/q(s-f*r))/3,h=1-(_+c)),h=bt(l*h*3),_=bt(l*_*3),c=bt(l*c*3),[h*255,_*255,c*255,a.length>3?a[3]:1]},nr=function(){var r,i,l,a,c,_,h,u;return h=se(arguments),_=h[0],i=h[1],r=h[2],f=Math.PI*2,_/=255,i/=255,r/=255,c=Math.min(_,i,r),a=(_+i+r)/3,u=1-c/a,u===0?l=0:(l=(_-i+(_-r))/2,l/=Math.sqrt((_-i)*(_-i)+(_-r)*(i-r)),l=Math.acos(l),r>i&&(l=f-l),l/=f),[l*360,u,a]},y.hsi=function(){return function(r,i,l){l.prototype=r.prototype;var a=new l,c=r.apply(a,i);return Object(c)===c?c:a}(e,Oe.call(arguments).concat(["hsi"]),function(){})},g.hsi=ie,e.prototype.hsi=function(){return nr(this._rgb)},Re=function(r,i,l,a){var c,_,h,u,b,x,L,T,M,k,z,N,W;return a==="hsl"?(N=r.hsl(),W=i.hsl()):a==="hsv"?(N=r.hsv(),W=i.hsv()):a==="hcg"?(N=r.hcg(),W=i.hcg()):a==="hsi"?(N=r.hsi(),W=i.hsi()):(a==="lch"||a==="hcl")&&(a="hcl",N=r.hcl(),W=i.hcl()),a.substr(0,1)==="h"&&(h=N[0],k=N[1],x=N[2],u=W[0],z=W[1],L=W[2]),!isNaN(h)&&!isNaN(u)?(u>h&&u-h>180?c=u-(h+360):u<h&&h-u>180?c=u+360-h:c=u-h,_=h+l*c):isNaN(h)?isNaN(u)?_=Number.NaN:(_=u,(x===1||x===0)&&a!=="hsv"&&(M=z)):(_=h,(L===1||L===0)&&a!=="hsv"&&(M=k)),M==null&&(M=k+l*(z-k)),b=x+l*(L-x),T=y[a](_,M,b)},E=E.concat(function(){var r,i,l,a;for(l=["hsv","hsl","hsi","hcl","lch","hcg"],a=[],i=0,r=l.length;i<r;i++)Zt=l[i],a.push([Zt,Re]);return a}()),Be=function(r,i,l,a){var c,_;return c=r.num(),_=i.num(),y.num(c+(_-c)*l,"num")},E.push(["num",Be]),Te=function(r,i,l,a){var c,_,h;return _=r.lab(),h=i.lab(),c=new e(_[0]+l*(h[0]-_[0]),_[1]+l*(h[1]-_[1]),_[2]+l*(h[2]-_[2]),a)},E.push(["lab",Te])}).call(_t)});var Ge=new WeakMap,br=!0,Eo=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Lo=Eo?5e6:1e7,Mt=0,qe=0,yr=performance.now();function Mo(){let e=performance.now(),t=e-yr,o=Mt,n=qe*1e3/t,s=1e3/o,d=qe;return Mt=0,qe=0,yr=e,{avg:o,real_fps:n,virtual_fps:s,num_frames:d,elapsed:t}}function So(e){Mt=(Mt*qe+e)/(qe+1),qe+=1}var xr=(e,...t)=>e.map((o,n)=>[o,t[n]]).flat().filter(o=>!!o).join(""),zo=()=>{let e,t=new Promise(o=>{e=o});return t.resolve=e,t},We=new Map;async function Oo(e){return await new Promise(requestAnimationFrame),await We.get(e)}async function kr(e,t){if(We.has(e)&&(await We.get(e),We.has(e))){await We.get(e);return}We.set(e,zo());try{return await t()}finally{let o=We.get(e);We.delete(e),o.resolve()}}var Co=":host{position:absolute;top:0px;left:0px;right:0px;bottom:0px;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch;}div.rt-virtual-panel{position:absolute;top:0;left:0;right:0;pointer-events:none;}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%;}div.rt-tree-container{display:flex;align-items:center;height:100%;}slot{position:absolute;overflow:hidden;overflow-anchor:none;}",No=":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px;}",Ao=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"});let e="<slot></slot>";this.shadowRoot.innerHTML=xr`
            <style>
                ${Co}
            </style>
            <style>
                ${No}
            </style>
            <div class="rt-virtual-panel"></div>
            <div class="rt-scroll-table-clip">${e}</div>
        `;let[,t,o,n]=this.shadowRoot.children;this._sub_cell_style=t,this._table_clip=n,this._virtual_panel=o,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(e,t){let{start_row:o,end_row:n}=this._calculate_row_range(e),{start_col:s,end_col:d}=this._calculate_column_range(t);return this._nrows=e,{start_col:s,end_col:d,start_row:o,end_row:n}}_calculate_row_range(e){let{height:t}=this._container_size,o=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length,s=Math.max(1,this._virtual_panel.offsetHeight-t),d=Math.max(Math.ceil(this.scrollTop),0)/s,f=t/o-n,p=Math.max(0,(e||0)-f)*d,m=Math.max(0,Math.min(p+f,e));return{start_row:p,end_row:m}}_calc_start_column(){let e=this._view_cache.config.row_pivots.length,t=0,o=0,n=0;for(;o<this.scrollLeft;){let s=this._column_sizes.indices[t+e];n=this.scrollLeft-o,t+=1,o+=s!==void 0?s:60}return t+=n/(this._column_sizes.indices[t+e-1]||60),Math.max(0,t-1)}_calculate_column_range(e){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let t=this._calc_start_column(),o=this.table_model.num_columns()||Math.min(e,Math.ceil(this._container_size.width/60)),n=t+o+1;return{start_col:t,end_col:n}}}_max_scroll_column(e){let t=0;if(this._view_cache.config.row_pivots.length>0)for(let s of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))t+=s;let o=this._view_cache.config.row_pivots.length,n=e;for(;t<this._container_size.width&&n>=0;)n--,t+=this._column_sizes.indices[n+o]||60;return Math.min(e-1,n+1)}_validate_viewport({start_col:e,end_col:t,start_row:o,end_row:n}){o=Math.floor(o),n=Math.ceil(n),e=Math.floor(e),t=Math.ceil(t);let s=this._start_col!==e,d=this._start_row!==o||this._end_row!==n||this._end_col!==t;return this._start_col=e,this._end_col=t,this._start_row=o,this._end_row=n,{invalid_column:s,invalid_row:d}}_calc_scrollable_column_width(e){let t=this._view_cache.config.row_pivots.length,o=this._max_scroll_column(e),n=t,s=0;for(;n<o+t;)s+=this._column_sizes.indices[n]||60,n++;if(n<this._column_sizes.indices.length){let d=this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length).reduce((f,p)=>f+p,0);s+=Math.max(0,this._column_sizes.indices[n]-(this._container_size.width-d)||0)}return s}_update_virtual_panel_width(e,t){if(e)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((o,n)=>o+n,0)+"px";else{let o=this._calc_scrollable_column_width(t);if(o!==0){let n=this._container_size.width+o+2;this._virtual_panel.style.width=n+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(e){let{row_height:t=19}=this._column_sizes,o=this._view_cache.config.column_pivots.length*t,n;n=Math.min(Lo,e*t+o),this._virtual_panel.style.height=`${n}px`}async draw(e={}){return typeof e.throttle<"u"&&!e.throttle?await vr.call(this,e):await kr(this,()=>vr.call(this,e))}async _draw_flush(){await Oo(this)}update_sub_cell_offset(e){let t=this._column_sizes.row_height*(e.start_row%1)||0,o=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(e.start_col)]*(e.start_col%1)||0,n=this._sub_cell_style.sheet?.cssRules[0].style;n&&(n.setProperty("--regular-table--clip-x",`${o}px`),n.setProperty("--regular-table--clip-y",`${t}px`),n.setProperty("--regular-table--transform-x",`-${o}px`),n.setProperty("--regular-table--transform-y",`-${t}px`))}};async function vr(e){let t=br&&performance.now(),{invalid_viewport:o=!0,preserve_width:n=!1}=e,{num_columns:s,num_rows:d,num_row_headers:f,num_column_headers:p,row_height:m}=await this._view_cache.view(0,0,0,0);f!==void 0&&(this._view_cache.row_pivots=Array(f).fill(0)),p!==void 0&&(this._view_cache.column_pivots=Array(p).fill(0)),this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(d),n||this._update_virtual_panel_width(o,s);let w=this._calculate_viewport(d,s),{invalid_row:g,invalid_column:E}=this._validate_viewport(w);if(this._invalid_schema||g||E||o){let C=[],A=!0;for await(let S of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,n,w,s)){S!==void 0&&(C=C.concat(S)),A&&(this.update_sub_cell_offset(w),A=!1),this._is_styling=!0;let P=this._style_callbacks;for(let R of P)await R({detail:this});if(this._is_styling=!1,!this._invalidated&&S!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(C,m),this.table_model.header.reset_header_cache(),n||this._update_virtual_panel_width(this._invalid_schema||E,s),this._invalid_schema=!1}else this.update_sub_cell_offset(w);br&&So(performance.now()-t)}var Ro=!1,To=class extends Ao{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}async _on_scroll(e){e.stopPropagation(),await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this),{passive:!0}),Ro&&(this.addEventListener("touchmove",this._on_touchmove.bind(this)),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!0}))}_on_mousewheel(e){if(!window.safari)return;let{clientWidth:t,clientHeight:o,scrollTop:n,scrollLeft:s}=this;e.preventDefault(),e.returnValue=!1;let d=Math.max(1,this._virtual_panel.offsetHeight-o),f=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.max(0,Math.min(d,n+e.deltaY)),this.scrollLeft=Math.max(0,Math.min(f,s+e.deltaX)),this._on_scroll(e)}_on_touchmove(e){e.stopPropagation(),e.preventDefault(),e.returnValue=!1;let{clientWidth:t,clientHeight:o}=this,n=Math.max(1,this._virtual_panel.offsetHeight-o),s=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(n,this._memo_scroll_top+(this._memo_touch_startY-e.touches[0].pageY)),this.scrollLeft=Math.min(s,this._memo_scroll_left+(this._memo_touch_startX-e.touches[0].pageX)),this._on_scroll(e)}_on_touchstart(e){this._memo_touch_startY=e.touches[0].pageY,this._memo_touch_startX=e.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(e){let t=e.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let o=e.target.classList.contains("rt-column-resize"),n=Ge.get(t);if(o){e.stopImmediatePropagation(),t.style.minWidth="",t.style.maxWidth="",e.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[n.size_key]=void 0,this._column_sizes.auto[n.size_key]=void 0,this._column_sizes.indices[n.size_key]=void 0);for(let s of e.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let d of e.shiftKey?s:[s[n._virtual_x]])d&&(d.style.minWidth="",d.style.maxWidth="",d.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(e){if(e.button!==0)return;let t=e.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let o=e.target.classList.contains("rt-column-resize"),n=Ge.get(t);o&&(this._on_resize_column(e,t,n),e.stopImmediatePropagation())}async _on_click_or_dblclick(e){let t=performance.now();this._last_clicked_time&&t-this._last_clicked_time<500?(this._last_clicked_time=t,await this._on_dblclick(e)):(this._last_clicked_time=t,await this._on_click(e))}_on_resize_column(e,t,o){let{_virtual_x:n,size_key:s}=o,d=e.pageX,f=n+t.colSpan-1,p=this.table_model.header.get_column_header(f),m=this._column_sizes.indices[s],w=E=>kr(this,async()=>await this._on_resize_column_move(E,p,d,m,s,f)),g=()=>{document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",g);let E=this._column_sizes.override[s],C=this._column_sizes.indices[s]!==E;this._column_sizes.indices[s]=E,C&&this.draw()};document.addEventListener("mousemove",w),document.addEventListener("mouseup",g)}async _on_resize_column_move(e,t,o,n,s,d){await new Promise(requestAnimationFrame);let f=e.pageX-o,p=Math.max(1,n+f);if(this._column_sizes.override[s]=p,f<0)await this.draw({preserve_width:!0,throttle:!1});else{t.style.minWidth=p+"px",t.style.maxWidth=p+"px";let m=this._column_sizes.auto[s];for(let w of this.table_model.body.cells){let g=w[d];g&&(g.style.maxWidth=g.style.minWidth=p+"px",g.classList.toggle("rt-cell-clip",m>p))}}}},Do=class{constructor(e){this._name=e,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let e=this._elements[this._index];return this._index+=1,e}},Er=class{constructor(e,t,o){this._column_sizes=e,this._container=t,this._span_factory=new Do("span"),this.table=o,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(e,t){Ge.set(e,t)}_get_or_create_metadata(e){if(e===void 0)return{};if(Ge.has(e))return Ge.get(e);{let t={};return Ge.set(e,t),t}}_replace_cell(e,t){let{tr:o,row_container:n}=this._get_row(e),s=n[t];return s&&(o.removeChild(s),n.splice(t,1,void 0)),s}_fetch_cell(e,t){if(!(e<0||t<0))return this.cells[e]?.[t]}_get_row(e){let t=this.rows[e];t||(t=this.rows[e]=document.createElement("tr"),this.table.appendChild(t));let o=this.cells[e];return o||(o=this.cells[e]=[]),{tr:t,row_container:o}}_get_cell(e="TD",t,o){let{tr:n,row_container:s}=this._get_row(t),d=s[o];if(d||(o<s.length?(d=s[o]=document.createElement(e),n.insertBefore(d,s.slice(o+1).find(f=>f))):(d=s[o]=document.createElement(e),n.appendChild(d))),d.tagName!==e){let f=document.createElement(e);n.replaceChild(f,d),this.cells[t].splice(o,1,f),d=f}return d}_clean_columns(e){for(let t=0;t<this.rows.length;t++){let o=this.rows[t],n=this.cells[t];this.cells[t]=n.slice(0,e[t]||e);let s=this.cells[t].filter(d=>d!==void 0).length;for(;o.children[s];)o.removeChild(o.children[s])}}_clean_rows(e){for(;this.table.children[e];)this.table.removeChild(this.table.children[e]);this.rows=this.rows.slice(0,e),this.cells=this.cells.slice(0,e)}},Io=class extends Er{constructor(...e){super(...e),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(e,t,o){let n=this._get_cell("TH",t,e[t]||0);if(e[t]+=1,n.removeAttribute("colspan"),n.style.minWidth="0",n.textContent="",o instanceof HTMLElement)n.appendChild(o);else{let d=this._span_factory.get("span");d.textContent=o,n.appendChild(d)}let s=this._span_factory.get("span");return s.className="rt-column-resize",n.appendChild(s),n}_draw_group(e,t,o){let n=this._get_or_create_metadata(o);return n.column_header=e,n.value=t,n.value=t,n}_draw_th(e,t,o,n,s){let d=this._get_or_create_metadata(o);if(d.column_header=e,d.value=t,d.size_key=s.length?s[0]:s,!(s.length>1)){let f=this._column_sizes.override[d.size_key],p=this._column_sizes.auto[d.size_key];f?(o.classList.toggle("rt-cell-clip",p>f),o.style.minWidth=f+"px",o.style.maxWidth=f+"px"):p?(o.classList.remove("rt-cell-clip"),o.style.maxWidth="",o.style.minWidth=p+"px"):(o.style.maxWidth="",o.style.maxWidth="")}return d}get_column_header(e){return this._get_cell("TH",this.num_rows()-1,e)}draw(e,t,o,n,s,d,f,p,m){let w=t?.length;if(w===0)return;let g,E,C,A;p=typeof p>"u"?w-1:p;for(let S=0;S<w;S++){if(C=t[S]?t[S]:"",this._offset_cache[S]=this._offset_cache[S]||0,S<p)m&&this._group_header_cache?.[S]?.[0]?.value===C?(g=this._group_header_cache[S][1],this._group_header_cache[S][2]+=1,o===1&&(this._group_header_cache[S][0].row_header_x=s),g.setAttribute("colspan",this._group_header_cache[S][2])):(g=this._draw_group_th(this._offset_cache,S,C),E=this._draw_group(t,C,g),this._group_header_cache[S]=[E,g,1]);else{g=this._draw_group_th(this._offset_cache,S,C),E=this._draw_th(e||t,C,g,n,s),typeof A>"u"&&(A={th:g,metadata:E});for(let[P]of this._group_header_cache)P.size_key=E.size_key;g.removeAttribute("colspan")}this._get_row(S).tr.classList.toggle("rt-autosize",S===p),g.classList.toggle("rt-group-corner",n===void 0),E&&(E.x=typeof n>"u"?n:Math.floor(n),E.column_header_y=S,E.x0=Math.floor(d),E._virtual_x=f,o===1&&(E.row_header_x=s))}return this._clean_rows(this._offset_cache.length),A=A||{th:g,metadata:E},A}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Po=class extends Er{_draw_td(e,t,o,n,{column_name:s},{ridx_offset:d},f){let p=this._get_cell(e,t,n),m=this._get_or_create_metadata(p);m.y=t+Math.floor(d),m.size_key=f,e==="TD"&&(m.column_header=s);let w=this._column_sizes.override[m.size_key];if(w){let g=this._column_sizes.auto[m.size_key];p.classList.toggle("rt-cell-clip",g>w),p.style.minWidth=w+"px",p.style.maxWidth=w+"px"}else p.classList.remove("rt-cell-clip"),p.style.minWidth="",p.style.maxWidth="";return m.value!==o&&(o instanceof HTMLElement?(p.textContent="",p.appendChild(o)):p.textContent=o),m.value=o,{td:p,metadata:m}}draw(e,t,o,n=!1,s,d,f,p){let{cidx:m,column_data:w,row_headers:g,column_data_listener_metadata:E}=t,{row_height:C}=o,A,S=[],P=[],R=0,B=[];for(let j=0;j<(n?o.row_headers_length:1);j++){R=0;for(let y of w){let ne=g?.[R],I;if(n){let Ee=y[j],q=this._fetch_cell(R-(S[j]||1),m+j),U=this._get_or_create_metadata(q),F=this._fetch_cell(R,m+j-(B[R]||1)),le=this._get_or_create_metadata(F);p&&F&&(le.value===Ee||Ee===void 0)&&!F.hasAttribute("rowspan")?(B[R]=B[R]?B[R]+1:2,F.setAttribute("colspan",B[R]),this._replace_cell(R,m+j)):p&&q&&U.value===Ee&&!q.hasAttribute("colspan")?(S[j]=S[j]?S[j]+1:2,q.setAttribute("rowspan",S[j]),this._replace_cell(R,m+j)):(I=this._draw_td("TH",R,Ee,m+j,t,o,j),I.td.style.display="",I.td.removeAttribute("rowspan"),I.td.removeAttribute("colspan"),I.metadata.row_header=y,I.metadata.row_header_x=j,I.metadata.y0=Math.floor(o.ridx_offset),I.metadata.y1=Math.ceil(o.y1),I.metadata._virtual_x=j,typeof d<"u"&&(I.metadata.x0=Math.floor(d)),S[j]=1,B[R]=1,P[j]=I)}else I=this._draw_td("TD",R,y,m,t,o,f),E&&(I.metadata.user=E[R]),I.metadata.x=typeof s>"u"?s:Math.floor(s),I.metadata.x1=Math.ceil(o.x1),I.metadata.row_header=ne||[],I.metadata.y0=Math.floor(o.ridx_offset),I.metadata.y1=Math.ceil(o.y1),I.metadata.dx=Math.floor(s-d),I.metadata.dy=I.metadata.y-Math.floor(I.metadata.y0),I.metadata._virtual_x=m,typeof d<"u"&&(I.metadata.x0=Math.floor(d)),P[0]=I;if(R++,A=I?I.metadata:A,C=C||I?.td.offsetHeight,R*C>e)break}}return this._clean_rows(R),{tds:P,ridx:R,metadata:A,row_height:C}}clean({ridx:e,cidx:t}){this._clean_rows(e),this._clean_columns(t)}},wr=class{constructor(e,t,o){this.clear(o);let[n]=o.children,[s,d]=n.children;this.table=n,this._column_sizes=t,this.header=new Io(t,e,s),this.body=new Po(t,e,d),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(e){e.innerHTML=xr`
            <table cellspacing="0">
                <thead></thead>
                <tbody></tbody>
            </table>
        `}autosize_cells(e,t){for(;e.length>0;){let[o,n]=e.pop(),s=o.getBoundingClientRect();if(!s||(this._column_sizes.row_height=t||Math.max(10,Math.min(this._column_sizes.row_height||s.height,s.height)),!n))continue;this._column_sizes.indices[n.size_key]=s.width;let d=this._column_sizes.override[n.size_key]!==void 0;s.width&&!d&&(this._column_sizes.auto[n.size_key]=s.width),o.style.minWidth==="0px"&&(o.style.minWidth=`${s.width}px`)}}async*draw(e,t,o,n,s,d){let{width:f,height:p}=e,{view:m,config:w}=t,{data:g,row_headers:E,column_headers:C,metadata:A,num_row_headers:S,num_column_headers:P,column_header_merge_depth:R,merge_headers:B="both"}=await m(Math.floor(s.start_col),Math.floor(s.start_row),Math.ceil(s.end_col),Math.ceil(s.end_row)),j=B==="both"||B==="row",y=B==="both"||B==="column",{start_row:ne=0,start_col:I=0,end_col:Ee=0,end_row:q=0}=s;E&&(this._row_headers_length=E.reduce((oe,ie)=>Math.max(oe,ie.length),0),E=E.map(oe=>(oe.length=this._row_headers_length,oe))),S!==void 0?t.config.row_pivots=Array(S).fill(0):t.config.row_pivots=Array(E?.[0]?.length||0).fill(0),P!==void 0?t.config.column_pivots=Array(P).fill(0):t.config.column_pivots=Array(C?.[0]?.length||0).fill(0);let U=this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(s.start_col)]||0,F={viewport_width:0,selected_id:o,ridx_offset:ne,sub_cell_offset:U,x0:I,x1:Ee,y1:q,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},le,K=0,ae=[],de=!0;if(E?.length>0){let oe=w.row_pivots.join(","),ie={column_name:oe,cidx:0,column_data:E,row_headers:E,first_col:de},we=K+Math.floor(I);le=this.body.draw(p,ie,{...F,x0:0},!0,void 0,void 0,we,j);let Ne=[];for(let fe=0;fe<t.config.row_pivots.length;fe++){let me=this.header.draw(oe,Array(t.config.column_pivots.length).fill(""),1,void 0,fe,I,fe,R,y);me&&Ne.push(me)}if(de=!1,F.viewport_width+=Ne.reduce((fe,{th:me},Re)=>fe+(this._column_sizes.indices[Re]||me.offsetWidth),0),F.row_height=F.row_height||le.row_height,K=E[0].length,!n)for(let fe=0;fe<t.config.row_pivots.length;fe++){let{td:me,metadata:Re}=le.tds[fe]||{},{th:Te,metadata:De}=Ne[fe]||{};(me||Te)&&ae.push([Te||me,De||Re])}}try{let oe=0,ie=d-s.start_col;for(;oe<ie;){if(!g[oe]){let Le=Math.max(s.end_col,0);s.start_col=Le;let ze=0,He=0;for(;this._column_sizes.indices.length>K+I+ze+1&&He+F.viewport_width<f;)ze++,He+=this._column_sizes.indices[K+I+ze];if(He+F.viewport_width<f){let ye=Math.min(d,Le+5);s.end_col=Math.max(1,Math.min(d,ye))}else s.end_col=Math.max(1,Math.min(d,Le+ze));let $e=m(Math.floor(s.start_col),Math.floor(s.start_row),Math.ceil(s.end_col),Math.ceil(s.end_row));yield void 0;let be=await $e;if(typeof be.column_header_merge_depth<"u"&&(R=be.column_header_merge_depth),typeof be.merge_headers<"u"&&(B=be.merge_headers),be.data.length===0){yield ae;return}s.end_col=s.start_col+be.data.length;for(let ye=0;ye<be.data.length;ye++)g[oe+ye]=be.data[ye],be.metadata&&(A[oe+ye]=be.metadata[ye]),C&&(C[oe+ye]=be.column_headers?.[ye])}let we=C?.[oe]||"",Ne=g[oe],fe=A?.[oe],me={column_name:we,cidx:K,column_data:Ne,column_data_listener_metadata:fe,row_headers:E,first_col:de},Re=oe+I,Te=K+Math.floor(I),De=this.header.draw(void 0,we,void 0,Re,Te,I,K,R,y);if(le=this.body.draw(p,me,F,!1,Re,I,Te,j),de=!1,!n)for(let{td:Le,metadata:ze}of le.tds)ae.push([De?.th||Le,De?.metadata||ze]);let Be=this._column_sizes.indices[K+Math.floor(I)];if(Be?F.viewport_width+=Be:F.viewport_width+=De?.th?.offsetWidth||le.tds.reduce((Le,ze)=>Le+ze.td?.offsetWidth,0),F.row_height=F.row_height||le.row_height,K++,oe++,F.viewport_width-F.sub_cell_offset>f){this.body.clean({ridx:le?.ridx||0,cidx:K}),this.header.clean(),yield ae,F.viewport_width=0;for(let[Le]of ae)F.viewport_width+=Le.offsetWidth;if(F.viewport_width-F.sub_cell_offset>f)return}}this.body.clean({ridx:le?.ridx||0,cidx:K}),this.header.clean(),yield ae}finally{this.body.clean({ridx:le?.ridx||0,cidx:K}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},Wo=["both","horizontal","vertical","none"],Fo=class extends To{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new wr(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let e=0;e<this.table_model.header.num_columns();e++){let t=this.table_model.header.get_column_header(e);t.style.minWidth="",t.style.maxWidth=""}}clear(){this.table_model=new wr(this._table_clip,this._column_sizes,this)}addStyleListener(e){this._style_callbacks=this._style_callbacks.concat(e);let t=!0;return()=>{if(!t)return;t=!1;let o=this._style_callbacks=this._style_callbacks.slice(),n=o.indexOf(e);o.splice(n,1)}}removeStyleListener(e){let t=this._style_callbacks.length;this._style_callbacks=this._style_callbacks.filter(o=>o!==e),console.assert(this._style_callbacks.length===t-1,"No listener found")}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(e){if(!(typeof e>"u")){if(e instanceof HTMLElement)return Ge.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){let t=this.table_model.body._fetch_cell(e.y,e.row_header_x);return this.getMeta(t)}}else if(e.column_header_y>=0){if(e.column_header_y<this._view_cache.config.column_pivots.length){let t=this.table_model.body._fetch_cell(e.column_header_y,e.y);return this.getMeta(t)}}else return this.getMeta(this.table_model.body._fetch_cell(e.dy,e.dx+this.table_model._row_headers_length))}}getDrawFPS(){return Mo()}async scrollToCell(e,t){if(!this._view_cache){console.warn("data listener not configured");return}let o=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length*o,s=(this._table_clip.offsetHeight-n)%o,d=(this._virtual_panel.offsetHeight-s)/this._nrows;this.scrollTop=Math.ceil(d*t);let f=0;for(;e>0;)e--,f+=this._column_sizes.indices[e+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(f),await new Promise(requestAnimationFrame),await this._draw_flush()}setDataListener(e,{virtual_mode:t="both",preserve_state:o=!1}={}){console.assert(Wo.indexOf(t)>-1,`Unknown virtual_mode ${t};  valid options are "both" (default), "horizontal", "vertical" or "none"`);let n=this._virtual_mode!==t;if(o)console.assert(!n,"preserve_state called with modified virtual_mode"),this._view_cache.view=e;else{let s={row_pivots:[],column_pivots:[]};this._virtual_mode=t,this._invalid_schema=!0,this._view_cache={view:e,config:s},n&&this._setup_virtual_scroll()}}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",Fo);var ve=Symbol("Plugin Symbol");function Uo(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function Gt(e,t,o){let n=Array.from(e.children[0].children[0].children),s=n.length,d=t.hasAttribute("settings");if(s<=1?n[0]?.removeAttribute("id"):n.forEach((f,p)=>{let m=d?1:0,w=p===s-(m+1)?"psp-column-titles":p===s-m?"psp-column-edit-buttons":null;w?f.setAttribute("id",w):f.removeAttribute("id")}),t.classList.toggle("psp-menu-open",!!o),d&&s>=2){let f=Array.from(n[s-2].children),p=Array.from(n[s-1].children);if(f&&p){n.slice(0,s-2).forEach(m=>{Array.from(m.children).forEach(w=>{w.classList.toggle("psp-menu-open",!1)})});for(let m=0;m<f.length;m++){let w=f[m],g=p[m],E=w.textContent===o;if(w.classList.toggle("psp-menu-open",E),g.classList.toggle("psp-menu-open",E),this._config.columns.length>1)for(let C of e.querySelectorAll("td")){let A=e.getMeta(C),S=A.column_header[A.column_header.length-2]===o;C.classList.toggle("psp-menu-open",S)}}}}}function Mr(e,t){let o=Array.from(e.children[0].children[0].children);if(o.length>0){Gt.call(this,e,t,this._column_settings_selected_column);let[n]=o.splice(this._config.split_by.length,1);n&&Lr.call(this,e,n,!1);let[s]=o.splice(this._config.split_by.length,1);s&&Lr.call(this,e,s,!0)}}function Lr(e,t,o){let n=e._view_cache.config.row_pivots.length-1;for(let s of t.children){let d=e.getMeta(s),f=d.column_header?.[this._config.split_by.length],p=this._config.sort.find(P=>P[0]===f),m=d.row_header_x===n,w=typeof d.x>"u";m=m||(d.x+1)%this._config.columns.length===0,s.classList.toggle("psp-header-border",m),s.classList.toggle("psp-header-group",!1),s.classList.toggle("psp-header-leaf",!0),s.classList.toggle("psp-is-top",!1),s.classList.toggle("psp-header-corner",w),s.classList.toggle("psp-header-sort-asc",!o&&!!p&&p[1]==="asc"),s.classList.toggle("psp-header-sort-desc",!o&&!!p&&p[1]==="desc"),s.classList.toggle("psp-header-sort-col-asc",!o&&!!p&&p[1]==="col asc"),s.classList.toggle("psp-header-sort-col-desc",!o&&!!p&&p[1]==="col desc"),s.classList.toggle("psp-header-sort-abs-asc",!o&&!!p&&p[1]==="asc abs"),s.classList.toggle("psp-header-sort-abs-desc",!o&&!!p&&p[1]==="desc abs"),s.classList.toggle("psp-header-sort-abs-col-asc",!o&&!!p&&p[1]==="col asc abs"),s.classList.toggle("psp-header-sort-abs-col-desc",!o&&!!p&&p[1]==="col desc abs");let g=Uo.call(this,d),E=g==="integer"||g==="float",C=g==="string",A=g==="date",S=g==="datetime";s.classList.toggle("psp-align-right",E),s.classList.toggle("psp-align-left",!E),s.classList.toggle("psp-menu-enabled",(C||E||A||S)&&!w&&d.column_header_y==this._config.split_by.length+1),s.classList.toggle("psp-sort-enabled",(C||E||A||S)&&!w&&d.column_header_y===this._config.split_by.length),s.classList.toggle("psp-is-width-override",e._column_sizes?.override[d.size_key]!==void 0)}}function Sr(e){let t=e._view_cache.config.row_pivots.length-1,o=Array.from(e.children[0].children[0].children),n=[],s=new Set,d=e.children[0];for(let f=0;f<o.length;f++){let p=d.rows[f],m=new Set;for(let w=0;w<p.cells.length;w++){let g=p.cells[w];g.style.backgroundColor="";let E=e.getMeta(g),C=t>0&&E.row_header_x===t||E.x>=0;g.classList.toggle("psp-align-right",!1),g.classList.toggle("psp-align-left",!1),g.classList.toggle("psp-header-group",!0),g.classList.toggle("psp-header-leaf",!1),g.classList.toggle("psp-header-border",C),g.classList.toggle("psp-header-group-corner",typeof E.x>"u"),g.classList.toggle("psp-color-mode-bar",!1),g.classList.toggle("psp-header-sort-asc",!1),g.classList.toggle("psp-header-sort-desc",!1),g.classList.toggle("psp-header-sort-col-asc",!1),g.classList.toggle("psp-header-sort-col-desc",!1),g.classList.toggle("psp-sort-enabled",!1);let A=p.cells[w],S=w,P,R;for(;n[f]&&n[f][S];++S);for(m.add(S),P=S;P<S+A.colSpan;++P)for(R=f;R<f+A.rowSpan;++R)n[R]||(n[R]=[]),n[R][P]=!0;A.classList.toggle("psp-is-top",f===0||!s.has(P))}s=m}}function zr(e,t,[,,,,,o,n],[,,,,,s,d],f){let p=this._ids?.[e.dy]?.join("|"),m=(f?e.column_header.slice(0,-1):e.column_header).join("|");if(this.last_reverse_columns?.has(m)&&this.last_reverse_ids?.has(p)){let w=this.last_reverse_ids?.get(p),g=this.last_reverse_columns.get(m);this._is_old_viewport?this.last_meta?.[g]?.[w]>e.user?(t.style.setProperty("--pulse--background-color-start",s),t.style.setProperty("--pulse--background-color-end",d),t.style.animationName==="pulse_neg"?t.style.animation="pulse_neg2 0.5s linear":t.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[g]?.[w]<e.user?(t.style.setProperty("--pulse--background-color-start",o),t.style.setProperty("--pulse--background-color-end",n),t.style.animationName==="pulse_pos"?t.style.animation="pulse_pos2 0.5s linear":t.style.animation="pulse_pos 0.5s linear"):w!==e.dy&&(t.style.animation=""):t.style.animation=""}else t.style.animation=""}var $t=Lt(ft(),1);function qt(e,t){return $t.default.mix(e,`rgb(${t[0]},${t[1]},${t[2]})`,.5).hex()}function Fe([e,t,o,n],s=[255,255,255]){function d(f,p){return((1-n)*(s[f]/255)+n*(p/255))*255}return[d(0,e),d(1,t),d(2,o)]}function Ue([e,t,o]){return Math.sqrt(e*e*.299+t*t*.587+o*o*.114)>130?"#161616":"#ffffff"}function Ho(e){let[t,o,n]=e.rgb(),[s,d,f]=e.set("hsl.h",(e.get("hsl.h")-15)%360).rgb(),[p,m,w]=e.set("hsl.h",(e.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${s},${d},${f}),rgb(${t},${o},${n}) 50%,rgb(${p},${m},${w}))`}function Se(e){let t=(0,$t.default)(e),o=Ho(t),n=t.rgb();return[e,...n,o,`rgba(${n[0]},${n[1]},${n[2]},1)`,`rgba(${n[0]},${n[1]},${n[2]},0)`]}function Or(e,t,o,n){let s=o.user>0,d=o.user<0,f;e?.pos_bg_color!==void 0?f=e.pos_bg_color:f=this._pos_bg_color;let p;e?.neg_bg_color!==void 0?p=e.neg_bg_color:p=this._neg_bg_color;let m=s?f:d?p:["",...this._plugin_background,""];{let[S,P,R,B,j]=m;if(t.style.position="",o._is_hidden_by_aggregate_depth)t.style.animation="",t.style.backgroundColor="";else if(e?.number_bg_mode==="color")t.style.animation="",t.style.backgroundColor=S;else if(e?.number_bg_mode==="gradient"){let y=Math.max(0,Math.min(1,Math.abs(o.user/e.bg_gradient))),ne=this._plugin_background,I=Ue(Fe([P,R,B,y],ne));t.style.animation="",t.style.color=I,t.style.backgroundColor=`rgba(${P},${R},${B},${y})`}else e?.number_bg_mode==="pulse"?(zr.call(this,o,t,f,p,n),t.style.backgroundColor=""):(e?.number_bg_mode==="disabled"||e?.number_bg_mode,t.style.animation="",t.style.backgroundColor="")}let[w,g,E,C,A]=e?.pos_fg_color!==void 0?s?e.pos_fg_color:d?e.neg_fg_color:["",...this._plugin_background,""]:s?this._pos_fg_color:d?this._neg_fg_color:["",...this._plugin_background,""];if(o._is_hidden_by_aggregate_depth)t.style.backgroundColor="",t.style.color="";else if(e?.number_fg_mode==="disabled")if(e?.number_bg_mode==="color"){let S=this._plugin_background,P=Ue(Fe([m[1],m[2],m[3],1],S));t.style.color=P}else e?.number_bg_mode==="gradient"||(t.style.color="");else e?.number_fg_mode==="bar"?(t.style.color="",t.style.position="relative",A!==""&&t.children.length>0&&t.children[0].nodeType===Node.ELEMENT_NODE&&(t.children[0].style.background=A)):(e?.number_fg_mode==="color"||!e?.number_fg_mode)&&(t.style.color=w)}var Yt=Lt(ft(),1);function Cr(e,t,o){let n=o.column_header?.[this._config.split_by.length],[s,d,f,p,m]=e?.color!==void 0?e.color:this._color;if(o._is_hidden_by_aggregate_depth)t.style.backgroundColor="",t.style.color="";else if(e?.string_color_mode==="foreground"&&o.user!==null)t.style.color=s,t.style.backgroundColor="",e?.format==="link"&&(t.children[0].style.color=s);else if(e?.string_color_mode==="background"&&o.user!==null){let w=this._plugin_background,g=Ue(Fe([d,f,p,1],w));t.style.color=g,t.style.backgroundColor=s}else if(e?.string_color_mode==="series"&&o.user!==null){this._series_color_map.has(n)||(this._series_color_map.set(n,new Map),this._series_color_seed.set(n,0));let w=this._series_color_map.get(n);if(!w.has(o.user)){let I=this._series_color_seed.get(n);w.set(o.user,I),this._series_color_seed.set(n,I+1)}let g=w.get(o.user),[E,C,A]=(0,Yt.default)(s).hsl();E=E+g*150%360;let S=(0,Yt.default)(E,C,A,"hsl"),[P,R,B]=S.rgb(),j=S.hex(),y=this._plugin_background,ne=Ue(Fe([P,R,B,1],y));t.style.color=ne,t.style.backgroundColor=j}else t.style.backgroundColor="",t.style.color=""}var Ss=Lt(ft(),1);function Nr(e,t,o){let n=o.column_header?.[this._config.split_by.length],[s,d,f,p,m]=e?.color!==void 0?e.color:this._color;if(o._is_hidden_by_aggregate_depth)t.style.backgroundColor="",t.style.color="";else if(e?.datetime_color_mode==="foreground"&&o.user!==null)t.style.color=s,t.style.backgroundColor="";else if(e?.datetime_color_mode==="background"&&o.user!==null){let w=this._plugin_background,g=Ue(Fe([d,f,p,1],w));t.style.color=g,t.style.backgroundColor=s}else t.style.backgroundColor="",t.style.color=""}function Ar(e,t,o){if(o._is_hidden_by_aggregate_depth)t.style.backgroundColor="",t.style.color="";else{let[n]=o.user===!0?this._pos_fg_color:o.user===!1?this._neg_fg_color:["",0,0,0,""];t.style.backgroundColor="",t.style.color=n}}function Rr(e,t,o){let n=typeof o.value!=null&&typeof o.value!=null&&o.value?.toString()?.trim().length>0,s=o.row_header_x>=this._config.group_by.length,d=e.getMeta({dx:0,dy:o.y-o.y0+1}),f=d&&d.row_header&&typeof d.row_header[o.row_header_x+1]<"u";t.classList.toggle("psp-tree-label",n&&!s),t.classList.toggle("psp-tree-label-expand",n&&!s&&!f),t.classList.toggle("psp-tree-label-collapse",n&&!s&&f),t.classList.toggle("psp-tree-leaf",n&&s)}function jo(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function Tr(e,t){let o=e[ve]||{},n=t.hasAttribute("settings");for(let s of e.children[0].children[1].children)for(let d of s.children){let f=e.getMeta(d),p=f.column_header?.[this._config.split_by.length],m=jo.call(this,f),w=o[p],g=m==="integer"||m==="float";f._is_hidden_by_aggregate_depth=(C=>C===0?!1:C-1<Math.min(this._config.group_by.length,w?.aggregate_depth))(f.row_header?.filter(C=>C!==void 0)?.length),g?Or.call(this,w,d,f,n):m==="boolean"?Ar.call(this,w,d,f):m==="string"?Cr.call(this,w,d,f):m==="date"||m==="datetime"?Nr.call(this,w,d,f):(d.style.backgroundColor="",d.style.color=""),d.classList.toggle("psp-bool-type",m==="boolean"&&f.user!==null);let E=d.tagName==="TH";E&&Rr.call(this,e,d,f),s.dataset.y=f.y,f.row_header_x===void 0||f.row_header_x===f.row_header.length-1||f.row_header[f.row_header_x+1]===void 0?(d.dataset.y=f.y,d.dataset.x=f.x):(delete d.dataset.y,delete d.dataset.x),d.classList.toggle("psp-null",f.value===null),d.classList.toggle("psp-align-right",!E&&g),d.classList.toggle("psp-align-left",E||!g),d.classList.toggle("psp-color-mode-bar",w?.number_fg_mode==="bar"&&g)}}async function Dr(e,t,o,n){let d=e.getMeta(n).column_header[this._config.split_by.length],f=o.ctrlKey||o.metaKet||o.altKey?Go:$o,p=o.shiftKey,m=f.call(this,d,p);await t.restore({sort:m})}function Go(e,t){let o=[],n=!1;for(let s of this._config.sort){let[d,f]=s;if(d===e){n=!0;let p=Ir.call(this,e,f,t);p&&o.push(p)}else o.push(s)}return n||o.push([e,t?"desc abs":"desc"]),o}function $o(e,t){for(let[o,n]of this._config.sort)if(o===e){let s=Ir.call(this,e,n,t);return s?[s]:[]}return[[e,t?"desc abs":"desc"]]}function Ir(e,t,o){let s=this._config.split_by.length>0?Yo:qo,d=t?s[t]:"desc";if(d)return[e,d]}var qo={desc:"asc",asc:void 0,"desc abs":"asc abs","asc abs":void 0},Yo={desc:"asc",asc:"col desc","desc abs":"asc abs","asc abs":"col desc abs","col desc":"col asc","col asc":void 0,"col desc abs":"col asc abs","col asc abs":void 0};async function Pr(e,t){let o=e.getMeta(t.target),n=t.target.classList.contains("psp-tree-label-collapse");t.shiftKey&&n?this._view.set_depth(o.row_header.filter(s=>s!==void 0).length-2):t.shiftKey?this._view.set_depth(o.row_header.filter(s=>s!==void 0).length-1):n?this._view.collapse(o.y):this._view.expand(o.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),e.draw()}async function Wr(e,t,o){if(o.which!==1)return;let n=o.target;if(n.tagName!=="A"){for(;n.tagName!=="TD"&&n.tagName!=="TH";)if(n=n.parentElement,!e.contains(n))return;if(n.classList.contains("psp-tree-label")){Pr.call(this,e,o);return}if(n.classList.contains("psp-menu-enabled")){let d=e.getMeta(n).column_header?.[this._config.split_by.length];await t.toggleColumnSettings(d)}else n.classList.contains("psp-sort-enabled")&&Dr.call(this,e,t,o,n)}}function Fr(e,t){if(t.which!==1)return;let o=t.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!e.contains(o))return;(o.classList.contains("psp-tree-label")&&t.offsetX<26||o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner"))&&t.stopImmediatePropagation()}function Ur(e,t=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),s=t||e.querySelector("perspective-viewer-datagrid").dataset.editMode==="EDIT";return o&&!n&&s}function Hr(e,t,o){let n=e[ve]||{},s=Ur.call(this,t);o.classList.toggle("edit-mode-allowed",Ur.call(this,t,!0));for(let d of e.querySelectorAll("td")){let f=e.getMeta(d),p=this.get_psp_type(f);if(s&&this._is_editable[f.x]){let m=f.column_header[this._config.split_by.length];p==="string"&&n[m]?.format==="link"?(d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",!1)):p==="boolean"?(d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",f.user!==null)):(s!==d.hasAttribute("contenteditable")&&d.toggleAttribute("contenteditable",s),d.classList.toggle("boolean-editable",!1))}else d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",!1)}}var St=(e,t,o)=>{let n=e.querySelectorAll("td"),s=o.get(e),d=e.getRootNode();if(s){for(let f of n){let p=e.getMeta(f);if(p.x===s.x&&p.y===s.y)return d.activeElement!==f&&f.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&e.contains(d.activeElement)&&d.activeElement.blur()}};function Bt(e,t,o){let n=e.getMeta(o),s=t._schema[t._column_paths[n.x]];if(n){let d=o.textContent,f=t._ids[n.y-n.y0][0];if(s==="float"||s==="integer"){if(d=parseFloat(d.replace(/,/g,"")),isNaN(d))return!1}else if(s==="date"||s==="datetime"){if(d=Date.parse(d),isNaN(d))return!1}else s==="boolean"&&(d=d==="true"?!1:d==="false"?!0:null);let p={__INDEX__:f,[t._column_paths[n.x]]:d};return t._table.update([p],{port_id:t._edit_port}),!0}}function jr(e,t,o){let n=e.getMeta(o.target);if(typeof n?.x<"u"){let s=this._is_editable[n.x],d=this.get_psp_type(n)==="boolean",f=o.target.classList.contains("psp-null");s&&d&&!f&&Bt(e,this,o.target)}}function Vo(e){let t;return async function(...o){if(t&&await t&&t)return;let n;t=new Promise(s=>n=s),await e.apply(this,o),t=void 0,n()}}function Gr(){if(this.isContentEditable){let e=this.getRootNode().getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(this),t.setEnd(e.endContainer,e.endOffset),t.toString().length}else return this.target.selectionStart}var Ye=Vo(async function(e,t,o,n,s){let d=e.getMeta(o),f=this._column_paths.length,p=this._num_rows,m=t.get(e);if(!m)return;d.x+n<f&&0<=d.x+n&&(m.x=d.x+n),d.y+s<p&&0<=d.y+s&&(m.y=d.y+s);let w=Math.max(d.x0-10,0),g=Math.min(d.x0+10,f),E=Math.max(d.y0-5,0),C=Math.min(d.y0+10,p),A=d.x0+n,S=d.y0+s;for(;!St(e,void 0,t)&&A>=w&&A<g&&S>=E&&S<C;)await e.scrollToCell(A,S,f,p),t.set(e,m),A+=n,S+=s});function Xo(e,t,o){return t.getMeta(o).y===e._num_rows-1}function $r(e,t,o,n){let s=e.getRootNode().activeElement;switch(n.target.classList.remove("psp-error"),n.key){case"Enter":n.preventDefault(),Xo(this,e,s)?(s.blur(),o.delete(e)):n.shiftKey?Ye.call(this,e,o,s,0,-1):Ye.call(this,e,o,s,0,1);break;case"ArrowLeft":Gr.call(s)==0&&(n.preventDefault(),Ye.call(this,e,o,s,-1,0));break;case"ArrowUp":n.preventDefault(),Ye.call(this,e,o,s,0,-1);break;case"ArrowRight":Gr.call(s)==s.textContent.length&&(n.preventDefault(),Ye.call(this,e,o,s,1,0));break;case"ArrowDown":n.preventDefault(),Ye.call(this,e,o,s,0,1);break;default:}}function zt(e,t=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),s=t||e.children[0]._edit_mode==="EDIT";return o&&!n&&s}function qr(e,t,o,n){if(this._edit_mode==="EDIT"){if(!zt.call(this,t))return;$r.call(this,e,t,o,n)}else console.debug(`Mode ${this._edit_mode} for "keydown" event not yet implemented`)}function Yr(e,t,o){if(this._edit_mode==="EDIT"){if(!zt.call(this,t))return;jr.call(this,e,t,o)}else this._edit_mode==="READ_ONLY"||this._edit_mode==="SELECT_COLUMN"||this._edit_mode==="SELECT_ROW"||this._edit_mode==="SELECT_REGION"||console.debug(`Mode ${this._edit_mode} for "click" event not yet implemented`)}function Br(e,t,o,n){if(zt.call(this,t)&&o.has(e)){n.target.classList.remove("psp-error");let s=o.get(e);o.delete(e),s.content!==n.target.textContent&&(Bt(e,this,n.target)||(n.target.textContent=s.content,n.target.classList.add("psp-error"),n.target.focus()))}}function Vr(e,t,o,n){let s=e.getMeta(n.target);if(s){let d={x:s.x,y:s.y,content:n.target.textContent};o.set(e,d)}}async function ut({_view:e,_config:t},o,n){let s=t.group_by,d=t.split_by,f=o>=0?o:0,p=f+1,m=await e.to_json({start_row:f,end_row:p}),g=m.map(B=>B.__ROW_PATH__)[0]||[],E=s.map((B,j)=>{let y=g[j];return y?[B,"==",y]:void 0}).filter(B=>B),C=s.length>0?n+1:n,A=Object.keys(m[0])[C],S={row:m[0]},P=[];if(A){let B=A.split("|");S.column_names=[B[d.length]],P=d.map((j,y)=>{let ne=B[y];return ne?[j,"==",ne]:void 0}).filter(j=>j).filter(([,,j])=>j!=="__ROW_PATH__")}let R=t.filter.concat(E).concat(P);return S.config={filter:R},S}async function Xr(e,t,o,n){let s=e.getMeta(n.target);if(!t.hasAttribute("selectable")||n.handled||n.which!==1||!s)return;let d=this._ids?.[s.y-s.y0];if(s&&s.y>=0){let f=o.get(e),p=!!f&&f.reduce((A,S,P)=>A&&S===d[P],!0),m=!!f&&d.length===f.length&&p,w={selected:!m},{row:g,column_names:E,config:C}=await ut(this,s.y,s.x);m?(o.delete(e),w={...w,row:g,config:{filter:structuredClone(this._config.filter)}}):(o.set(e,d),w={...w,row:g,column_names:E,config:C}),await e.draw({preserve_width:!0}),n.handled=!0,t.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:w}))}}function Kr(e,t,o){if(!t.hasAttribute("selectable"))return;let n=o.has(e),s=o.get(e);for(let d of e.querySelectorAll("td"))if(!n)d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let f=e.getMeta(d),p=this._ids[f.y-f.y0],m=s.reduce((w,g,E)=>w&&g===p[E],!0);d.classList.toggle("psp-row-selected",p.length===s.length&&m),d.classList.toggle("psp-row-subselected",p.length!==s.length&&m)}for(let d of e.querySelectorAll("tbody th")){let f=e.getMeta(d),p=this._ids[f.y-f.y0];if(!n||p[f.row_header_x])d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let m=s.reduce((w,g,E)=>w&&g===p[E],!0);d.classList.toggle("psp-row-selected",p.length===s.length&&m),d.classList.toggle("psp-row-subselected",p.length!==s.length&&m)}}}async function Jr(e,t,o){o.delete(e);for(let n of e.querySelectorAll("td,th"))n.classList.toggle("psp-row-selected",!1),n.classList.toggle("psp-row-subselected",!1)}var io=Lt(ft(),1);var Zr={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(e){return e?"true":"false"}}},Jo={types:{float:{format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},datetime:{format:{dateStyle:"short",timeStyle:"medium"}},date:{format:{dateStyle:"short"}}}},Ot=class{constructor(){this._formatters=new Map}create_datetime_formatter(t,o){let n={dateStyle:"short",timeStyle:"medium"};if(o.date_format?.format!=="custom"){let s={...n,timeZone:o.date_format?.timeZone,dateStyle:o.date_format?.dateStyle,timeStyle:o.date_format?.timeStyle};return s.dateStyle==="disabled"?s.dateStyle=void 0:s.dateStyle===void 0&&(s.dateStyle="short"),s.timeStyle==="disabled"?s.timeStyle=void 0:s.timeStyle===void 0&&(s.timeStyle="medium"),new Intl.DateTimeFormat(navigator.languages,s)}else{let s={timeZone:o.date_format?.timeZone,second:o.date_format?.second,minute:o.date_format?.minute,hour:o.date_format?.hour,day:o.date_format?.day,weekday:o.date_format?.weekday,month:o.date_format?.month,year:o.date_format?.year,hour12:o.date_format?.hour12,fractionalSecondDigits:o.date_format?.fractionalSecondDigits};return s.year==="disabled"?s.year=void 0:s.year===void 0&&(s.year="2-digit"),s.month==="disabled"?s.month=void 0:s.month===void 0&&(s.month="numeric"),s.day==="disabled"?s.day=void 0:s.day===void 0&&(s.day="numeric"),s.weekday==="disabled"&&(s.weekday=void 0),s.hour==="disabled"?s.hour=void 0:s.hour===void 0&&(s.hour="numeric"),s.minute==="disabled"?s.minute=void 0:s.minute===void 0&&(s.minute="numeric"),s.second==="disabled"?s.second=void 0:s.second===void 0&&(s.second="numeric"),s.hour12===void 0&&(s.hour12=!0),new Intl.DateTimeFormat(navigator.languages,s)}}create_date_formatter(t,o){let n={dateStyle:o.date_format?.dateStyle,timeZone:"utc"};return n.dateStyle==="disabled"?n.dateStyle=void 0:n.dateStyle===void 0&&(n.dateStyle="short"),new Intl.DateTimeFormat(navigator.languages,n)}create_number_formatter(t,o){let n=Jo.types[t]?.format;return o.number_format!==void 0&&(n=o.number_format),new Zr[t](navigator.languages,n)}create_boolean_formatter(t,o){return new Zr[t](navigator.languages,{})}get(t,o){let n=[t,...Object.values(o.date_format??{}),...Object.values(o.number_format??{})].join("-");return this._formatters.has(n)||(t==="date"?this._formatters.set(n,this.create_date_formatter(t,o)):t==="datetime"?this._formatters.set(n,this.create_datetime_formatter(t,o)):t==="integer"||t==="float"?this._formatters.set(n,this.create_number_formatter(t,o)):t==="boolean"?this._formatters.set(n,this.create_boolean_formatter(t,o)):this._formatters.set(n,!1)),this._formatters.get(n)}};var eo=new Ot,Qr=1;function to(e,t){return eo.get(e,t)}function pt(e,t,o={},n=!1){if(t===null)return null;let s=n&&this._table_schema[e]||this._schema[e]||"string",d=o[e]||{};if((s==="integer"||s==="float")&&d?.number_fg_mode==="bar"){let p=Math.max(0,Math.min(Qr,Math.abs(t/d.fg_gradient)*Qr)),m=this._div_factory.get(),w=t>=0?"left":"right",g=(p*100).toFixed(2);return m.setAttribute("style",`width:calc(${g}% - 4px);position:absolute;${w}:2px;height:80%;top:10%;pointer-events:none;`),m}else if(d?.format==="link"&&s==="string"){let p=document.createElement("a");return p.setAttribute("href",t),p.setAttribute("target","_blank"),p.textContent=t,p}else if(d?.format==="bold"&&s==="string"){let p=document.createElement("b");return p.textContent=t,p}else if(d?.format==="italics"&&s==="string"){let p=document.createElement("i");return p.textContent=t,p}else{let p=eo.get(s,d);return p?p.format(t):t}}function*ro(e=[],t,o){let n=o[ve];for(let s of e){s=["TOTAL",...s];let d=s[s.length-1];s=s.slice(0,s.length-1).fill("");let f=pt.call(this,t[s.length-1],d,n,!0);f instanceof HTMLElement?s=s.concat(f):s=s.concat({toString:()=>f}),s.length=t.length+1,yield s}}function*oo(e=[],t,o){let n=o[ve];for(let s of e){let d=[""];for(let f in s)d.push(pt.call(this,t[f],s[f],n,!0));yield s}}function so(e){let t,o,n,s,d;return async function(p,m,w,g,E){let C={},A;if(g-m>0&&E-w>0){if(this._is_old_viewport=this._last_window?.start_row===w&&this._last_window?.end_row===E&&this._last_window?.start_col===m&&this._last_window?.end_col===g,A={start_row:w,start_col:m,end_row:E,end_col:g,id:!0},this._config.split_by?.length>0){let[q,U]=await Promise.all([this._view.to_columns_string(A),this._view.column_paths(A)]);C=JSON.parse(q);let F=U.filter(K=>K!=="__ROW_PATH__"&&K!=="__ID__"),le=this._column_paths.length;if(this._column_paths.splice(A.start_col,F.length,...F),this._column_paths.length!==le){let[K,ae]=await Promise.all([this._view.schema(),this._view.expression_schema()]);this._schema={...K,...ae};for(let de=0;de<F.length;de++){let ie=F[de].split("|")[this._config.split_by.length];this._column_types[de+A.start_col]=this._schema[ie]}}}else C=JSON.parse(await this._view.to_columns_string(A));this._last_window=A,this._ids=C.__ID__||Array(E-w).fill().map((q,U)=>[U+w]),this._reverse_columns=this._column_paths.slice(m,g).reduce((q,U,F)=>(q.set(U,F),q),new Map),this._reverse_ids=this._ids?.reduce((q,U,F)=>(q.set(U?.join("|"),F),q),new Map)}else this._div_factory.clear();let S=[],P=[],R=[],B=[],j=e.hasAttribute("settings");for(let q=m;q<Math.min(g,this._column_paths.length);++q){let U=this._column_paths[q],F=U.split("|"),le=C[U]||new Array(E-w).fill(null),K=Math.min(p[ve]?.[F[this._config.split_by.length]]?.aggregate_depth||0,this._config.group_by.length);S.push(le.map((ae,de)=>C?.__ROW_PATH__?.[de]?.length<K?"":pt.call(this,F[this._config.split_by.length],ae,p[ve]))),P.push(le),j&&F.push(""),R.push(F),B.push(U)}g-m>0&&E-w>0&&(this.last_column_paths=o,this.last_meta=t,this.last_ids=n,this.last_reverse_ids=s,this.last_reverse_columns=d,o=B,t=P,n=this._ids,s=this._reverse_ids,d=this._reverse_columns);let y=C.__ROW_PATH__!==void 0,ne=Array.from((y?ro:oo).call(this,C.__ROW_PATH__,this._config.group_by,p)),I=ne[0]?.length;return{num_column_headers:R[0]?.length||1,num_row_headers:I,num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:ne,column_headers:R,data:S,metadata:P,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}function Ct(e,t,o){let n=window.getComputedStyle(e).getPropertyValue(t).trim();return n.length>0?n:o}var Vt=class{constructor(t){this._name=t,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}};function Zo(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}async function Xt(e,t,o,n={}){let s=await o.get_config();if(this?.model?._config){let U=this.model._config,F=U.group_by.length!==s.group_by.length,le=(U.group_by.length===0||s.group_by.length===0)&&F;if(!F)for(let ie in U.group_by)F||=s.group_by[ie]!==U.group_by[ie];let K=U.split_by.length!==s.split_by.length;if(K)for(let ie in U.split_by)K||=s.split_by[ie]!==U.split_by[ie];let ae=U.columns.length!==s.columns.length;if(ae)for(let ie in U.columns)ae||=s.columns[ie]!==U.columns[ie];let de=U.filter.length!==s.filter.length;if(de)for(let ie in U.filter)for(let we in s.filter[ie])de||=s.filter[ie][we]!==U.filter[ie][we];let oe=U.sort.length!==s.sort.length;if(oe)for(let ie in U.sort)for(let we in s.sort[ie])oe||=s.sort[ie][we]!==U.sort[ie][we];this._reset_scroll_top=F,this._reset_scroll_left=K,this._reset_select=F||K||de||oe||ae,this._reset_column_size=K||F||ae||le}let[d,f,p,m,w,g]=await Promise.all([t.schema(),o.num_rows(),o.schema(),o.expression_schema(),o.column_paths(),this.parentElement.getEditPort()]),E=(0,io.default)(Ct(e,"--plugin--background","#FFFFFF")).rgb(),C=Se(Ct(e,"--rt-pos-cell--color","#338DCD")),A=Se(Ct(e,"--rt-neg-cell--color","#FF5942")),S=Se(qt(C[0],E)),P=Se(qt(A[0],E)),R=Se(Ct(e,"--active--color","#ff0000")),B={...p,...m},j={...d,...m},y=w.filter(U=>U!=="__ROW_PATH__"&&U!=="__ID__"),ne=[],I=[];for(let U of y){let le=U.split("|")[s.split_by.length];I.push(B[le]),ne.push(!!d[le])}let Ee=this._edit_mode||"READ_ONLY";this._edit_button.dataset.editMode=Ee;let q=Object.assign(n,{_edit_port:g,_view:o,_table:t,_table_schema:j,_config:s,_num_rows:f,_schema:B,_ids:[],_plugin_background:E,_color:R,_pos_fg_color:C,_neg_fg_color:A,_pos_bg_color:S,_neg_bg_color:P,_column_paths:y,_column_types:I,_is_editable:ne,_edit_mode:Ee,_selection_state:{selected_areas:[],dirty:!1},_row_header_types:s.group_by.map(U=>j[U]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:Zo});return q._div_factory=q._div_factory||new Vt("div"),e.setDataListener(so(this.parentElement).bind(q,e),{virtual_mode:window.getComputedStyle(e).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),q}async function lo(e,t,o){let n=e.getMeta(o.target);if(!n)return;let{x:s,y:d}=n,{row:f,column_names:p,config:m}=await ut(this,d,s);t.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:f,column_names:p,config:m}}))}var Qo="mouse-selected-area",no=(e,t,{className:o=Qo,selected:n=[]}={})=>(e.model._selection_state={selected_areas:n,dirty:!0},t.addEventListener("mousedown",es(e,t,o)),t.addEventListener("mouseover",ts(e,t,o)),t.addEventListener("mouseup",rs(e,t,o)),t.addStyleListener(()=>gt(e,t,o)),t),es=(e,t,o)=>n=>{if(n.button===0&&(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN")){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={};let s=t.getMeta(n.target);if(s&&s.x!==void 0&&s.y!==void 0){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={x:s.x,y:s.y},e.model._selection_state.old_selected_areas=e.model._selection_state.selected_areas,e.model._selection_state.selected_areas=[];let d={x0:s.x,x1:s.x,y0:s.y,y1:s.y};e.model._selection_state.potential_selection=d,gt(e,t,o,e.model._selection_state.selected_areas.concat([d]));return}}e.model._selection_state.selected_areas=[]},ts=(e,t,o)=>n=>{if((e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN")&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0){let s=t.getMeta(n.target);if(s&&s.x!==void 0&&s.y!==void 0){let d={x0:Math.min(s.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(s.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(s.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(s.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.potential_selection=d,gt(e,t,o,e.model._selection_state.selected_areas.concat([d]))}}},rs=(e,t,o)=>n=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){let s=t.getMeta(n.target);if(e.model._selection_state.old_selected_areas?.length>0){let d=e.model._selection_state.old_selected_areas[0];if(d.x0===d.x1&&d.y0===d.y1&&d.x0===s.x&&d.y0===s.y){e.model._selection_state.selected_areas=[],e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0,gt(e,t,o,[]);return}}if(e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0&&s.x!==void 0&&s.y!==void 0){let d={x0:Math.min(s.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(s.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(s.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(s.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.selected_areas.push(d),gt(e,t,o)}e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0}};function os(e,t,{x0:o,x1:n,y0:s,y1:d}){let f={},p=t.model._edit_mode;o!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(p)>-1&&(f.start_col=o),n!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(p)>-1&&(f.end_col=n+1),s!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(p)>-1&&(f.start_row=s),d!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(p)>-1&&(f.end_row=d+1),e.setSelection(f)}var gt=(e,t,o,n)=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){n=e.model._selection_state.selected_areas.slice(0),e.model._selection_state.potential_selection&&n.push(e.model._selection_state.potential_selection);let s=t.querySelectorAll("tbody td");if(n.length>0)os(e.parentElement,e,n[0]),ss(e,t,n,o);else{e.parentElement.setSelection();for(let d of s)d.classList.remove(o)}}else if(e.model._selection_state.dirty){e.model._selection_state.dirty=!1;let s=t.querySelectorAll("tbody td");for(let d of s)d.classList.remove(o)}},ss=(e,t,o,n)=>{if(e.model._edit_mode==="SELECT_REGION"&&o.length>0){let s=t.querySelectorAll("tbody td");for(let d of s){let f=t.getMeta(d),p=!1;for(let{x0:m,x1:w,y0:g,y1:E}of o)m!==void 0&&g!==void 0&&w!==void 0&&E!==void 0&&m<=f.x&&f.x<=w&&g<=f.y&&f.y<=E&&(p=!0,e.model._selection_state.dirty=!0,d.classList.add(n));p||d.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_ROW"&&o.length>0){let s=t.querySelectorAll("tbody td");for(let d of s){let f=t.getMeta(d),p=!1;for(let{x0:m,x1:w,y0:g,y1:E}of o)m!==void 0&&g!==void 0&&w!==void 0&&E!==void 0&&g<=f.y&&f.y<=E&&(e.model._selection_state.dirty=!0,p=!0,d.classList.add(n));p||d.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_COLUMN"&&o.length>0){let s=t.querySelectorAll("tbody td");for(let d of s){let f=t.getMeta(d),p=!1;for(let{x0:m,x1:w,y0:g,y1:E}of o)m!==void 0&&g!==void 0&&w!==void 0&&E!==void 0&&m<=f.x&&f.x<=w&&(e.model._selection_state.dirty=!0,p=!0,d.classList.add(n));p||d.classList.remove(n)}}};async function ao(e){let t=this.parentElement,o=await t.getTable(!0);if(this._initialized)await Xt.call(this,this.regular_table,o,e,this.model);else{if(this.innerHTML="",this.shadowRoot?this.shadowRoot.appendChild(this.regular_table):this.appendChild(this.regular_table),this.model=await Xt.call(this,this.regular_table,o,e),!this.model)return;no(this,this.regular_table,{className:"psp-select-region"}),this.regular_table.addStyleListener(Tr.bind(this.model,this.regular_table,t)),this.regular_table.addStyleListener(Sr.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(Mr.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("click",Fr.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",Wr.bind(this.model,this.regular_table,t));let n=new WeakMap;this.regular_table.addStyleListener(Kr.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("mousedown",Xr.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("psp-deselect-all",Jr.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("click",lo.bind(this.model,this.regular_table,t));let s=new WeakMap;this.regular_table.addStyleListener(Hr.bind(this.model,this.regular_table,t,this)),this.regular_table.addStyleListener(St.bind(this.model,this.regular_table,t,s)),this.regular_table.addEventListener("click",Yr.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("focusin",Vr.bind(this.model,this.regular_table,t,s)),this.regular_table.addEventListener("focusout",Br.bind(this.model,this.regular_table,t,s)),this.regular_table.addEventListener("keydown",qr.bind(this.model,this.regular_table,t,s)),t.addEventListener("perspective-toggle-column-settings",d=>{if(this.isConnected){if(Gt.call(this.model,this.regular_table,t,d.detail.column_name),!d.detail.open){this.model._column_settings_selected_column=null;return}this.model._column_settings_selected_column=d.detail.column_name}}),this._initialized=!0}}function Nt(e,t=!1){if(!this._initialized)return;t&&(this._cached_column_sizes=e);let o={},{group_by:n,columns:s}=this.model._config,d=n?.length>0?n.length+1:0;for(let f of Object.keys(e))if(f==="__ROW_PATH__")o[d-1]=e[f];else{let p=this.model._column_paths.indexOf(f);o[p+d]=e[f]}this.regular_table._column_sizes.override=o}function At(){if(!this._initialized)return[];if(this._cached_column_sizes){let d=this._cached_column_sizes;return this._cached_column_sizes=void 0,d}let e=this.regular_table._column_sizes.override,{group_by:t,columns:o}=this.model._config,n=t?.length>0?t.length+1:0,s={};for(let d of Object.keys(e))if(e[d]!==void 0){let f=d-n;f>-1?s[this.model._column_paths[f]]=e[d]:f===-1&&(s.__ROW_PATH__=e[d])}return s}var mt=["READ_ONLY","EDIT","SELECT_ROW","SELECT_COLUMN","SELECT_REGION"];function Rt(e=void 0){typeof e>"u"&&(e=mt[(mt.indexOf(this._edit_mode)+1)%mt.length]),this.parentElement?.setSelection(),this._edit_mode=e,this.model&&(this.model._edit_mode=e,this.model._selection_state={selected_areas:[],dirty:!0}),this._edit_button!==void 0&&(this._edit_button.dataset.editMode=e),this.dataset.editMode=e}function Tt(e=void 0){typeof e>"u"&&(e=!this._is_scroll_lock),this._is_scroll_lock=e,this.classList.toggle("sub-cell-scroll-disabled",e),this._scroll_lock!==void 0&&this._scroll_lock.classList.toggle("lock-scroll",e)}function co(e,t){e=JSON.parse(JSON.stringify(e)),t=JSON.parse(JSON.stringify(t));let o={};if(e.columns)for(let[d,f]of Object.entries(e.columns))f.column_size_override!==void 0&&(o[d]=f.column_size_override,delete f.column_size_override);let n={};if(t)for(let[d,f]of Object.entries(t))n[d]={...f,pos_fg_color:f.pos_fg_color?Se(f.pos_fg_color):void 0,neg_fg_color:f.neg_fg_color?Se(f.neg_fg_color):void 0,pos_bg_color:f.pos_bg_color?Se(f.pos_bg_color):void 0,neg_bg_color:f.neg_bg_color?Se(f.neg_bg_color):void 0,color:f.color?Se(f.color):void 0};"edit_mode"in e&&(mt.indexOf(e.edit_mode)!==-1?Rt.call(this,e.edit_mode):console.error("Unknown edit mode "+e.edit_mode)),"scroll_lock"in e&&Tt.call(this,e.scroll_lock);let s=this.regular_table;Nt.call(this,o,!0),s[ve]=n}function _o(){if(this.regular_table){let e={columns:{},scroll_lock:!!this._is_scroll_lock,edit_mode:this._edit_mode},t=At.call(this);for(let o of Object.keys(t||{}))e.columns[o]||(e.columns[o]={}),e.columns[o].column_size_override=t[o];return JSON.parse(JSON.stringify(e))}return{}}async function ho(e){if(this.parentElement&&await this.activate(e),!this.isConnected||this.offsetParent==null||!this.model)return;let t=At.call(this),o=this.regular_table.draw({invalid_columns:!0});this._reset_scroll_top&&(this.regular_table.scrollTop=0,this._reset_scroll_top=!1),this._reset_scroll_left&&(this.regular_table.scrollLeft=0,this._reset_scroll_left=!1),this._reset_select&&(this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this._reset_select=!1),this._reset_column_size&&(this.regular_table._resetAutoSize(),this._reset_column_size=!1),Nt.call(this,t),await o,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function Kt(e,t){return e==="integer"||e==="float"?{datagrid_number_style:{fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled"},number_string_format:!0}:e==="date"||e==="datetime"||e==="string"?{[e==="date"||e==="datetime"?"datagrid_datetime_style":"datagrid_string_style"]:{color:this.model._color[0],bg_color:this.model._color[0]}}:null}var fo='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}regular-table td.psp-null:after,regular-table th.psp-null:after{content:var(--null--content,"-");}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}.psp-header-sort-abs-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-desc-icon--mask-image);mask-image:var(--sort-abs-desc-icon--mask-image);}.psp-header-sort-abs-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-asc-icon--mask-image);mask-image:var(--sort-abs-asc-icon--mask-image);}.psp-header-sort-abs-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-col-desc-icon--mask-image);mask-image:var(--sort-abs-col-desc-icon--mask-image);}.psp-header-sort-abs-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-col-asc-icon--mask-image);mask-image:var(--sort-abs-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table table td.psp-select-region,regular-table table th.psp-select-region{background-color:var(--icon--color)!important;color:var(--plugin--background)!important;border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-select-region.psp-menu-open{box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,"Edit");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}';var Dt=class e extends HTMLElement{static#t=!1;static#e;static renderTarget=window.CSS?.supports&&window.CSS?.supports("selector(:host-context(foo))")?"shadow":"light";constructor(){super(),this.regular_table=document.createElement("regular-table"),this.regular_table.part="regular-table",this._is_scroll_lock=!1,this._edit_mode="READ_ONLY";let t=e;t.#e||(t.#e=new CSSStyleSheet,t.#e.replaceSync(fo)),t.renderTarget==="shadow"?this.attachShadow({mode:"open"}).adoptedStyleSheets.push(t.#e):t.renderTarget==="light"&&!t.#t&&(t.#t=!0,document.adoptedStyleSheets.push(t.#e))}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"));let t=this.parentElement;t&&t.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar?.parentElement?.removeChild?.(this._toolbar)}async activate(t){return await ao.call(this,t)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}can_render_column_styles(t,o){return t!=="boolean"}column_style_controls(t,o){return Kt.call(this,t,o)}async draw(t){return await ho.call(this,t)}async update(t){if(this.model===void 0)await this.draw(t);else if(this.model._config.split_by?.length>0){let o=await t.dimensions();this.model._num_rows=o.num_view_rows,await this.regular_table.draw()}else this.model._num_rows=await t.num_rows(),await this.regular_table.draw()}async render(t){let o=await this.parentElement.getView(),n=await o.to_columns(t),s=await o.column_paths().then(p=>p.slice(t.start_col,t.end_col)),d=t.end_row-t.start_row,f="";for(let p=0;p<d;p++){for(let m of s){let w=n[m],g=this.model._schema[m],E=to(g,this.regular_table[ve][m.split("|").at(-1)]||{});E?f+=E.format(w[p])+"	":f+=w[p]+"	"}f+=`
`}return f.trim()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return _o.call(this)}restore(t,o){return co.call(this,t,o)}async restyle(t){await this.draw(t)}delete(){this._toolbar=void 0,this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}};var uo=':host{position:relative;display:block;height:100%;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:stretch;height:100%;}:host #toolbar .hover-target{margin:0;display:inline-flex;align-items:center;cursor:pointer;}:host #toolbar .hover-target:hover{box-shadow:-4px 0 0 var(--icon--color),4px 0 0 var(--icon--color);background-color:var(--icon--color);}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:"";}#edit_mode[data-edit-mode="READ_ONLY"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--edit--content);}:host(.aggregated) #toolbar #edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="SELECT_ROW"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-row--content);}#edit_mode[data-edit-mode="SELECT_COLUMN"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-column--content);}#edit_mode[data-edit-mode="SELECT_REGION"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-region--content);}#edit_mode[data-edit-mode="READ_ONLY"] span:before{content:var(--edit-mode--read-only--content,"Read Only");}#edit_mode[data-edit-mode="EDIT"] span:before{content:var(--edit-mode--edit--content,"Editable");}#edit_mode[data-edit-mode="SELECT_ROW"] span:before{content:var(--edit-mode--select-row--content,"Row Select");}#edit_mode[data-edit-mode="SELECT_COLUMN"] span:before{content:var(--edit-mode--select-column--content,"Column Select");}#edit_mode[data-edit-mode="SELECT_REGION"] span:before{content:var(--edit-mode--select-region--content,"Region Select");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,"Free Scroll");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,"Align Scroll");}.button:before{width:21px;height:21px;content:"";-webkit-mask-size:cover;mask-size:cover;background-color:var(--icon--color);}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;justify-content:center;align-items:center;user-select:none;padding:0 5px;border:1px solid transparent;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.hover-target:focus-within .button,.hover-target:hover .button{position:relative;background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;}.hover-target:focus-within .button:before,.hover-target:hover .button:before{background-color:var(--plugin--background);}.hover-target:focus-within .button>span,.hover-target:hover .button>span{display:block;position:absolute;top:calc(100% + 3px);left:50%;translate:-50%;margin:0;padding:5px;height:auto;white-space:pre-wrap;line-height:1;font-size:9px;background-color:var(--icon--color);width:35px;text-align:center;border-radius:0 0 3px 3px;}';var po=new CSSStyleSheet;po.replaceSync(uo);var It=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets.push(po),this.shadowRoot.innerHTML=`
            <div id="toolbar">
                <span class="hover-target">
                    <span id="scroll_lock" class="button">
                        <span></span>
                    </span>
                </span>
                <span class="hover-target">
                    <span id="edit_mode" class="button" data-edit-mode="READ_ONLY">
                        <span></span>
                    </span>
                </span>
            </div>
        `;let t=this.parentElement,o=t.querySelector("perspective-viewer-datagrid");o._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),o._scroll_lock.addEventListener("click",()=>Tt.call(o)),o._edit_button=this.shadowRoot.querySelector("#edit_mode"),o._edit_button.addEventListener("click",()=>{Rt.call(o),o.regular_table.draw(),t.dispatchEvent(new Event("perspective-config-update"))})}};async function ns(){customElements.define("perspective-viewer-datagrid-toolbar",It),customElements.define("perspective-viewer-datagrid",Dt),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}ns();
/*! Bundled license information:

chroma-js/chroma.js:
  (**
   * @license
   *
   * chroma.js - JavaScript library for color conversions
   * 
   * Copyright (c) 2011-2017, Gregor Aisch
   * All rights reserved.
   * 
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   * 
   * 1. Redistributions of source code must retain the above copyright notice, this
   *    list of conditions and the following disclaimer.
   * 
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   *    this list of conditions and the following disclaimer in the documentation
   *    and/or other materials provided with the distribution.
   * 
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   *    derived from this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   *)
  (**
  	ColorBrewer colors for chroma.js
  
  	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
  	Pennsylvania State University.
  
  	Licensed under the Apache License, Version 2.0 (the "License"); 
  	you may not use this file except in compliance with the License.
  	You may obtain a copy of the License at	
  	http://www.apache.org/licenses/LICENSE-2.0
  
  	Unless required by applicable law or agreed to in writing, software distributed
  	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
  	CONDITIONS OF ANY KIND, either express or implied. See the License for the
  	specific language governing permissions and limitations under the License.
  
      @preserve
   *)
*/
//# sourceMappingURL=perspective-viewer-datagrid.js.map
