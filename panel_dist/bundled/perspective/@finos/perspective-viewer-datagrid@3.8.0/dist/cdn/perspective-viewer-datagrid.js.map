{
  "version": 3,
  "sources": ["../../../../node_modules/.pnpm/chroma-js@1.4.1/node_modules/chroma-js/chroma.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/constants.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/utils.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/dist/css/container.css", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/dist/css/sub-cell-offsets.css", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/scroll_panel.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/events.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/view_model.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/thead.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/tbody.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/table.js", "../../../../node_modules/.pnpm/regular-table@0.6.8/node_modules/regular-table/src/js/index.js", "../../src/js/model/index.js", "../../src/js/style_handlers/column_header.js", "../../src/js/style_handlers/group_header.js", "../../src/js/style_handlers/table_cell/cell_flash.js", "../../src/js/color_utils.js", "../../src/js/style_handlers/table_cell/numeric.js", "../../src/js/style_handlers/table_cell/string.js", "../../src/js/style_handlers/table_cell/datetime.js", "../../src/js/style_handlers/table_cell/boolean.js", "../../src/js/style_handlers/table_cell/row_header.js", "../../src/js/style_handlers/table_cell/index.js", "../../src/js/event_handlers/sort.js", "../../src/js/event_handlers/expand_collapse.js", "../../src/js/event_handlers/header_click.js", "../../src/js/style_handlers/editable.js", "../../src/js/style_handlers/focus.js", "../../src/js/event_handlers/click/edit_click.js", "../../src/js/event_handlers/keydown/edit_keydown.js", "../../src/js/event_handlers/click.js", "../../src/js/event_handlers/focus.js", "../../src/js/get_cell_config.js", "../../src/js/event_handlers/row_select_click.js", "../../src/js/style_handlers/selection.js", "../../src/js/event_handlers/deselect_all.js", "../../src/js/model/create.js", "../../src/js/data_listener/formatter_cache.js", "../../src/js/data_listener/format_cell.js", "../../src/js/data_listener/format_tree_header.js", "../../src/js/data_listener/index.js", "../../src/js/event_handlers/dispatch_click.js", "../../src/js/event_handlers/select_region.js", "../../src/js/plugin/activate.js", "../../src/js/model/column_overrides.js", "../../src/js/model/toolbar.js", "../../src/js/plugin/restore.js", "../../src/js/plugin/save.js", "../../src/js/plugin/draw.js", "../../src/js/plugin/column_style_controls.js", "../css/perspective-viewer-datagrid.css", "../../src/js/custom_elements/datagrid.js", "../css/perspective-viewer-datagrid-toolbar.css", "../../src/js/custom_elements/toolbar.js", "../../src/js/index.js"],
  "sourcesContent": ["\n/**\n * @license\n *\n * chroma.js - JavaScript library for color conversions\n * \n * Copyright (c) 2011-2017, Gregor Aisch\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * \n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n * \n * 3. The name Gregor Aisch may not be used to endorse or promote products\n *    derived from this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,\n * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n */\n\n(function() {\n  var Color, DEG2RAD, LAB_CONSTANTS, PI, PITHIRD, RAD2DEG, TWOPI, _average_lrgb, _guess_formats, _guess_formats_sorted, _input, _interpolators, abs, atan2, bezier, blend, blend_f, brewer, burn, chroma, clip_rgb, cmyk2rgb, colors, cos, css2rgb, darken, dodge, each, floor, hcg2rgb, hex2rgb, hsi2rgb, hsl2css, hsl2rgb, hsv2rgb, interpolate, interpolate_hsx, interpolate_lab, interpolate_lrgb, interpolate_num, interpolate_rgb, lab2lch, lab2rgb, lab_xyz, lch2lab, lch2rgb, lighten, limit, log, luminance_x, m, max, multiply, normal, num2rgb, overlay, pow, rgb2cmyk, rgb2css, rgb2hcg, rgb2hex, rgb2hsi, rgb2hsl, rgb2hsv, rgb2lab, rgb2lch, rgb2luminance, rgb2num, rgb2temperature, rgb2xyz, rgb_xyz, rnd, root, round, screen, sin, sqrt, temperature2rgb, type, unpack, w3cx11, xyz_lab, xyz_rgb,\n    slice = [].slice;\n\n  type = (function() {\n\n    /*\n    for browser-safe type checking+\n    ported from jQuery's $.type\n     */\n    var classToType, len, name, o, ref;\n    classToType = {};\n    ref = \"Boolean Number String Function Array Date RegExp Undefined Null\".split(\" \");\n    for (o = 0, len = ref.length; o < len; o++) {\n      name = ref[o];\n      classToType[\"[object \" + name + \"]\"] = name.toLowerCase();\n    }\n    return function(obj) {\n      var strType;\n      strType = Object.prototype.toString.call(obj);\n      return classToType[strType] || \"object\";\n    };\n  })();\n\n  limit = function(x, min, max) {\n    if (min == null) {\n      min = 0;\n    }\n    if (max == null) {\n      max = 1;\n    }\n    if (x < min) {\n      x = min;\n    }\n    if (x > max) {\n      x = max;\n    }\n    return x;\n  };\n\n  unpack = function(args) {\n    if (args.length >= 3) {\n      return Array.prototype.slice.call(args);\n    } else {\n      return args[0];\n    }\n  };\n\n  clip_rgb = function(rgb) {\n    var i, o;\n    rgb._clipped = false;\n    rgb._unclipped = rgb.slice(0);\n    for (i = o = 0; o < 3; i = ++o) {\n      if (i < 3) {\n        if (rgb[i] < 0 || rgb[i] > 255) {\n          rgb._clipped = true;\n        }\n        if (rgb[i] < 0) {\n          rgb[i] = 0;\n        }\n        if (rgb[i] > 255) {\n          rgb[i] = 255;\n        }\n      } else if (i === 3) {\n        if (rgb[i] < 0) {\n          rgb[i] = 0;\n        }\n        if (rgb[i] > 1) {\n          rgb[i] = 1;\n        }\n      }\n    }\n    if (!rgb._clipped) {\n      delete rgb._unclipped;\n    }\n    return rgb;\n  };\n\n  PI = Math.PI, round = Math.round, cos = Math.cos, floor = Math.floor, pow = Math.pow, log = Math.log, sin = Math.sin, sqrt = Math.sqrt, atan2 = Math.atan2, max = Math.max, abs = Math.abs;\n\n  TWOPI = PI * 2;\n\n  PITHIRD = PI / 3;\n\n  DEG2RAD = PI / 180;\n\n  RAD2DEG = 180 / PI;\n\n  chroma = function() {\n    if (arguments[0] instanceof Color) {\n      return arguments[0];\n    }\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, arguments, function(){});\n  };\n\n  chroma[\"default\"] = chroma;\n\n  _interpolators = [];\n\n  if ((typeof module !== \"undefined\" && module !== null) && (module.exports != null)) {\n    module.exports = chroma;\n  }\n\n  if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return chroma;\n    });\n  } else {\n    root = typeof exports !== \"undefined\" && exports !== null ? exports : this;\n    root.chroma = chroma;\n  }\n\n  chroma.version = '1.4.1';\n\n  _input = {};\n\n  _guess_formats = [];\n\n  _guess_formats_sorted = false;\n\n  Color = (function() {\n    function Color() {\n      var arg, args, chk, len, len1, me, mode, o, w;\n      me = this;\n      args = [];\n      for (o = 0, len = arguments.length; o < len; o++) {\n        arg = arguments[o];\n        if (arg != null) {\n          args.push(arg);\n        }\n      }\n      if (args.length > 1) {\n        mode = args[args.length - 1];\n      }\n      if (_input[mode] != null) {\n        me._rgb = clip_rgb(_input[mode](unpack(args.slice(0, -1))));\n      } else {\n        if (!_guess_formats_sorted) {\n          _guess_formats = _guess_formats.sort(function(a, b) {\n            return b.p - a.p;\n          });\n          _guess_formats_sorted = true;\n        }\n        for (w = 0, len1 = _guess_formats.length; w < len1; w++) {\n          chk = _guess_formats[w];\n          mode = chk.test.apply(chk, args);\n          if (mode) {\n            break;\n          }\n        }\n        if (mode) {\n          me._rgb = clip_rgb(_input[mode].apply(_input, args));\n        }\n      }\n      if (me._rgb == null) {\n        console.warn('unknown format: ' + args);\n      }\n      if (me._rgb == null) {\n        me._rgb = [0, 0, 0];\n      }\n      if (me._rgb.length === 3) {\n        me._rgb.push(1);\n      }\n    }\n\n    Color.prototype.toString = function() {\n      return this.hex();\n    };\n\n    return Color;\n\n  })();\n\n  chroma._input = _input;\n\n\n  /**\n  \tColorBrewer colors for chroma.js\n  \n  \tCopyright (c) 2002 Cynthia Brewer, Mark Harrower, and The \n  \tPennsylvania State University.\n  \n  \tLicensed under the Apache License, Version 2.0 (the \"License\"); \n  \tyou may not use this file except in compliance with the License.\n  \tYou may obtain a copy of the License at\t\n  \thttp://www.apache.org/licenses/LICENSE-2.0\n  \n  \tUnless required by applicable law or agreed to in writing, software distributed\n  \tunder the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n  \tCONDITIONS OF ANY KIND, either express or implied. See the License for the\n  \tspecific language governing permissions and limitations under the License.\n  \n      @preserve\n   */\n\n  chroma.brewer = brewer = {\n    OrRd: ['#fff7ec', '#fee8c8', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#b30000', '#7f0000'],\n    PuBu: ['#fff7fb', '#ece7f2', '#d0d1e6', '#a6bddb', '#74a9cf', '#3690c0', '#0570b0', '#045a8d', '#023858'],\n    BuPu: ['#f7fcfd', '#e0ecf4', '#bfd3e6', '#9ebcda', '#8c96c6', '#8c6bb1', '#88419d', '#810f7c', '#4d004b'],\n    Oranges: ['#fff5eb', '#fee6ce', '#fdd0a2', '#fdae6b', '#fd8d3c', '#f16913', '#d94801', '#a63603', '#7f2704'],\n    BuGn: ['#f7fcfd', '#e5f5f9', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b'],\n    YlOrBr: ['#ffffe5', '#fff7bc', '#fee391', '#fec44f', '#fe9929', '#ec7014', '#cc4c02', '#993404', '#662506'],\n    YlGn: ['#ffffe5', '#f7fcb9', '#d9f0a3', '#addd8e', '#78c679', '#41ab5d', '#238443', '#006837', '#004529'],\n    Reds: ['#fff5f0', '#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#a50f15', '#67000d'],\n    RdPu: ['#fff7f3', '#fde0dd', '#fcc5c0', '#fa9fb5', '#f768a1', '#dd3497', '#ae017e', '#7a0177', '#49006a'],\n    Greens: ['#f7fcf5', '#e5f5e0', '#c7e9c0', '#a1d99b', '#74c476', '#41ab5d', '#238b45', '#006d2c', '#00441b'],\n    YlGnBu: ['#ffffd9', '#edf8b1', '#c7e9b4', '#7fcdbb', '#41b6c4', '#1d91c0', '#225ea8', '#253494', '#081d58'],\n    Purples: ['#fcfbfd', '#efedf5', '#dadaeb', '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3', '#54278f', '#3f007d'],\n    GnBu: ['#f7fcf0', '#e0f3db', '#ccebc5', '#a8ddb5', '#7bccc4', '#4eb3d3', '#2b8cbe', '#0868ac', '#084081'],\n    Greys: ['#ffffff', '#f0f0f0', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525', '#000000'],\n    YlOrRd: ['#ffffcc', '#ffeda0', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#bd0026', '#800026'],\n    PuRd: ['#f7f4f9', '#e7e1ef', '#d4b9da', '#c994c7', '#df65b0', '#e7298a', '#ce1256', '#980043', '#67001f'],\n    Blues: ['#f7fbff', '#deebf7', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#08519c', '#08306b'],\n    PuBuGn: ['#fff7fb', '#ece2f0', '#d0d1e6', '#a6bddb', '#67a9cf', '#3690c0', '#02818a', '#016c59', '#014636'],\n    Viridis: ['#440154', '#482777', '#3f4a8a', '#31678e', '#26838f', '#1f9d8a', '#6cce5a', '#b6de2b', '#fee825'],\n    Spectral: ['#9e0142', '#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#e6f598', '#abdda4', '#66c2a5', '#3288bd', '#5e4fa2'],\n    RdYlGn: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850', '#006837'],\n    RdBu: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#f7f7f7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac', '#053061'],\n    PiYG: ['#8e0152', '#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#f7f7f7', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221', '#276419'],\n    PRGn: ['#40004b', '#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#f7f7f7', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837', '#00441b'],\n    RdYlBu: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee090', '#ffffbf', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695'],\n    BrBG: ['#543005', '#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#f5f5f5', '#c7eae5', '#80cdc1', '#35978f', '#01665e', '#003c30'],\n    RdGy: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#ffffff', '#e0e0e0', '#bababa', '#878787', '#4d4d4d', '#1a1a1a'],\n    PuOr: ['#7f3b08', '#b35806', '#e08214', '#fdb863', '#fee0b6', '#f7f7f7', '#d8daeb', '#b2abd2', '#8073ac', '#542788', '#2d004b'],\n    Set2: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'],\n    Accent: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0', '#f0027f', '#bf5b17', '#666666'],\n    Set1: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#999999'],\n    Set3: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd', '#ccebc5', '#ffed6f'],\n    Dark2: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02', '#a6761d', '#666666'],\n    Paired: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928'],\n    Pastel2: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9', '#fff2ae', '#f1e2cc', '#cccccc'],\n    Pastel1: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc', '#e5d8bd', '#fddaec', '#f2f2f2']\n  };\n\n  (function() {\n    var key, results;\n    results = [];\n    for (key in brewer) {\n      results.push(brewer[key.toLowerCase()] = brewer[key]);\n    }\n    return results;\n  })();\n\n\n  /**\n  \tX11 color names\n  \n  \thttp://www.w3.org/TR/css3-color/#svg-color\n   */\n\n  w3cx11 = {\n    aliceblue: '#f0f8ff',\n    antiquewhite: '#faebd7',\n    aqua: '#00ffff',\n    aquamarine: '#7fffd4',\n    azure: '#f0ffff',\n    beige: '#f5f5dc',\n    bisque: '#ffe4c4',\n    black: '#000000',\n    blanchedalmond: '#ffebcd',\n    blue: '#0000ff',\n    blueviolet: '#8a2be2',\n    brown: '#a52a2a',\n    burlywood: '#deb887',\n    cadetblue: '#5f9ea0',\n    chartreuse: '#7fff00',\n    chocolate: '#d2691e',\n    coral: '#ff7f50',\n    cornflower: '#6495ed',\n    cornflowerblue: '#6495ed',\n    cornsilk: '#fff8dc',\n    crimson: '#dc143c',\n    cyan: '#00ffff',\n    darkblue: '#00008b',\n    darkcyan: '#008b8b',\n    darkgoldenrod: '#b8860b',\n    darkgray: '#a9a9a9',\n    darkgreen: '#006400',\n    darkgrey: '#a9a9a9',\n    darkkhaki: '#bdb76b',\n    darkmagenta: '#8b008b',\n    darkolivegreen: '#556b2f',\n    darkorange: '#ff8c00',\n    darkorchid: '#9932cc',\n    darkred: '#8b0000',\n    darksalmon: '#e9967a',\n    darkseagreen: '#8fbc8f',\n    darkslateblue: '#483d8b',\n    darkslategray: '#2f4f4f',\n    darkslategrey: '#2f4f4f',\n    darkturquoise: '#00ced1',\n    darkviolet: '#9400d3',\n    deeppink: '#ff1493',\n    deepskyblue: '#00bfff',\n    dimgray: '#696969',\n    dimgrey: '#696969',\n    dodgerblue: '#1e90ff',\n    firebrick: '#b22222',\n    floralwhite: '#fffaf0',\n    forestgreen: '#228b22',\n    fuchsia: '#ff00ff',\n    gainsboro: '#dcdcdc',\n    ghostwhite: '#f8f8ff',\n    gold: '#ffd700',\n    goldenrod: '#daa520',\n    gray: '#808080',\n    green: '#008000',\n    greenyellow: '#adff2f',\n    grey: '#808080',\n    honeydew: '#f0fff0',\n    hotpink: '#ff69b4',\n    indianred: '#cd5c5c',\n    indigo: '#4b0082',\n    ivory: '#fffff0',\n    khaki: '#f0e68c',\n    laserlemon: '#ffff54',\n    lavender: '#e6e6fa',\n    lavenderblush: '#fff0f5',\n    lawngreen: '#7cfc00',\n    lemonchiffon: '#fffacd',\n    lightblue: '#add8e6',\n    lightcoral: '#f08080',\n    lightcyan: '#e0ffff',\n    lightgoldenrod: '#fafad2',\n    lightgoldenrodyellow: '#fafad2',\n    lightgray: '#d3d3d3',\n    lightgreen: '#90ee90',\n    lightgrey: '#d3d3d3',\n    lightpink: '#ffb6c1',\n    lightsalmon: '#ffa07a',\n    lightseagreen: '#20b2aa',\n    lightskyblue: '#87cefa',\n    lightslategray: '#778899',\n    lightslategrey: '#778899',\n    lightsteelblue: '#b0c4de',\n    lightyellow: '#ffffe0',\n    lime: '#00ff00',\n    limegreen: '#32cd32',\n    linen: '#faf0e6',\n    magenta: '#ff00ff',\n    maroon: '#800000',\n    maroon2: '#7f0000',\n    maroon3: '#b03060',\n    mediumaquamarine: '#66cdaa',\n    mediumblue: '#0000cd',\n    mediumorchid: '#ba55d3',\n    mediumpurple: '#9370db',\n    mediumseagreen: '#3cb371',\n    mediumslateblue: '#7b68ee',\n    mediumspringgreen: '#00fa9a',\n    mediumturquoise: '#48d1cc',\n    mediumvioletred: '#c71585',\n    midnightblue: '#191970',\n    mintcream: '#f5fffa',\n    mistyrose: '#ffe4e1',\n    moccasin: '#ffe4b5',\n    navajowhite: '#ffdead',\n    navy: '#000080',\n    oldlace: '#fdf5e6',\n    olive: '#808000',\n    olivedrab: '#6b8e23',\n    orange: '#ffa500',\n    orangered: '#ff4500',\n    orchid: '#da70d6',\n    palegoldenrod: '#eee8aa',\n    palegreen: '#98fb98',\n    paleturquoise: '#afeeee',\n    palevioletred: '#db7093',\n    papayawhip: '#ffefd5',\n    peachpuff: '#ffdab9',\n    peru: '#cd853f',\n    pink: '#ffc0cb',\n    plum: '#dda0dd',\n    powderblue: '#b0e0e6',\n    purple: '#800080',\n    purple2: '#7f007f',\n    purple3: '#a020f0',\n    rebeccapurple: '#663399',\n    red: '#ff0000',\n    rosybrown: '#bc8f8f',\n    royalblue: '#4169e1',\n    saddlebrown: '#8b4513',\n    salmon: '#fa8072',\n    sandybrown: '#f4a460',\n    seagreen: '#2e8b57',\n    seashell: '#fff5ee',\n    sienna: '#a0522d',\n    silver: '#c0c0c0',\n    skyblue: '#87ceeb',\n    slateblue: '#6a5acd',\n    slategray: '#708090',\n    slategrey: '#708090',\n    snow: '#fffafa',\n    springgreen: '#00ff7f',\n    steelblue: '#4682b4',\n    tan: '#d2b48c',\n    teal: '#008080',\n    thistle: '#d8bfd8',\n    tomato: '#ff6347',\n    turquoise: '#40e0d0',\n    violet: '#ee82ee',\n    wheat: '#f5deb3',\n    white: '#ffffff',\n    whitesmoke: '#f5f5f5',\n    yellow: '#ffff00',\n    yellowgreen: '#9acd32'\n  };\n\n  chroma.colors = colors = w3cx11;\n\n  lab2rgb = function() {\n    var a, args, b, g, l, r, x, y, z;\n    args = unpack(arguments);\n    l = args[0], a = args[1], b = args[2];\n    y = (l + 16) / 116;\n    x = isNaN(a) ? y : y + a / 500;\n    z = isNaN(b) ? y : y - b / 200;\n    y = LAB_CONSTANTS.Yn * lab_xyz(y);\n    x = LAB_CONSTANTS.Xn * lab_xyz(x);\n    z = LAB_CONSTANTS.Zn * lab_xyz(z);\n    r = xyz_rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z);\n    g = xyz_rgb(-0.9692660 * x + 1.8760108 * y + 0.0415560 * z);\n    b = xyz_rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z);\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  xyz_rgb = function(r) {\n    return 255 * (r <= 0.00304 ? 12.92 * r : 1.055 * pow(r, 1 / 2.4) - 0.055);\n  };\n\n  lab_xyz = function(t) {\n    if (t > LAB_CONSTANTS.t1) {\n      return t * t * t;\n    } else {\n      return LAB_CONSTANTS.t2 * (t - LAB_CONSTANTS.t0);\n    }\n  };\n\n  LAB_CONSTANTS = {\n    Kn: 18,\n    Xn: 0.950470,\n    Yn: 1,\n    Zn: 1.088830,\n    t0: 0.137931034,\n    t1: 0.206896552,\n    t2: 0.12841855,\n    t3: 0.008856452\n  };\n\n  rgb2lab = function() {\n    var b, g, r, ref, ref1, x, y, z;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    ref1 = rgb2xyz(r, g, b), x = ref1[0], y = ref1[1], z = ref1[2];\n    return [116 * y - 16, 500 * (x - y), 200 * (y - z)];\n  };\n\n  rgb_xyz = function(r) {\n    if ((r /= 255) <= 0.04045) {\n      return r / 12.92;\n    } else {\n      return pow((r + 0.055) / 1.055, 2.4);\n    }\n  };\n\n  xyz_lab = function(t) {\n    if (t > LAB_CONSTANTS.t3) {\n      return pow(t, 1 / 3);\n    } else {\n      return t / LAB_CONSTANTS.t2 + LAB_CONSTANTS.t0;\n    }\n  };\n\n  rgb2xyz = function() {\n    var b, g, r, ref, x, y, z;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    r = rgb_xyz(r);\n    g = rgb_xyz(g);\n    b = rgb_xyz(b);\n    x = xyz_lab((0.4124564 * r + 0.3575761 * g + 0.1804375 * b) / LAB_CONSTANTS.Xn);\n    y = xyz_lab((0.2126729 * r + 0.7151522 * g + 0.0721750 * b) / LAB_CONSTANTS.Yn);\n    z = xyz_lab((0.0193339 * r + 0.1191920 * g + 0.9503041 * b) / LAB_CONSTANTS.Zn);\n    return [x, y, z];\n  };\n\n  chroma.lab = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['lab']), function(){});\n  };\n\n  _input.lab = lab2rgb;\n\n  Color.prototype.lab = function() {\n    return rgb2lab(this._rgb);\n  };\n\n  bezier = function(colors) {\n    var I, I0, I1, c, lab0, lab1, lab2, lab3, ref, ref1, ref2;\n    colors = (function() {\n      var len, o, results;\n      results = [];\n      for (o = 0, len = colors.length; o < len; o++) {\n        c = colors[o];\n        results.push(chroma(c));\n      }\n      return results;\n    })();\n    if (colors.length === 2) {\n      ref = (function() {\n        var len, o, results;\n        results = [];\n        for (o = 0, len = colors.length; o < len; o++) {\n          c = colors[o];\n          results.push(c.lab());\n        }\n        return results;\n      })(), lab0 = ref[0], lab1 = ref[1];\n      I = function(t) {\n        var i, lab;\n        lab = (function() {\n          var o, results;\n          results = [];\n          for (i = o = 0; o <= 2; i = ++o) {\n            results.push(lab0[i] + t * (lab1[i] - lab0[i]));\n          }\n          return results;\n        })();\n        return chroma.lab.apply(chroma, lab);\n      };\n    } else if (colors.length === 3) {\n      ref1 = (function() {\n        var len, o, results;\n        results = [];\n        for (o = 0, len = colors.length; o < len; o++) {\n          c = colors[o];\n          results.push(c.lab());\n        }\n        return results;\n      })(), lab0 = ref1[0], lab1 = ref1[1], lab2 = ref1[2];\n      I = function(t) {\n        var i, lab;\n        lab = (function() {\n          var o, results;\n          results = [];\n          for (i = o = 0; o <= 2; i = ++o) {\n            results.push((1 - t) * (1 - t) * lab0[i] + 2 * (1 - t) * t * lab1[i] + t * t * lab2[i]);\n          }\n          return results;\n        })();\n        return chroma.lab.apply(chroma, lab);\n      };\n    } else if (colors.length === 4) {\n      ref2 = (function() {\n        var len, o, results;\n        results = [];\n        for (o = 0, len = colors.length; o < len; o++) {\n          c = colors[o];\n          results.push(c.lab());\n        }\n        return results;\n      })(), lab0 = ref2[0], lab1 = ref2[1], lab2 = ref2[2], lab3 = ref2[3];\n      I = function(t) {\n        var i, lab;\n        lab = (function() {\n          var o, results;\n          results = [];\n          for (i = o = 0; o <= 2; i = ++o) {\n            results.push((1 - t) * (1 - t) * (1 - t) * lab0[i] + 3 * (1 - t) * (1 - t) * t * lab1[i] + 3 * (1 - t) * t * t * lab2[i] + t * t * t * lab3[i]);\n          }\n          return results;\n        })();\n        return chroma.lab.apply(chroma, lab);\n      };\n    } else if (colors.length === 5) {\n      I0 = bezier(colors.slice(0, 3));\n      I1 = bezier(colors.slice(2, 5));\n      I = function(t) {\n        if (t < 0.5) {\n          return I0(t * 2);\n        } else {\n          return I1((t - 0.5) * 2);\n        }\n      };\n    }\n    return I;\n  };\n\n  chroma.bezier = function(colors) {\n    var f;\n    f = bezier(colors);\n    f.scale = function() {\n      return chroma.scale(f);\n    };\n    return f;\n  };\n\n  chroma.cubehelix = function(start, rotations, hue, gamma, lightness) {\n    var dh, dl, f;\n    if (start == null) {\n      start = 300;\n    }\n    if (rotations == null) {\n      rotations = -1.5;\n    }\n    if (hue == null) {\n      hue = 1;\n    }\n    if (gamma == null) {\n      gamma = 1;\n    }\n    if (lightness == null) {\n      lightness = [0, 1];\n    }\n    dh = 0;\n    if (type(lightness) === 'array') {\n      dl = lightness[1] - lightness[0];\n    } else {\n      dl = 0;\n      lightness = [lightness, lightness];\n    }\n    f = function(fract) {\n      var a, amp, b, cos_a, g, h, l, r, sin_a;\n      a = TWOPI * ((start + 120) / 360 + rotations * fract);\n      l = pow(lightness[0] + dl * fract, gamma);\n      h = dh !== 0 ? hue[0] + fract * dh : hue;\n      amp = h * l * (1 - l) / 2;\n      cos_a = cos(a);\n      sin_a = sin(a);\n      r = l + amp * (-0.14861 * cos_a + 1.78277 * sin_a);\n      g = l + amp * (-0.29227 * cos_a - 0.90649 * sin_a);\n      b = l + amp * (+1.97294 * cos_a);\n      return chroma(clip_rgb([r * 255, g * 255, b * 255, 1]));\n    };\n    f.start = function(s) {\n      if (s == null) {\n        return start;\n      }\n      start = s;\n      return f;\n    };\n    f.rotations = function(r) {\n      if (r == null) {\n        return rotations;\n      }\n      rotations = r;\n      return f;\n    };\n    f.gamma = function(g) {\n      if (g == null) {\n        return gamma;\n      }\n      gamma = g;\n      return f;\n    };\n    f.hue = function(h) {\n      if (h == null) {\n        return hue;\n      }\n      hue = h;\n      if (type(hue) === 'array') {\n        dh = hue[1] - hue[0];\n        if (dh === 0) {\n          hue = hue[1];\n        }\n      } else {\n        dh = 0;\n      }\n      return f;\n    };\n    f.lightness = function(h) {\n      if (h == null) {\n        return lightness;\n      }\n      if (type(h) === 'array') {\n        lightness = h;\n        dl = h[1] - h[0];\n      } else {\n        lightness = [h, h];\n        dl = 0;\n      }\n      return f;\n    };\n    f.scale = function() {\n      return chroma.scale(f);\n    };\n    f.hue(hue);\n    return f;\n  };\n\n  chroma.random = function() {\n    var code, digits, i, o;\n    digits = '0123456789abcdef';\n    code = '#';\n    for (i = o = 0; o < 6; i = ++o) {\n      code += digits.charAt(floor(Math.random() * 16));\n    }\n    return new Color(code);\n  };\n\n  _interpolators = [];\n\n  interpolate = function(col1, col2, f, m) {\n    var interpol, len, o, res;\n    if (f == null) {\n      f = 0.5;\n    }\n    if (m == null) {\n      m = 'rgb';\n    }\n\n    /*\n    interpolates between colors\n    f = 0 --> me\n    f = 1 --> col\n     */\n    if (type(col1) !== 'object') {\n      col1 = chroma(col1);\n    }\n    if (type(col2) !== 'object') {\n      col2 = chroma(col2);\n    }\n    for (o = 0, len = _interpolators.length; o < len; o++) {\n      interpol = _interpolators[o];\n      if (m === interpol[0]) {\n        res = interpol[1](col1, col2, f, m);\n        break;\n      }\n    }\n    if (res == null) {\n      throw \"color mode \" + m + \" is not supported\";\n    }\n    return res.alpha(col1.alpha() + f * (col2.alpha() - col1.alpha()));\n  };\n\n  chroma.interpolate = interpolate;\n\n  Color.prototype.interpolate = function(col2, f, m) {\n    return interpolate(this, col2, f, m);\n  };\n\n  chroma.mix = interpolate;\n\n  Color.prototype.mix = Color.prototype.interpolate;\n\n  _input.rgb = function() {\n    var k, ref, results, v;\n    ref = unpack(arguments);\n    results = [];\n    for (k in ref) {\n      v = ref[k];\n      results.push(v);\n    }\n    return results;\n  };\n\n  chroma.rgb = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['rgb']), function(){});\n  };\n\n  Color.prototype.rgb = function(round) {\n    if (round == null) {\n      round = true;\n    }\n    if (round) {\n      return this._rgb.map(Math.round).slice(0, 3);\n    } else {\n      return this._rgb.slice(0, 3);\n    }\n  };\n\n  Color.prototype.rgba = function(round) {\n    if (round == null) {\n      round = true;\n    }\n    if (!round) {\n      return this._rgb.slice(0);\n    }\n    return [Math.round(this._rgb[0]), Math.round(this._rgb[1]), Math.round(this._rgb[2]), this._rgb[3]];\n  };\n\n  _guess_formats.push({\n    p: 3,\n    test: function(n) {\n      var a;\n      a = unpack(arguments);\n      if (type(a) === 'array' && a.length === 3) {\n        return 'rgb';\n      }\n      if (a.length === 4 && type(a[3]) === \"number\" && a[3] >= 0 && a[3] <= 1) {\n        return 'rgb';\n      }\n    }\n  });\n\n  _input.lrgb = _input.rgb;\n\n  interpolate_lrgb = function(col1, col2, f, m) {\n    var xyz0, xyz1;\n    xyz0 = col1._rgb;\n    xyz1 = col2._rgb;\n    return new Color(sqrt(pow(xyz0[0], 2) * (1 - f) + pow(xyz1[0], 2) * f), sqrt(pow(xyz0[1], 2) * (1 - f) + pow(xyz1[1], 2) * f), sqrt(pow(xyz0[2], 2) * (1 - f) + pow(xyz1[2], 2) * f), m);\n  };\n\n  _average_lrgb = function(colors) {\n    var col, f, len, o, rgb, xyz;\n    f = 1 / colors.length;\n    xyz = [0, 0, 0, 0];\n    for (o = 0, len = colors.length; o < len; o++) {\n      col = colors[o];\n      rgb = col._rgb;\n      xyz[0] += pow(rgb[0], 2) * f;\n      xyz[1] += pow(rgb[1], 2) * f;\n      xyz[2] += pow(rgb[2], 2) * f;\n      xyz[3] += rgb[3] * f;\n    }\n    xyz[0] = sqrt(xyz[0]);\n    xyz[1] = sqrt(xyz[1]);\n    xyz[2] = sqrt(xyz[2]);\n    if (xyz[3] > 1) {\n      xyz[3] = 1;\n    }\n    return new Color(clip_rgb(xyz));\n  };\n\n  _interpolators.push(['lrgb', interpolate_lrgb]);\n\n  chroma.average = function(colors, mode) {\n    var A, alpha, c, cnt, dx, dy, first, i, l, len, o, xyz, xyz2;\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    l = colors.length;\n    colors = colors.map(function(c) {\n      return chroma(c);\n    });\n    first = colors.splice(0, 1)[0];\n    if (mode === 'lrgb') {\n      return _average_lrgb(colors);\n    }\n    xyz = first.get(mode);\n    cnt = [];\n    dx = 0;\n    dy = 0;\n    for (i in xyz) {\n      xyz[i] = xyz[i] || 0;\n      cnt.push(isNaN(xyz[i]) ? 0 : 1);\n      if (mode.charAt(i) === 'h' && !isNaN(xyz[i])) {\n        A = xyz[i] / 180 * PI;\n        dx += cos(A);\n        dy += sin(A);\n      }\n    }\n    alpha = first.alpha();\n    for (o = 0, len = colors.length; o < len; o++) {\n      c = colors[o];\n      xyz2 = c.get(mode);\n      alpha += c.alpha();\n      for (i in xyz) {\n        if (!isNaN(xyz2[i])) {\n          cnt[i] += 1;\n          if (mode.charAt(i) === 'h') {\n            A = xyz2[i] / 180 * PI;\n            dx += cos(A);\n            dy += sin(A);\n          } else {\n            xyz[i] += xyz2[i];\n          }\n        }\n      }\n    }\n    for (i in xyz) {\n      if (mode.charAt(i) === 'h') {\n        A = atan2(dy / cnt[i], dx / cnt[i]) / PI * 180;\n        while (A < 0) {\n          A += 360;\n        }\n        while (A >= 360) {\n          A -= 360;\n        }\n        xyz[i] = A;\n      } else {\n        xyz[i] = xyz[i] / cnt[i];\n      }\n    }\n    return chroma(xyz, mode).alpha(alpha / l);\n  };\n\n  hex2rgb = function(hex) {\n    var a, b, g, r, rgb, u;\n    if (hex.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)) {\n      if (hex.length === 4 || hex.length === 7) {\n        hex = hex.substr(1);\n      }\n      if (hex.length === 3) {\n        hex = hex.split(\"\");\n        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n      }\n      u = parseInt(hex, 16);\n      r = u >> 16;\n      g = u >> 8 & 0xFF;\n      b = u & 0xFF;\n      return [r, g, b, 1];\n    }\n    if (hex.match(/^#?([A-Fa-f0-9]{8})$/)) {\n      if (hex.length === 9) {\n        hex = hex.substr(1);\n      }\n      u = parseInt(hex, 16);\n      r = u >> 24 & 0xFF;\n      g = u >> 16 & 0xFF;\n      b = u >> 8 & 0xFF;\n      a = round((u & 0xFF) / 0xFF * 100) / 100;\n      return [r, g, b, a];\n    }\n    if ((_input.css != null) && (rgb = _input.css(hex))) {\n      return rgb;\n    }\n    throw \"unknown color: \" + hex;\n  };\n\n  rgb2hex = function(channels, mode) {\n    var a, b, g, hxa, r, str, u;\n    if (mode == null) {\n      mode = 'auto';\n    }\n    r = channels[0], g = channels[1], b = channels[2], a = channels[3];\n    if (mode === 'auto') {\n      mode = a < 1 ? 'rgba' : 'rgb';\n    }\n    r = Math.round(r);\n    g = Math.round(g);\n    b = Math.round(b);\n    u = r << 16 | g << 8 | b;\n    str = \"000000\" + u.toString(16);\n    str = str.substr(str.length - 6);\n    hxa = '0' + round(a * 255).toString(16);\n    hxa = hxa.substr(hxa.length - 2);\n    return \"#\" + (function() {\n      switch (mode.toLowerCase()) {\n        case 'rgba':\n          return str + hxa;\n        case 'argb':\n          return hxa + str;\n        default:\n          return str;\n      }\n    })();\n  };\n\n  _input.hex = function(h) {\n    return hex2rgb(h);\n  };\n\n  chroma.hex = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hex']), function(){});\n  };\n\n  Color.prototype.hex = function(mode) {\n    if (mode == null) {\n      mode = 'auto';\n    }\n    return rgb2hex(this._rgb, mode);\n  };\n\n  _guess_formats.push({\n    p: 4,\n    test: function(n) {\n      if (arguments.length === 1 && type(n) === \"string\") {\n        return 'hex';\n      }\n    }\n  });\n\n  hsl2rgb = function() {\n    var args, b, c, g, h, i, l, o, r, ref, s, t1, t2, t3;\n    args = unpack(arguments);\n    h = args[0], s = args[1], l = args[2];\n    if (s === 0) {\n      r = g = b = l * 255;\n    } else {\n      t3 = [0, 0, 0];\n      c = [0, 0, 0];\n      t2 = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      t1 = 2 * l - t2;\n      h /= 360;\n      t3[0] = h + 1 / 3;\n      t3[1] = h;\n      t3[2] = h - 1 / 3;\n      for (i = o = 0; o <= 2; i = ++o) {\n        if (t3[i] < 0) {\n          t3[i] += 1;\n        }\n        if (t3[i] > 1) {\n          t3[i] -= 1;\n        }\n        if (6 * t3[i] < 1) {\n          c[i] = t1 + (t2 - t1) * 6 * t3[i];\n        } else if (2 * t3[i] < 1) {\n          c[i] = t2;\n        } else if (3 * t3[i] < 2) {\n          c[i] = t1 + (t2 - t1) * ((2 / 3) - t3[i]) * 6;\n        } else {\n          c[i] = t1;\n        }\n      }\n      ref = [round(c[0] * 255), round(c[1] * 255), round(c[2] * 255)], r = ref[0], g = ref[1], b = ref[2];\n    }\n    if (args.length > 3) {\n      return [r, g, b, args[3]];\n    } else {\n      return [r, g, b];\n    }\n  };\n\n  rgb2hsl = function(r, g, b) {\n    var h, l, min, ref, s;\n    if (r !== void 0 && r.length >= 3) {\n      ref = r, r = ref[0], g = ref[1], b = ref[2];\n    }\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    min = Math.min(r, g, b);\n    max = Math.max(r, g, b);\n    l = (max + min) / 2;\n    if (max === min) {\n      s = 0;\n      h = Number.NaN;\n    } else {\n      s = l < 0.5 ? (max - min) / (max + min) : (max - min) / (2 - max - min);\n    }\n    if (r === max) {\n      h = (g - b) / (max - min);\n    } else if (g === max) {\n      h = 2 + (b - r) / (max - min);\n    } else if (b === max) {\n      h = 4 + (r - g) / (max - min);\n    }\n    h *= 60;\n    if (h < 0) {\n      h += 360;\n    }\n    return [h, s, l];\n  };\n\n  chroma.hsl = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hsl']), function(){});\n  };\n\n  _input.hsl = hsl2rgb;\n\n  Color.prototype.hsl = function() {\n    return rgb2hsl(this._rgb);\n  };\n\n  hsv2rgb = function() {\n    var args, b, f, g, h, i, p, q, r, ref, ref1, ref2, ref3, ref4, ref5, s, t, v;\n    args = unpack(arguments);\n    h = args[0], s = args[1], v = args[2];\n    v *= 255;\n    if (s === 0) {\n      r = g = b = v;\n    } else {\n      if (h === 360) {\n        h = 0;\n      }\n      if (h > 360) {\n        h -= 360;\n      }\n      if (h < 0) {\n        h += 360;\n      }\n      h /= 60;\n      i = floor(h);\n      f = h - i;\n      p = v * (1 - s);\n      q = v * (1 - s * f);\n      t = v * (1 - s * (1 - f));\n      switch (i) {\n        case 0:\n          ref = [v, t, p], r = ref[0], g = ref[1], b = ref[2];\n          break;\n        case 1:\n          ref1 = [q, v, p], r = ref1[0], g = ref1[1], b = ref1[2];\n          break;\n        case 2:\n          ref2 = [p, v, t], r = ref2[0], g = ref2[1], b = ref2[2];\n          break;\n        case 3:\n          ref3 = [p, q, v], r = ref3[0], g = ref3[1], b = ref3[2];\n          break;\n        case 4:\n          ref4 = [t, p, v], r = ref4[0], g = ref4[1], b = ref4[2];\n          break;\n        case 5:\n          ref5 = [v, p, q], r = ref5[0], g = ref5[1], b = ref5[2];\n      }\n    }\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  rgb2hsv = function() {\n    var b, delta, g, h, min, r, ref, s, v;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    min = Math.min(r, g, b);\n    max = Math.max(r, g, b);\n    delta = max - min;\n    v = max / 255.0;\n    if (max === 0) {\n      h = Number.NaN;\n      s = 0;\n    } else {\n      s = delta / max;\n      if (r === max) {\n        h = (g - b) / delta;\n      }\n      if (g === max) {\n        h = 2 + (b - r) / delta;\n      }\n      if (b === max) {\n        h = 4 + (r - g) / delta;\n      }\n      h *= 60;\n      if (h < 0) {\n        h += 360;\n      }\n    }\n    return [h, s, v];\n  };\n\n  chroma.hsv = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hsv']), function(){});\n  };\n\n  _input.hsv = hsv2rgb;\n\n  Color.prototype.hsv = function() {\n    return rgb2hsv(this._rgb);\n  };\n\n  num2rgb = function(num) {\n    var b, g, r;\n    if (type(num) === \"number\" && num >= 0 && num <= 0xFFFFFF) {\n      r = num >> 16;\n      g = (num >> 8) & 0xFF;\n      b = num & 0xFF;\n      return [r, g, b, 1];\n    }\n    console.warn(\"unknown num color: \" + num);\n    return [0, 0, 0, 1];\n  };\n\n  rgb2num = function() {\n    var b, g, r, ref;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    return (r << 16) + (g << 8) + b;\n  };\n\n  chroma.num = function(num) {\n    return new Color(num, 'num');\n  };\n\n  Color.prototype.num = function(mode) {\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    return rgb2num(this._rgb, mode);\n  };\n\n  _input.num = num2rgb;\n\n  _guess_formats.push({\n    p: 1,\n    test: function(n) {\n      if (arguments.length === 1 && type(n) === \"number\" && n >= 0 && n <= 0xFFFFFF) {\n        return 'num';\n      }\n    }\n  });\n\n  hcg2rgb = function() {\n    var _c, _g, args, b, c, f, g, h, i, p, q, r, ref, ref1, ref2, ref3, ref4, ref5, t, v;\n    args = unpack(arguments);\n    h = args[0], c = args[1], _g = args[2];\n    c = c / 100;\n    g = g / 100 * 255;\n    _c = c * 255;\n    if (c === 0) {\n      r = g = b = _g;\n    } else {\n      if (h === 360) {\n        h = 0;\n      }\n      if (h > 360) {\n        h -= 360;\n      }\n      if (h < 0) {\n        h += 360;\n      }\n      h /= 60;\n      i = floor(h);\n      f = h - i;\n      p = _g * (1 - c);\n      q = p + _c * (1 - f);\n      t = p + _c * f;\n      v = p + _c;\n      switch (i) {\n        case 0:\n          ref = [v, t, p], r = ref[0], g = ref[1], b = ref[2];\n          break;\n        case 1:\n          ref1 = [q, v, p], r = ref1[0], g = ref1[1], b = ref1[2];\n          break;\n        case 2:\n          ref2 = [p, v, t], r = ref2[0], g = ref2[1], b = ref2[2];\n          break;\n        case 3:\n          ref3 = [p, q, v], r = ref3[0], g = ref3[1], b = ref3[2];\n          break;\n        case 4:\n          ref4 = [t, p, v], r = ref4[0], g = ref4[1], b = ref4[2];\n          break;\n        case 5:\n          ref5 = [v, p, q], r = ref5[0], g = ref5[1], b = ref5[2];\n      }\n    }\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  rgb2hcg = function() {\n    var _g, b, c, delta, g, h, min, r, ref;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    min = Math.min(r, g, b);\n    max = Math.max(r, g, b);\n    delta = max - min;\n    c = delta * 100 / 255;\n    _g = min / (255 - delta) * 100;\n    if (delta === 0) {\n      h = Number.NaN;\n    } else {\n      if (r === max) {\n        h = (g - b) / delta;\n      }\n      if (g === max) {\n        h = 2 + (b - r) / delta;\n      }\n      if (b === max) {\n        h = 4 + (r - g) / delta;\n      }\n      h *= 60;\n      if (h < 0) {\n        h += 360;\n      }\n    }\n    return [h, c, _g];\n  };\n\n  chroma.hcg = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hcg']), function(){});\n  };\n\n  _input.hcg = hcg2rgb;\n\n  Color.prototype.hcg = function() {\n    return rgb2hcg(this._rgb);\n  };\n\n  css2rgb = function(css) {\n    var aa, ab, hsl, i, m, o, rgb, w;\n    css = css.toLowerCase();\n    if ((chroma.colors != null) && chroma.colors[css]) {\n      return hex2rgb(chroma.colors[css]);\n    }\n    if (m = css.match(/rgb\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*\\)/)) {\n      rgb = m.slice(1, 4);\n      for (i = o = 0; o <= 2; i = ++o) {\n        rgb[i] = +rgb[i];\n      }\n      rgb[3] = 1;\n    } else if (m = css.match(/rgba\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*,\\s*([01]|[01]?\\.\\d+)\\)/)) {\n      rgb = m.slice(1, 5);\n      for (i = w = 0; w <= 3; i = ++w) {\n        rgb[i] = +rgb[i];\n      }\n    } else if (m = css.match(/rgb\\(\\s*(\\-?\\d+(?:\\.\\d+)?)%,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*\\)/)) {\n      rgb = m.slice(1, 4);\n      for (i = aa = 0; aa <= 2; i = ++aa) {\n        rgb[i] = round(rgb[i] * 2.55);\n      }\n      rgb[3] = 1;\n    } else if (m = css.match(/rgba\\(\\s*(\\-?\\d+(?:\\.\\d+)?)%,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)/)) {\n      rgb = m.slice(1, 5);\n      for (i = ab = 0; ab <= 2; i = ++ab) {\n        rgb[i] = round(rgb[i] * 2.55);\n      }\n      rgb[3] = +rgb[3];\n    } else if (m = css.match(/hsl\\(\\s*(\\-?\\d+(?:\\.\\d+)?),\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*\\)/)) {\n      hsl = m.slice(1, 4);\n      hsl[1] *= 0.01;\n      hsl[2] *= 0.01;\n      rgb = hsl2rgb(hsl);\n      rgb[3] = 1;\n    } else if (m = css.match(/hsla\\(\\s*(\\-?\\d+(?:\\.\\d+)?),\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)/)) {\n      hsl = m.slice(1, 4);\n      hsl[1] *= 0.01;\n      hsl[2] *= 0.01;\n      rgb = hsl2rgb(hsl);\n      rgb[3] = +m[4];\n    }\n    return rgb;\n  };\n\n  rgb2css = function(rgba) {\n    var mode;\n    mode = rgba[3] < 1 ? 'rgba' : 'rgb';\n    if (mode === 'rgb') {\n      return mode + '(' + rgba.slice(0, 3).map(round).join(',') + ')';\n    } else if (mode === 'rgba') {\n      return mode + '(' + rgba.slice(0, 3).map(round).join(',') + ',' + rgba[3] + ')';\n    } else {\n\n    }\n  };\n\n  rnd = function(a) {\n    return round(a * 100) / 100;\n  };\n\n  hsl2css = function(hsl, alpha) {\n    var mode;\n    mode = alpha < 1 ? 'hsla' : 'hsl';\n    hsl[0] = rnd(hsl[0] || 0);\n    hsl[1] = rnd(hsl[1] * 100) + '%';\n    hsl[2] = rnd(hsl[2] * 100) + '%';\n    if (mode === 'hsla') {\n      hsl[3] = alpha;\n    }\n    return mode + '(' + hsl.join(',') + ')';\n  };\n\n  _input.css = function(h) {\n    return css2rgb(h);\n  };\n\n  chroma.css = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['css']), function(){});\n  };\n\n  Color.prototype.css = function(mode) {\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    if (mode.slice(0, 3) === 'rgb') {\n      return rgb2css(this._rgb);\n    } else if (mode.slice(0, 3) === 'hsl') {\n      return hsl2css(this.hsl(), this.alpha());\n    }\n  };\n\n  _input.named = function(name) {\n    return hex2rgb(w3cx11[name]);\n  };\n\n  _guess_formats.push({\n    p: 5,\n    test: function(n) {\n      if (arguments.length === 1 && (w3cx11[n] != null)) {\n        return 'named';\n      }\n    }\n  });\n\n  Color.prototype.name = function(n) {\n    var h, k;\n    if (arguments.length) {\n      if (w3cx11[n]) {\n        this._rgb = hex2rgb(w3cx11[n]);\n      }\n      this._rgb[3] = 1;\n      this;\n    }\n    h = this.hex('rgb');\n    for (k in w3cx11) {\n      if (h === w3cx11[k]) {\n        return k;\n      }\n    }\n    return h;\n  };\n\n  lch2lab = function() {\n\n    /*\n    Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n    These formulas were invented by David Dalrymple to obtain maximum contrast without going\n    out of gamut if the parameters are in the range 0-1.\n    \n    A saturation multiplier was added by Gregor Aisch\n     */\n    var c, h, l, ref;\n    ref = unpack(arguments), l = ref[0], c = ref[1], h = ref[2];\n    h = h * DEG2RAD;\n    return [l, cos(h) * c, sin(h) * c];\n  };\n\n  lch2rgb = function() {\n    var L, a, args, b, c, g, h, l, r, ref, ref1;\n    args = unpack(arguments);\n    l = args[0], c = args[1], h = args[2];\n    ref = lch2lab(l, c, h), L = ref[0], a = ref[1], b = ref[2];\n    ref1 = lab2rgb(L, a, b), r = ref1[0], g = ref1[1], b = ref1[2];\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  lab2lch = function() {\n    var a, b, c, h, l, ref;\n    ref = unpack(arguments), l = ref[0], a = ref[1], b = ref[2];\n    c = sqrt(a * a + b * b);\n    h = (atan2(b, a) * RAD2DEG + 360) % 360;\n    if (round(c * 10000) === 0) {\n      h = Number.NaN;\n    }\n    return [l, c, h];\n  };\n\n  rgb2lch = function() {\n    var a, b, g, l, r, ref, ref1;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    ref1 = rgb2lab(r, g, b), l = ref1[0], a = ref1[1], b = ref1[2];\n    return lab2lch(l, a, b);\n  };\n\n  chroma.lch = function() {\n    var args;\n    args = unpack(arguments);\n    return new Color(args, 'lch');\n  };\n\n  chroma.hcl = function() {\n    var args;\n    args = unpack(arguments);\n    return new Color(args, 'hcl');\n  };\n\n  _input.lch = lch2rgb;\n\n  _input.hcl = function() {\n    var c, h, l, ref;\n    ref = unpack(arguments), h = ref[0], c = ref[1], l = ref[2];\n    return lch2rgb([l, c, h]);\n  };\n\n  Color.prototype.lch = function() {\n    return rgb2lch(this._rgb);\n  };\n\n  Color.prototype.hcl = function() {\n    return rgb2lch(this._rgb).reverse();\n  };\n\n  rgb2cmyk = function(mode) {\n    var b, c, f, g, k, m, r, ref, y;\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    r = r / 255;\n    g = g / 255;\n    b = b / 255;\n    k = 1 - Math.max(r, Math.max(g, b));\n    f = k < 1 ? 1 / (1 - k) : 0;\n    c = (1 - r - k) * f;\n    m = (1 - g - k) * f;\n    y = (1 - b - k) * f;\n    return [c, m, y, k];\n  };\n\n  cmyk2rgb = function() {\n    var alpha, args, b, c, g, k, m, r, y;\n    args = unpack(arguments);\n    c = args[0], m = args[1], y = args[2], k = args[3];\n    alpha = args.length > 4 ? args[4] : 1;\n    if (k === 1) {\n      return [0, 0, 0, alpha];\n    }\n    r = c >= 1 ? 0 : 255 * (1 - c) * (1 - k);\n    g = m >= 1 ? 0 : 255 * (1 - m) * (1 - k);\n    b = y >= 1 ? 0 : 255 * (1 - y) * (1 - k);\n    return [r, g, b, alpha];\n  };\n\n  _input.cmyk = function() {\n    return cmyk2rgb(unpack(arguments));\n  };\n\n  chroma.cmyk = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['cmyk']), function(){});\n  };\n\n  Color.prototype.cmyk = function() {\n    return rgb2cmyk(this._rgb);\n  };\n\n  _input.gl = function() {\n    var i, k, o, rgb, v;\n    rgb = (function() {\n      var ref, results;\n      ref = unpack(arguments);\n      results = [];\n      for (k in ref) {\n        v = ref[k];\n        results.push(v);\n      }\n      return results;\n    }).apply(this, arguments);\n    for (i = o = 0; o <= 2; i = ++o) {\n      rgb[i] *= 255;\n    }\n    return rgb;\n  };\n\n  chroma.gl = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['gl']), function(){});\n  };\n\n  Color.prototype.gl = function() {\n    var rgb;\n    rgb = this._rgb;\n    return [rgb[0] / 255, rgb[1] / 255, rgb[2] / 255, rgb[3]];\n  };\n\n  rgb2luminance = function(r, g, b) {\n    var ref;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    r = luminance_x(r);\n    g = luminance_x(g);\n    b = luminance_x(b);\n    return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  };\n\n  luminance_x = function(x) {\n    x /= 255;\n    if (x <= 0.03928) {\n      return x / 12.92;\n    } else {\n      return pow((x + 0.055) / 1.055, 2.4);\n    }\n  };\n\n  interpolate_rgb = function(col1, col2, f, m) {\n    var xyz0, xyz1;\n    xyz0 = col1._rgb;\n    xyz1 = col2._rgb;\n    return new Color(xyz0[0] + f * (xyz1[0] - xyz0[0]), xyz0[1] + f * (xyz1[1] - xyz0[1]), xyz0[2] + f * (xyz1[2] - xyz0[2]), m);\n  };\n\n  _interpolators.push(['rgb', interpolate_rgb]);\n\n  Color.prototype.luminance = function(lum, mode) {\n    var cur_lum, eps, max_iter, rgba, test;\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    if (!arguments.length) {\n      return rgb2luminance(this._rgb);\n    }\n    rgba = this._rgb;\n    if (lum === 0) {\n      rgba = [0, 0, 0, this._rgb[3]];\n    } else if (lum === 1) {\n      rgba = [255, 255, 255, this[3]];\n    } else {\n      cur_lum = rgb2luminance(this._rgb);\n      eps = 1e-7;\n      max_iter = 20;\n      test = function(l, h) {\n        var lm, m;\n        m = l.interpolate(h, 0.5, mode);\n        lm = m.luminance();\n        if (Math.abs(lum - lm) < eps || !max_iter--) {\n          return m;\n        }\n        if (lm > lum) {\n          return test(l, m);\n        }\n        return test(m, h);\n      };\n      if (cur_lum > lum) {\n        rgba = test(chroma('black'), this).rgba();\n      } else {\n        rgba = test(this, chroma('white')).rgba();\n      }\n    }\n    return chroma(rgba).alpha(this.alpha());\n  };\n\n  temperature2rgb = function(kelvin) {\n    var b, g, r, temp;\n    temp = kelvin / 100;\n    if (temp < 66) {\n      r = 255;\n      g = -155.25485562709179 - 0.44596950469579133 * (g = temp - 2) + 104.49216199393888 * log(g);\n      b = temp < 20 ? 0 : -254.76935184120902 + 0.8274096064007395 * (b = temp - 10) + 115.67994401066147 * log(b);\n    } else {\n      r = 351.97690566805693 + 0.114206453784165 * (r = temp - 55) - 40.25366309332127 * log(r);\n      g = 325.4494125711974 + 0.07943456536662342 * (g = temp - 50) - 28.0852963507957 * log(g);\n      b = 255;\n    }\n    return [r, g, b];\n  };\n\n  rgb2temperature = function() {\n    var b, eps, g, maxTemp, minTemp, r, ref, rgb, temp;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    minTemp = 1000;\n    maxTemp = 40000;\n    eps = 0.4;\n    while (maxTemp - minTemp > eps) {\n      temp = (maxTemp + minTemp) * 0.5;\n      rgb = temperature2rgb(temp);\n      if ((rgb[2] / rgb[0]) >= (b / r)) {\n        maxTemp = temp;\n      } else {\n        minTemp = temp;\n      }\n    }\n    return round(temp);\n  };\n\n  chroma.temperature = chroma.kelvin = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['temperature']), function(){});\n  };\n\n  _input.temperature = _input.kelvin = _input.K = temperature2rgb;\n\n  Color.prototype.temperature = function() {\n    return rgb2temperature(this._rgb);\n  };\n\n  Color.prototype.kelvin = Color.prototype.temperature;\n\n  chroma.contrast = function(a, b) {\n    var l1, l2, ref, ref1;\n    if ((ref = type(a)) === 'string' || ref === 'number') {\n      a = new Color(a);\n    }\n    if ((ref1 = type(b)) === 'string' || ref1 === 'number') {\n      b = new Color(b);\n    }\n    l1 = a.luminance();\n    l2 = b.luminance();\n    if (l1 > l2) {\n      return (l1 + 0.05) / (l2 + 0.05);\n    } else {\n      return (l2 + 0.05) / (l1 + 0.05);\n    }\n  };\n\n  chroma.distance = function(a, b, mode) {\n    var d, i, l1, l2, ref, ref1, sum_sq;\n    if (mode == null) {\n      mode = 'lab';\n    }\n    if ((ref = type(a)) === 'string' || ref === 'number') {\n      a = new Color(a);\n    }\n    if ((ref1 = type(b)) === 'string' || ref1 === 'number') {\n      b = new Color(b);\n    }\n    l1 = a.get(mode);\n    l2 = b.get(mode);\n    sum_sq = 0;\n    for (i in l1) {\n      d = (l1[i] || 0) - (l2[i] || 0);\n      sum_sq += d * d;\n    }\n    return Math.sqrt(sum_sq);\n  };\n\n  chroma.deltaE = function(a, b, L, C) {\n    var L1, L2, a1, a2, b1, b2, c1, c2, c4, dH2, delA, delB, delC, delL, f, h1, ref, ref1, ref2, ref3, sc, sh, sl, t, v1, v2, v3;\n    if (L == null) {\n      L = 1;\n    }\n    if (C == null) {\n      C = 1;\n    }\n    if ((ref = type(a)) === 'string' || ref === 'number') {\n      a = new Color(a);\n    }\n    if ((ref1 = type(b)) === 'string' || ref1 === 'number') {\n      b = new Color(b);\n    }\n    ref2 = a.lab(), L1 = ref2[0], a1 = ref2[1], b1 = ref2[2];\n    ref3 = b.lab(), L2 = ref3[0], a2 = ref3[1], b2 = ref3[2];\n    c1 = sqrt(a1 * a1 + b1 * b1);\n    c2 = sqrt(a2 * a2 + b2 * b2);\n    sl = L1 < 16.0 ? 0.511 : (0.040975 * L1) / (1.0 + 0.01765 * L1);\n    sc = (0.0638 * c1) / (1.0 + 0.0131 * c1) + 0.638;\n    h1 = c1 < 0.000001 ? 0.0 : (atan2(b1, a1) * 180.0) / PI;\n    while (h1 < 0) {\n      h1 += 360;\n    }\n    while (h1 >= 360) {\n      h1 -= 360;\n    }\n    t = (h1 >= 164.0) && (h1 <= 345.0) ? 0.56 + abs(0.2 * cos((PI * (h1 + 168.0)) / 180.0)) : 0.36 + abs(0.4 * cos((PI * (h1 + 35.0)) / 180.0));\n    c4 = c1 * c1 * c1 * c1;\n    f = sqrt(c4 / (c4 + 1900.0));\n    sh = sc * (f * t + 1.0 - f);\n    delL = L1 - L2;\n    delC = c1 - c2;\n    delA = a1 - a2;\n    delB = b1 - b2;\n    dH2 = delA * delA + delB * delB - delC * delC;\n    v1 = delL / (L * sl);\n    v2 = delC / (C * sc);\n    v3 = sh;\n    return sqrt(v1 * v1 + v2 * v2 + (dH2 / (v3 * v3)));\n  };\n\n  Color.prototype.get = function(modechan) {\n    var channel, i, me, mode, ref, src;\n    me = this;\n    ref = modechan.split('.'), mode = ref[0], channel = ref[1];\n    src = me[mode]();\n    if (channel) {\n      i = mode.indexOf(channel);\n      if (i > -1) {\n        return src[i];\n      } else {\n        return console.warn('unknown channel ' + channel + ' in mode ' + mode);\n      }\n    } else {\n      return src;\n    }\n  };\n\n  Color.prototype.set = function(modechan, value) {\n    var channel, i, me, mode, ref, src;\n    me = this;\n    ref = modechan.split('.'), mode = ref[0], channel = ref[1];\n    if (channel) {\n      src = me[mode]();\n      i = mode.indexOf(channel);\n      if (i > -1) {\n        if (type(value) === 'string') {\n          switch (value.charAt(0)) {\n            case '+':\n              src[i] += +value;\n              break;\n            case '-':\n              src[i] += +value;\n              break;\n            case '*':\n              src[i] *= +(value.substr(1));\n              break;\n            case '/':\n              src[i] /= +(value.substr(1));\n              break;\n            default:\n              src[i] = +value;\n          }\n        } else {\n          src[i] = value;\n        }\n      } else {\n        console.warn('unknown channel ' + channel + ' in mode ' + mode);\n      }\n    } else {\n      src = value;\n    }\n    return chroma(src, mode).alpha(me.alpha());\n  };\n\n  Color.prototype.clipped = function() {\n    return this._rgb._clipped || false;\n  };\n\n  Color.prototype.alpha = function(a) {\n    if (arguments.length) {\n      return chroma.rgb([this._rgb[0], this._rgb[1], this._rgb[2], a]);\n    }\n    return this._rgb[3];\n  };\n\n  Color.prototype.darken = function(amount) {\n    var lab, me;\n    if (amount == null) {\n      amount = 1;\n    }\n    me = this;\n    lab = me.lab();\n    lab[0] -= LAB_CONSTANTS.Kn * amount;\n    return chroma.lab(lab).alpha(me.alpha());\n  };\n\n  Color.prototype.brighten = function(amount) {\n    if (amount == null) {\n      amount = 1;\n    }\n    return this.darken(-amount);\n  };\n\n  Color.prototype.darker = Color.prototype.darken;\n\n  Color.prototype.brighter = Color.prototype.brighten;\n\n  Color.prototype.saturate = function(amount) {\n    var lch, me;\n    if (amount == null) {\n      amount = 1;\n    }\n    me = this;\n    lch = me.lch();\n    lch[1] += amount * LAB_CONSTANTS.Kn;\n    if (lch[1] < 0) {\n      lch[1] = 0;\n    }\n    return chroma.lch(lch).alpha(me.alpha());\n  };\n\n  Color.prototype.desaturate = function(amount) {\n    if (amount == null) {\n      amount = 1;\n    }\n    return this.saturate(-amount);\n  };\n\n  Color.prototype.premultiply = function() {\n    var a, rgb;\n    rgb = this.rgb();\n    a = this.alpha();\n    return chroma(rgb[0] * a, rgb[1] * a, rgb[2] * a, a);\n  };\n\n  blend = function(bottom, top, mode) {\n    if (!blend[mode]) {\n      throw 'unknown blend mode ' + mode;\n    }\n    return blend[mode](bottom, top);\n  };\n\n  blend_f = function(f) {\n    return function(bottom, top) {\n      var c0, c1;\n      c0 = chroma(top).rgb();\n      c1 = chroma(bottom).rgb();\n      return chroma(f(c0, c1), 'rgb');\n    };\n  };\n\n  each = function(f) {\n    return function(c0, c1) {\n      var i, o, out;\n      out = [];\n      for (i = o = 0; o <= 3; i = ++o) {\n        out[i] = f(c0[i], c1[i]);\n      }\n      return out;\n    };\n  };\n\n  normal = function(a, b) {\n    return a;\n  };\n\n  multiply = function(a, b) {\n    return a * b / 255;\n  };\n\n  darken = function(a, b) {\n    if (a > b) {\n      return b;\n    } else {\n      return a;\n    }\n  };\n\n  lighten = function(a, b) {\n    if (a > b) {\n      return a;\n    } else {\n      return b;\n    }\n  };\n\n  screen = function(a, b) {\n    return 255 * (1 - (1 - a / 255) * (1 - b / 255));\n  };\n\n  overlay = function(a, b) {\n    if (b < 128) {\n      return 2 * a * b / 255;\n    } else {\n      return 255 * (1 - 2 * (1 - a / 255) * (1 - b / 255));\n    }\n  };\n\n  burn = function(a, b) {\n    return 255 * (1 - (1 - b / 255) / (a / 255));\n  };\n\n  dodge = function(a, b) {\n    if (a === 255) {\n      return 255;\n    }\n    a = 255 * (b / 255) / (1 - a / 255);\n    if (a > 255) {\n      return 255;\n    } else {\n      return a;\n    }\n  };\n\n  blend.normal = blend_f(each(normal));\n\n  blend.multiply = blend_f(each(multiply));\n\n  blend.screen = blend_f(each(screen));\n\n  blend.overlay = blend_f(each(overlay));\n\n  blend.darken = blend_f(each(darken));\n\n  blend.lighten = blend_f(each(lighten));\n\n  blend.dodge = blend_f(each(dodge));\n\n  blend.burn = blend_f(each(burn));\n\n  chroma.blend = blend;\n\n  chroma.analyze = function(data) {\n    var len, o, r, val;\n    r = {\n      min: Number.MAX_VALUE,\n      max: Number.MAX_VALUE * -1,\n      sum: 0,\n      values: [],\n      count: 0\n    };\n    for (o = 0, len = data.length; o < len; o++) {\n      val = data[o];\n      if ((val != null) && !isNaN(val)) {\n        r.values.push(val);\n        r.sum += val;\n        if (val < r.min) {\n          r.min = val;\n        }\n        if (val > r.max) {\n          r.max = val;\n        }\n        r.count += 1;\n      }\n    }\n    r.domain = [r.min, r.max];\n    r.limits = function(mode, num) {\n      return chroma.limits(r, mode, num);\n    };\n    return r;\n  };\n\n  chroma.scale = function(colors, positions) {\n    var _classes, _colorCache, _colors, _correctLightness, _domain, _fixed, _gamma, _max, _min, _mode, _nacol, _out, _padding, _pos, _spread, _useCache, classifyValue, f, getClass, getColor, resetCache, setColors, tmap;\n    _mode = 'rgb';\n    _nacol = chroma('#ccc');\n    _spread = 0;\n    _fixed = false;\n    _domain = [0, 1];\n    _pos = [];\n    _padding = [0, 0];\n    _classes = false;\n    _colors = [];\n    _out = false;\n    _min = 0;\n    _max = 1;\n    _correctLightness = false;\n    _colorCache = {};\n    _useCache = true;\n    _gamma = 1;\n    setColors = function(colors) {\n      var c, col, o, ref, ref1, w;\n      if (colors == null) {\n        colors = ['#fff', '#000'];\n      }\n      if ((colors != null) && type(colors) === 'string' && (chroma.brewer != null)) {\n        colors = chroma.brewer[colors] || chroma.brewer[colors.toLowerCase()] || colors;\n      }\n      if (type(colors) === 'array') {\n        if (colors.length === 1) {\n          colors = [colors[0], colors[0]];\n        }\n        colors = colors.slice(0);\n        for (c = o = 0, ref = colors.length - 1; 0 <= ref ? o <= ref : o >= ref; c = 0 <= ref ? ++o : --o) {\n          col = colors[c];\n          if (type(col) === \"string\") {\n            colors[c] = chroma(col);\n          }\n        }\n        _pos.length = 0;\n        for (c = w = 0, ref1 = colors.length - 1; 0 <= ref1 ? w <= ref1 : w >= ref1; c = 0 <= ref1 ? ++w : --w) {\n          _pos.push(c / (colors.length - 1));\n        }\n      }\n      resetCache();\n      return _colors = colors;\n    };\n    getClass = function(value) {\n      var i, n;\n      if (_classes != null) {\n        n = _classes.length - 1;\n        i = 0;\n        while (i < n && value >= _classes[i]) {\n          i++;\n        }\n        return i - 1;\n      }\n      return 0;\n    };\n    tmap = function(t) {\n      return t;\n    };\n    classifyValue = function(value) {\n      var i, maxc, minc, n, val;\n      val = value;\n      if (_classes.length > 2) {\n        n = _classes.length - 1;\n        i = getClass(value);\n        minc = _classes[0] + (_classes[1] - _classes[0]) * (0 + _spread * 0.5);\n        maxc = _classes[n - 1] + (_classes[n] - _classes[n - 1]) * (1 - _spread * 0.5);\n        val = _min + ((_classes[i] + (_classes[i + 1] - _classes[i]) * 0.5 - minc) / (maxc - minc)) * (_max - _min);\n      }\n      return val;\n    };\n    getColor = function(val, bypassMap) {\n      var c, col, i, k, o, p, ref, t;\n      if (bypassMap == null) {\n        bypassMap = false;\n      }\n      if (isNaN(val) || val === null) {\n        return _nacol;\n      }\n      if (!bypassMap) {\n        if (_classes && _classes.length > 2) {\n          c = getClass(val);\n          t = c / (_classes.length - 2);\n        } else if (_max !== _min) {\n          t = (val - _min) / (_max - _min);\n        } else {\n          t = 1;\n        }\n      } else {\n        t = val;\n      }\n      if (!bypassMap) {\n        t = tmap(t);\n      }\n      if (_gamma !== 1) {\n        t = pow(t, _gamma);\n      }\n      t = _padding[0] + (t * (1 - _padding[0] - _padding[1]));\n      t = Math.min(1, Math.max(0, t));\n      k = Math.floor(t * 10000);\n      if (_useCache && _colorCache[k]) {\n        col = _colorCache[k];\n      } else {\n        if (type(_colors) === 'array') {\n          for (i = o = 0, ref = _pos.length - 1; 0 <= ref ? o <= ref : o >= ref; i = 0 <= ref ? ++o : --o) {\n            p = _pos[i];\n            if (t <= p) {\n              col = _colors[i];\n              break;\n            }\n            if (t >= p && i === _pos.length - 1) {\n              col = _colors[i];\n              break;\n            }\n            if (t > p && t < _pos[i + 1]) {\n              t = (t - p) / (_pos[i + 1] - p);\n              col = chroma.interpolate(_colors[i], _colors[i + 1], t, _mode);\n              break;\n            }\n          }\n        } else if (type(_colors) === 'function') {\n          col = _colors(t);\n        }\n        if (_useCache) {\n          _colorCache[k] = col;\n        }\n      }\n      return col;\n    };\n    resetCache = function() {\n      return _colorCache = {};\n    };\n    setColors(colors);\n    f = function(v) {\n      var c;\n      c = chroma(getColor(v));\n      if (_out && c[_out]) {\n        return c[_out]();\n      } else {\n        return c;\n      }\n    };\n    f.classes = function(classes) {\n      var d;\n      if (classes != null) {\n        if (type(classes) === 'array') {\n          _classes = classes;\n          _domain = [classes[0], classes[classes.length - 1]];\n        } else {\n          d = chroma.analyze(_domain);\n          if (classes === 0) {\n            _classes = [d.min, d.max];\n          } else {\n            _classes = chroma.limits(d, 'e', classes);\n          }\n        }\n        return f;\n      }\n      return _classes;\n    };\n    f.domain = function(domain) {\n      var c, d, k, len, o, ref, w;\n      if (!arguments.length) {\n        return _domain;\n      }\n      _min = domain[0];\n      _max = domain[domain.length - 1];\n      _pos = [];\n      k = _colors.length;\n      if (domain.length === k && _min !== _max) {\n        for (o = 0, len = domain.length; o < len; o++) {\n          d = domain[o];\n          _pos.push((d - _min) / (_max - _min));\n        }\n      } else {\n        for (c = w = 0, ref = k - 1; 0 <= ref ? w <= ref : w >= ref; c = 0 <= ref ? ++w : --w) {\n          _pos.push(c / (k - 1));\n        }\n      }\n      _domain = [_min, _max];\n      return f;\n    };\n    f.mode = function(_m) {\n      if (!arguments.length) {\n        return _mode;\n      }\n      _mode = _m;\n      resetCache();\n      return f;\n    };\n    f.range = function(colors, _pos) {\n      setColors(colors, _pos);\n      return f;\n    };\n    f.out = function(_o) {\n      _out = _o;\n      return f;\n    };\n    f.spread = function(val) {\n      if (!arguments.length) {\n        return _spread;\n      }\n      _spread = val;\n      return f;\n    };\n    f.correctLightness = function(v) {\n      if (v == null) {\n        v = true;\n      }\n      _correctLightness = v;\n      resetCache();\n      if (_correctLightness) {\n        tmap = function(t) {\n          var L0, L1, L_actual, L_diff, L_ideal, max_iter, pol, t0, t1;\n          L0 = getColor(0, true).lab()[0];\n          L1 = getColor(1, true).lab()[0];\n          pol = L0 > L1;\n          L_actual = getColor(t, true).lab()[0];\n          L_ideal = L0 + (L1 - L0) * t;\n          L_diff = L_actual - L_ideal;\n          t0 = 0;\n          t1 = 1;\n          max_iter = 20;\n          while (Math.abs(L_diff) > 1e-2 && max_iter-- > 0) {\n            (function() {\n              if (pol) {\n                L_diff *= -1;\n              }\n              if (L_diff < 0) {\n                t0 = t;\n                t += (t1 - t) * 0.5;\n              } else {\n                t1 = t;\n                t += (t0 - t) * 0.5;\n              }\n              L_actual = getColor(t, true).lab()[0];\n              return L_diff = L_actual - L_ideal;\n            })();\n          }\n          return t;\n        };\n      } else {\n        tmap = function(t) {\n          return t;\n        };\n      }\n      return f;\n    };\n    f.padding = function(p) {\n      if (p != null) {\n        if (type(p) === 'number') {\n          p = [p, p];\n        }\n        _padding = p;\n        return f;\n      } else {\n        return _padding;\n      }\n    };\n    f.colors = function(numColors, out) {\n      var dd, dm, i, o, ref, result, results, samples, w;\n      if (arguments.length < 2) {\n        out = 'hex';\n      }\n      result = [];\n      if (arguments.length === 0) {\n        result = _colors.slice(0);\n      } else if (numColors === 1) {\n        result = [f(0.5)];\n      } else if (numColors > 1) {\n        dm = _domain[0];\n        dd = _domain[1] - dm;\n        result = (function() {\n          results = [];\n          for (var o = 0; 0 <= numColors ? o < numColors : o > numColors; 0 <= numColors ? o++ : o--){ results.push(o); }\n          return results;\n        }).apply(this).map(function(i) {\n          return f(dm + i / (numColors - 1) * dd);\n        });\n      } else {\n        colors = [];\n        samples = [];\n        if (_classes && _classes.length > 2) {\n          for (i = w = 1, ref = _classes.length; 1 <= ref ? w < ref : w > ref; i = 1 <= ref ? ++w : --w) {\n            samples.push((_classes[i - 1] + _classes[i]) * 0.5);\n          }\n        } else {\n          samples = _domain;\n        }\n        result = samples.map(function(v) {\n          return f(v);\n        });\n      }\n      if (chroma[out]) {\n        result = result.map(function(c) {\n          return c[out]();\n        });\n      }\n      return result;\n    };\n    f.cache = function(c) {\n      if (c != null) {\n        _useCache = c;\n        return f;\n      } else {\n        return _useCache;\n      }\n    };\n    f.gamma = function(g) {\n      if (g != null) {\n        _gamma = g;\n        return f;\n      } else {\n        return _gamma;\n      }\n    };\n    f.nodata = function(d) {\n      if (d != null) {\n        _nacol = chroma(d);\n        return f;\n      } else {\n        return _nacol;\n      }\n    };\n    return f;\n  };\n\n  if (chroma.scales == null) {\n    chroma.scales = {};\n  }\n\n  chroma.scales.cool = function() {\n    return chroma.scale([chroma.hsl(180, 1, .9), chroma.hsl(250, .7, .4)]);\n  };\n\n  chroma.scales.hot = function() {\n    return chroma.scale(['#000', '#f00', '#ff0', '#fff'], [0, .25, .75, 1]).mode('rgb');\n  };\n\n  chroma.analyze = function(data, key, filter) {\n    var add, k, len, o, r, val, visit;\n    r = {\n      min: Number.MAX_VALUE,\n      max: Number.MAX_VALUE * -1,\n      sum: 0,\n      values: [],\n      count: 0\n    };\n    if (filter == null) {\n      filter = function() {\n        return true;\n      };\n    }\n    add = function(val) {\n      if ((val != null) && !isNaN(val)) {\n        r.values.push(val);\n        r.sum += val;\n        if (val < r.min) {\n          r.min = val;\n        }\n        if (val > r.max) {\n          r.max = val;\n        }\n        r.count += 1;\n      }\n    };\n    visit = function(val, k) {\n      if (filter(val, k)) {\n        if ((key != null) && type(key) === 'function') {\n          return add(key(val));\n        } else if ((key != null) && type(key) === 'string' || type(key) === 'number') {\n          return add(val[key]);\n        } else {\n          return add(val);\n        }\n      }\n    };\n    if (type(data) === 'array') {\n      for (o = 0, len = data.length; o < len; o++) {\n        val = data[o];\n        visit(val);\n      }\n    } else {\n      for (k in data) {\n        val = data[k];\n        visit(val, k);\n      }\n    }\n    r.domain = [r.min, r.max];\n    r.limits = function(mode, num) {\n      return chroma.limits(r, mode, num);\n    };\n    return r;\n  };\n\n  chroma.limits = function(data, mode, num) {\n    var aa, ab, ac, ad, ae, af, ag, ah, ai, aj, ak, al, am, assignments, best, centroids, cluster, clusterSizes, dist, i, j, kClusters, limits, max_log, min, min_log, mindist, n, nb_iters, newCentroids, o, p, pb, pr, ref, ref1, ref10, ref11, ref12, ref13, ref14, ref2, ref3, ref4, ref5, ref6, ref7, ref8, ref9, repeat, sum, tmpKMeansBreaks, v, value, values, w;\n    if (mode == null) {\n      mode = 'equal';\n    }\n    if (num == null) {\n      num = 7;\n    }\n    if (type(data) === 'array') {\n      data = chroma.analyze(data);\n    }\n    min = data.min;\n    max = data.max;\n    sum = data.sum;\n    values = data.values.sort(function(a, b) {\n      return a - b;\n    });\n    if (num === 1) {\n      return [min, max];\n    }\n    limits = [];\n    if (mode.substr(0, 1) === 'c') {\n      limits.push(min);\n      limits.push(max);\n    }\n    if (mode.substr(0, 1) === 'e') {\n      limits.push(min);\n      for (i = o = 1, ref = num - 1; 1 <= ref ? o <= ref : o >= ref; i = 1 <= ref ? ++o : --o) {\n        limits.push(min + (i / num) * (max - min));\n      }\n      limits.push(max);\n    } else if (mode.substr(0, 1) === 'l') {\n      if (min <= 0) {\n        throw 'Logarithmic scales are only possible for values > 0';\n      }\n      min_log = Math.LOG10E * log(min);\n      max_log = Math.LOG10E * log(max);\n      limits.push(min);\n      for (i = w = 1, ref1 = num - 1; 1 <= ref1 ? w <= ref1 : w >= ref1; i = 1 <= ref1 ? ++w : --w) {\n        limits.push(pow(10, min_log + (i / num) * (max_log - min_log)));\n      }\n      limits.push(max);\n    } else if (mode.substr(0, 1) === 'q') {\n      limits.push(min);\n      for (i = aa = 1, ref2 = num - 1; 1 <= ref2 ? aa <= ref2 : aa >= ref2; i = 1 <= ref2 ? ++aa : --aa) {\n        p = (values.length - 1) * i / num;\n        pb = floor(p);\n        if (pb === p) {\n          limits.push(values[pb]);\n        } else {\n          pr = p - pb;\n          limits.push(values[pb] * (1 - pr) + values[pb + 1] * pr);\n        }\n      }\n      limits.push(max);\n    } else if (mode.substr(0, 1) === 'k') {\n\n      /*\n      implementation based on\n      http://code.google.com/p/figue/source/browse/trunk/figue.js#336\n      simplified for 1-d input values\n       */\n      n = values.length;\n      assignments = new Array(n);\n      clusterSizes = new Array(num);\n      repeat = true;\n      nb_iters = 0;\n      centroids = null;\n      centroids = [];\n      centroids.push(min);\n      for (i = ab = 1, ref3 = num - 1; 1 <= ref3 ? ab <= ref3 : ab >= ref3; i = 1 <= ref3 ? ++ab : --ab) {\n        centroids.push(min + (i / num) * (max - min));\n      }\n      centroids.push(max);\n      while (repeat) {\n        for (j = ac = 0, ref4 = num - 1; 0 <= ref4 ? ac <= ref4 : ac >= ref4; j = 0 <= ref4 ? ++ac : --ac) {\n          clusterSizes[j] = 0;\n        }\n        for (i = ad = 0, ref5 = n - 1; 0 <= ref5 ? ad <= ref5 : ad >= ref5; i = 0 <= ref5 ? ++ad : --ad) {\n          value = values[i];\n          mindist = Number.MAX_VALUE;\n          for (j = ae = 0, ref6 = num - 1; 0 <= ref6 ? ae <= ref6 : ae >= ref6; j = 0 <= ref6 ? ++ae : --ae) {\n            dist = abs(centroids[j] - value);\n            if (dist < mindist) {\n              mindist = dist;\n              best = j;\n            }\n          }\n          clusterSizes[best]++;\n          assignments[i] = best;\n        }\n        newCentroids = new Array(num);\n        for (j = af = 0, ref7 = num - 1; 0 <= ref7 ? af <= ref7 : af >= ref7; j = 0 <= ref7 ? ++af : --af) {\n          newCentroids[j] = null;\n        }\n        for (i = ag = 0, ref8 = n - 1; 0 <= ref8 ? ag <= ref8 : ag >= ref8; i = 0 <= ref8 ? ++ag : --ag) {\n          cluster = assignments[i];\n          if (newCentroids[cluster] === null) {\n            newCentroids[cluster] = values[i];\n          } else {\n            newCentroids[cluster] += values[i];\n          }\n        }\n        for (j = ah = 0, ref9 = num - 1; 0 <= ref9 ? ah <= ref9 : ah >= ref9; j = 0 <= ref9 ? ++ah : --ah) {\n          newCentroids[j] *= 1 / clusterSizes[j];\n        }\n        repeat = false;\n        for (j = ai = 0, ref10 = num - 1; 0 <= ref10 ? ai <= ref10 : ai >= ref10; j = 0 <= ref10 ? ++ai : --ai) {\n          if (newCentroids[j] !== centroids[i]) {\n            repeat = true;\n            break;\n          }\n        }\n        centroids = newCentroids;\n        nb_iters++;\n        if (nb_iters > 200) {\n          repeat = false;\n        }\n      }\n      kClusters = {};\n      for (j = aj = 0, ref11 = num - 1; 0 <= ref11 ? aj <= ref11 : aj >= ref11; j = 0 <= ref11 ? ++aj : --aj) {\n        kClusters[j] = [];\n      }\n      for (i = ak = 0, ref12 = n - 1; 0 <= ref12 ? ak <= ref12 : ak >= ref12; i = 0 <= ref12 ? ++ak : --ak) {\n        cluster = assignments[i];\n        kClusters[cluster].push(values[i]);\n      }\n      tmpKMeansBreaks = [];\n      for (j = al = 0, ref13 = num - 1; 0 <= ref13 ? al <= ref13 : al >= ref13; j = 0 <= ref13 ? ++al : --al) {\n        tmpKMeansBreaks.push(kClusters[j][0]);\n        tmpKMeansBreaks.push(kClusters[j][kClusters[j].length - 1]);\n      }\n      tmpKMeansBreaks = tmpKMeansBreaks.sort(function(a, b) {\n        return a - b;\n      });\n      limits.push(tmpKMeansBreaks[0]);\n      for (i = am = 1, ref14 = tmpKMeansBreaks.length - 1; am <= ref14; i = am += 2) {\n        v = tmpKMeansBreaks[i];\n        if (!isNaN(v) && limits.indexOf(v) === -1) {\n          limits.push(v);\n        }\n      }\n    }\n    return limits;\n  };\n\n  hsi2rgb = function(h, s, i) {\n\n    /*\n    borrowed from here:\n    http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/hsi2rgb.cpp\n     */\n    var args, b, g, r;\n    args = unpack(arguments);\n    h = args[0], s = args[1], i = args[2];\n    if (isNaN(h)) {\n      h = 0;\n    }\n    h /= 360;\n    if (h < 1 / 3) {\n      b = (1 - s) / 3;\n      r = (1 + s * cos(TWOPI * h) / cos(PITHIRD - TWOPI * h)) / 3;\n      g = 1 - (b + r);\n    } else if (h < 2 / 3) {\n      h -= 1 / 3;\n      r = (1 - s) / 3;\n      g = (1 + s * cos(TWOPI * h) / cos(PITHIRD - TWOPI * h)) / 3;\n      b = 1 - (r + g);\n    } else {\n      h -= 2 / 3;\n      g = (1 - s) / 3;\n      b = (1 + s * cos(TWOPI * h) / cos(PITHIRD - TWOPI * h)) / 3;\n      r = 1 - (g + b);\n    }\n    r = limit(i * r * 3);\n    g = limit(i * g * 3);\n    b = limit(i * b * 3);\n    return [r * 255, g * 255, b * 255, args.length > 3 ? args[3] : 1];\n  };\n\n  rgb2hsi = function() {\n\n    /*\n    borrowed from here:\n    http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/rgb2hsi.cpp\n     */\n    var b, g, h, i, min, r, ref, s;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    TWOPI = Math.PI * 2;\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    min = Math.min(r, g, b);\n    i = (r + g + b) / 3;\n    s = 1 - min / i;\n    if (s === 0) {\n      h = 0;\n    } else {\n      h = ((r - g) + (r - b)) / 2;\n      h /= Math.sqrt((r - g) * (r - g) + (r - b) * (g - b));\n      h = Math.acos(h);\n      if (b > g) {\n        h = TWOPI - h;\n      }\n      h /= TWOPI;\n    }\n    return [h * 360, s, i];\n  };\n\n  chroma.hsi = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hsi']), function(){});\n  };\n\n  _input.hsi = hsi2rgb;\n\n  Color.prototype.hsi = function() {\n    return rgb2hsi(this._rgb);\n  };\n\n  interpolate_hsx = function(col1, col2, f, m) {\n    var dh, hue, hue0, hue1, lbv, lbv0, lbv1, res, sat, sat0, sat1, xyz0, xyz1;\n    if (m === 'hsl') {\n      xyz0 = col1.hsl();\n      xyz1 = col2.hsl();\n    } else if (m === 'hsv') {\n      xyz0 = col1.hsv();\n      xyz1 = col2.hsv();\n    } else if (m === 'hcg') {\n      xyz0 = col1.hcg();\n      xyz1 = col2.hcg();\n    } else if (m === 'hsi') {\n      xyz0 = col1.hsi();\n      xyz1 = col2.hsi();\n    } else if (m === 'lch' || m === 'hcl') {\n      m = 'hcl';\n      xyz0 = col1.hcl();\n      xyz1 = col2.hcl();\n    }\n    if (m.substr(0, 1) === 'h') {\n      hue0 = xyz0[0], sat0 = xyz0[1], lbv0 = xyz0[2];\n      hue1 = xyz1[0], sat1 = xyz1[1], lbv1 = xyz1[2];\n    }\n    if (!isNaN(hue0) && !isNaN(hue1)) {\n      if (hue1 > hue0 && hue1 - hue0 > 180) {\n        dh = hue1 - (hue0 + 360);\n      } else if (hue1 < hue0 && hue0 - hue1 > 180) {\n        dh = hue1 + 360 - hue0;\n      } else {\n        dh = hue1 - hue0;\n      }\n      hue = hue0 + f * dh;\n    } else if (!isNaN(hue0)) {\n      hue = hue0;\n      if ((lbv1 === 1 || lbv1 === 0) && m !== 'hsv') {\n        sat = sat0;\n      }\n    } else if (!isNaN(hue1)) {\n      hue = hue1;\n      if ((lbv0 === 1 || lbv0 === 0) && m !== 'hsv') {\n        sat = sat1;\n      }\n    } else {\n      hue = Number.NaN;\n    }\n    if (sat == null) {\n      sat = sat0 + f * (sat1 - sat0);\n    }\n    lbv = lbv0 + f * (lbv1 - lbv0);\n    return res = chroma[m](hue, sat, lbv);\n  };\n\n  _interpolators = _interpolators.concat((function() {\n    var len, o, ref, results;\n    ref = ['hsv', 'hsl', 'hsi', 'hcl', 'lch', 'hcg'];\n    results = [];\n    for (o = 0, len = ref.length; o < len; o++) {\n      m = ref[o];\n      results.push([m, interpolate_hsx]);\n    }\n    return results;\n  })());\n\n  interpolate_num = function(col1, col2, f, m) {\n    var n1, n2;\n    n1 = col1.num();\n    n2 = col2.num();\n    return chroma.num(n1 + (n2 - n1) * f, 'num');\n  };\n\n  _interpolators.push(['num', interpolate_num]);\n\n  interpolate_lab = function(col1, col2, f, m) {\n    var res, xyz0, xyz1;\n    xyz0 = col1.lab();\n    xyz1 = col2.lab();\n    return res = new Color(xyz0[0] + f * (xyz1[0] - xyz0[0]), xyz0[1] + f * (xyz1[1] - xyz0[1]), xyz0[2] + f * (xyz1[2] - xyz0[2]), m);\n  };\n\n  _interpolators.push(['lab', interpolate_lab]);\n\n}).call(this);\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\n// Singleton `WeakMap`s to store metadata for td/th elements, as well as the\n// datagrids themselves for each `<perspective-viewer>`\nexport const METADATA_MAP = new WeakMap();\n\n// Output runtime debug info like FPS.\nexport const DEBUG = true;\n\n// The largest size virtual <div> in (px) that Chrome can support without\n// glitching.\nconst isFirefox = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\nexport const BROWSER_MAX_HEIGHT = isFirefox ? 5000000 : 10000000;\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\n/******************************************************************************\n *\n * Profling\n *\n */\n\nlet AVG = 0,\n    TOTAL = 0,\n    START = performance.now();\n\nexport function get_draw_fps() {\n    const now = performance.now();\n    const elapsed = now - START;\n    const avg = AVG;\n    const real_fps = (TOTAL * 1000) / elapsed;\n    const virtual_fps = 1000 / avg;\n    const num_frames = TOTAL;\n    AVG = 0;\n    TOTAL = 0;\n    START = now;\n    return { avg, real_fps, virtual_fps, num_frames, elapsed };\n}\n\nexport function log_perf(x) {\n    AVG = (AVG * TOTAL + x) / (TOTAL + 1);\n    TOTAL += 1;\n}\n\n/******************************************************************************\n *\n * Utils\n *\n */\n\n/**\n * A class method decorate for memoizing method results.  Only works on one\n * arg.\n */\nexport function memoize(_target, _property, descriptor) {\n    const cache = new Map();\n    const func = descriptor.value;\n    descriptor.value = new_func;\n    return descriptor;\n    function new_func(arg) {\n        if (cache.has(arg)) {\n            return cache.get(arg);\n        } else {\n            const res = func.call(this, arg);\n            cache.set(arg, res);\n            return res;\n        }\n    }\n}\n\n/**\n * Identical to a non-tagger template literal, this is only used to indicate to\n * babel that this string should be HTML-minified on production builds.\n */\nexport const html = (strings, ...args) =>\n    strings\n        .map((str, i) => [str, args[i]])\n        .flat()\n        .filter((a) => !!a)\n        .join(\"\");\n\nconst invertPromise = () => {\n    let _resolve;\n    const promise = new Promise((resolve) => {\n        _resolve = resolve;\n    });\n    promise.resolve = _resolve;\n    return promise;\n};\nconst TAGS = new Map();\n\nexport async function flush_tag(tag) {\n    await new Promise(requestAnimationFrame);\n    return await TAGS.get(tag);\n}\n\nexport async function throttle_tag(tag, f) {\n    if (TAGS.has(tag)) {\n        await TAGS.get(tag);\n        if (TAGS.has(tag)) {\n            await TAGS.get(tag);\n            return;\n        }\n    }\n\n    TAGS.set(tag, invertPromise());\n    try {\n        return await f();\n    } finally {\n        const l = TAGS.get(tag);\n        TAGS.delete(tag);\n        l.resolve();\n    }\n}\n", ":host{position:absolute;top:0px;left:0px;right:0px;bottom:0px;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch;}div.rt-virtual-panel{position:absolute;top:0;left:0;right:0;pointer-events:none;}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%;}div.rt-tree-container{display:flex;align-items:center;height:100%;}slot{position:absolute;overflow:hidden;overflow-anchor:none;}", ":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px;}", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport { log_perf, html, throttle_tag, flush_tag } from \"./utils\";\nimport { DEBUG, BROWSER_MAX_HEIGHT } from \"./constants\";\n\nimport container_css from \"../../dist/css/container.css\";\nimport sub_cell_offsets from \"../../dist/css/sub-cell-offsets.css\";\n\n/**\n * Handles the virtual scroll pane, as well as the double buffering\n * of the underlying <table>. This DOM structure looks a little like\n * this:\n *\n *     +------------------------+      <- regular-table\n *     | +----------------------|------<- div.rt-virtual-panel\n *     | | +------------------+ |      <- div.rt-scroll-table-clip\n *     | | | +----------------|-|--+   <- table             |\n *     | | | | 1  A  Alabama  | |  |                        |\n *     | | | | 2  B  Arizona  | |  |                        |\n *     | | | | 3  C  Arkansas | |  |                        |\n *     | | | | 4  D  Californi| |  |                        |\n *     | | | | 5  E  Colorado | |  |                        |\n *     | | +------------------+ |  |                        |\n *     +------------------------+  |                        |\n *       |   | 8  H  District of C |                        |\n *       |   +---------------------+                        |\n *       |                                                  |\n *       |                                                  |\n *       |                                                  |\n *       |                                                  |\n *       |                                                  |\n *       +--------------------------------------------------+\n *\n * `overflow: auto` is applied to `.rt-scroll-container`, and `.rt-virtual-pane`\n * is sized to match the estimated \"virtual\" size of the `table`;  estimated,\n * because it's true size can't be known until all columns dimensions are known,\n * which may be deferred in the case of auto-sized tables.\n *\n * Double buffering can be enabled on \"column scroll\", \"row scroll\" and/or\n * \"column schema change\".  When enabled and a redraw is requested for the case,\n * the existing table is cloned with `cloneNode()` and swapped with the real\n * `table`, which is then updated offscreen and swapped back in.  While this is\n * much slower to render, it prevents draw-in.\n *\n * @class RegularVirtualTableViewModel\n */\nexport class RegularVirtualTableViewModel extends HTMLElement {\n    /**\n     * Create the DOM for this `shadowRoot`.\n     *\n     * TODO deprecated\n     * `MATERIAL_STYLE` is needed both here, and in the document `<head>`, due\n     * to double buffering, which may read incorrect position/size values as the\n     * double buffered `<table>` is rendered in the shadow DOM before being\n     * swapped in.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     */\n    create_shadow_dom() {\n        this.attachShadow({ mode: \"open\" });\n        const slot = `<slot></slot>`;\n\n        this.shadowRoot.innerHTML = html`\n            <style>\n                ${container_css}\n            </style>\n            <style>\n                ${sub_cell_offsets}\n            </style>\n            <div class=\"rt-virtual-panel\"></div>\n            <div class=\"rt-scroll-table-clip\">${slot}</div>\n        `;\n\n        const [, style, virtual_panel, table_clip] = this.shadowRoot.children;\n        this._sub_cell_style = style;\n        this._table_clip = table_clip;\n        this._virtual_panel = virtual_panel;\n        this._setup_virtual_scroll();\n    }\n\n    _setup_virtual_scroll() {\n        if (this._table_clip) {\n            if (\n                this._virtual_mode === \"both\" ||\n                this._virtual_mode === \"vertical\"\n            ) {\n                this._table_clip.style.top = \"0px\";\n            } else {\n                this._table_clip.style.removeProperty(\"top\");\n            }\n\n            if (\n                this._virtual_mode === \"both\" ||\n                this._virtual_mode === \"horizontal\"\n            ) {\n                this._table_clip.style.left = \"0px\";\n            } else {\n                this._table_clip.style.removeProperty(\"left\");\n            }\n\n            if (this._virtual_mode !== \"both\") {\n                this._table_clip.style.contain = \"none\";\n            } else {\n                this._table_clip.style.removeProperty(\"contain\");\n            }\n        }\n    }\n\n    /**\n     * Calculates the `viewport` argument for perspective's `to_columns` method.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} nrows\n     * @returns\n     */\n    _calculate_viewport(nrows, num_columns) {\n        const { start_row, end_row } = this._calculate_row_range(nrows);\n        const { start_col, end_col } =\n            this._calculate_column_range(num_columns);\n        this._nrows = nrows;\n        return { start_col, end_col, start_row, end_row };\n    }\n\n    /**\n     * Calculate `start_row` and `end_row` for the viewport.  We do this by\n     * first calculating `total_scroll_height`, the px height of the\n     * scrollable page, from the `_virtual_panel.offsetHeight`.\n     *\n     *    0px +------------+-------------+  - virtual_panel.offsetHeight\n     *        |            |  .          |  . 600px\n     *        |  viewport  |  .          |  .\n     *        |            |  .          |  .\n     *  200px +------------+  - height   |  .  - total_scroll_height\n     *        |                 200px    |  .  . 400px\n     *        |                          |  .  .\n     *        |                          |  .  .\n     *        |                          |  .  .\n     *        |                          |  .  .\n     *  600px +--------------------------+  -  -\n     *\n     *  `percent_scroll` can be calculated from this value and `scrollTop`,\n     *  which we can then apply to the new calculated height to preserve scroll\n     *  position when the height has changed since previous render.\n     *\n     *    0px +--------------------------+  -\n     *        |                          |  .\n     *        |                          |  .\n     *        |                          |  . scrollable area\n     *  300px +------------+             |  .\n     *        |            |             |  .\n     *  - - - |  viewport  | - - - - - - |  - total_scroll_height\n     *        |            |             |    400px\n     *  500px +------------+             |\n     *        |                          |\n     *  600px +--------------------------+\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} nrows\n     * @returns\n     */\n    _calculate_row_range(nrows) {\n        const { height } = this._container_size;\n        const row_height = this._column_sizes.row_height || 19;\n        const header_levels = this._view_cache.config.column_pivots.length;\n        const total_scroll_height = Math.max(\n            1,\n            this._virtual_panel.offsetHeight - height,\n        );\n        const percent_scroll =\n            Math.max(Math.ceil(this.scrollTop), 0) / total_scroll_height;\n        const clip_panel_row_height = height / row_height - header_levels;\n        const relative_nrows = nrows || 0;\n        const scrollable_rows = Math.max(\n            0,\n            relative_nrows - clip_panel_row_height,\n        );\n        const start_row = scrollable_rows * percent_scroll;\n        const end_row = Math.max(\n            0,\n            Math.min(start_row + clip_panel_row_height, nrows),\n        );\n        return { start_row, end_row };\n    }\n\n    _calc_start_column() {\n        const scroll_index_offset = this._view_cache.config.row_pivots.length;\n        let start_col = 0;\n        let offset_width = 0;\n        let diff = 0;\n        while (offset_width < this.scrollLeft) {\n            const new_val =\n                this._column_sizes.indices[start_col + scroll_index_offset];\n            diff = this.scrollLeft - offset_width;\n            start_col += 1;\n            offset_width += new_val !== undefined ? new_val : 60;\n        }\n\n        start_col +=\n            diff /\n            (this._column_sizes.indices[start_col + scroll_index_offset - 1] ||\n                60);\n        return Math.max(0, start_col - 1);\n    }\n\n    /**\n     * Calculates `start_col` and `end_col` for the viewport - most of the\n     * details of which are actually calculated in `_max_column`, the equivalent\n     * of `total_scroll_height` from `_calculate_row_range`.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @returns\n     */\n    _calculate_column_range(num_columns) {\n        if (\n            this._virtual_mode === \"none\" ||\n            this._virtual_mode === \"vertical\"\n        ) {\n            return { start_col: 0, end_col: Infinity };\n        } else {\n            const start_col = this._calc_start_column();\n            const vis_cols =\n                this.table_model.num_columns() ||\n                Math.min(\n                    num_columns,\n                    Math.ceil(this._container_size.width / 60),\n                );\n            let end_col = start_col + vis_cols + 1;\n            return { start_col, end_col };\n        }\n    }\n\n    /**\n     * Calculates the minimum possible starting column index for which the last\n     * column is completely visible (e.g. not occluded by the container clip).\n     * This is assumed to be the # of columns until the column widths are\n     * calculated as they are scrolled into view by the user, which requires\n     * special synchronization with _update_virtual_panel_width`\n     * as the scrollable width will change as the user scrolls left to right.\n     *\n     * Once `_column_sizes.indices` has enough column widths populated from\n     * user scrolling, it calulates the cumulative sum of column widths from\n     * last visible column backwards, until the sum is larger than the viewport\n     * px width, which is 1 below the max scroll column\n     *\n     *               width = 290   = 210     = 100    = 0\n     *   0px               V       V         V        500px\n     *   +-----------------+-------+---------+--------+\n     *   | ..ol B) (Col C) | Col D | Col E   | Col F  |\n     *   |                 | 80px  | 110px   | 100px  |\n     *   |                 |       |         |        |\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @returns\n     */\n    _max_scroll_column(num_columns) {\n        let width = 0;\n        if (this._view_cache.config.row_pivots.length > 0) {\n            for (const w of this._column_sizes.indices.slice(\n                0,\n                this._view_cache.config.row_pivots.length,\n            )) {\n                width += w;\n            }\n        }\n        let scroll_index_offset = this._view_cache.config.row_pivots.length;\n        let max_scroll_column = num_columns;\n        while (width < this._container_size.width && max_scroll_column >= 0) {\n            max_scroll_column--;\n            width +=\n                this._column_sizes.indices[\n                    max_scroll_column + scroll_index_offset\n                ] || 60;\n        }\n\n        return Math.min(num_columns - 1, max_scroll_column + 1);\n    }\n\n    /**\n     * Determines whether the viewport is identical in row and column axes to\n     * the previous viewport rendered, for throttling identical render requests,\n     * e.g. when the logical (row-wise) viewport does not change, but the pixel\n     * viewport has moved a few px.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} {start_col, end_col, start_row, end_row}\n     * @returns\n     */\n    _validate_viewport({ start_col, end_col, start_row, end_row }) {\n        start_row = Math.floor(start_row);\n        end_row = Math.ceil(end_row);\n        start_col = Math.floor(start_col);\n        end_col = Math.ceil(end_col);\n        const invalid_column = this._start_col !== start_col;\n        const invalid_row =\n            this._start_row !== start_row ||\n            this._end_row !== end_row ||\n            this._end_col !== end_col;\n        this._start_col = start_col;\n        this._end_col = end_col;\n        this._start_row = start_row;\n        this._end_row = end_row;\n        return { invalid_column, invalid_row };\n    }\n\n    _calc_scrollable_column_width(num_columns) {\n        let scroll_index_offset = this._view_cache.config.row_pivots.length;\n        const max_scroll_column = this._max_scroll_column(num_columns);\n        let cidx = scroll_index_offset,\n            virtual_width = 0;\n\n        while (cidx < max_scroll_column + scroll_index_offset) {\n            virtual_width += this._column_sizes.indices[cidx] || 60;\n            cidx++;\n        }\n\n        if (cidx < this._column_sizes.indices.length) {\n            let viewport_width = this._column_sizes.indices\n                .slice(0, this._view_cache.config.row_pivots.length)\n                .reduce((x, y) => x + y, 0);\n            virtual_width += Math.max(\n                0,\n                this._column_sizes.indices[cidx] -\n                    (this._container_size.width - viewport_width) || 0,\n            );\n        }\n\n        return virtual_width;\n    }\n\n    /**\n     * Updates the `virtual_panel` width based on view state.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} invalid\n     */\n    _update_virtual_panel_width(invalid, num_columns) {\n        if (invalid) {\n            if (\n                this._virtual_mode === \"vertical\" ||\n                this._virtual_mode === \"none\"\n            ) {\n                this._virtual_panel.style.width =\n                    this._column_sizes.indices.reduce((x, y) => x + y, 0) +\n                    \"px\";\n            } else {\n                const virtual_width =\n                    this._calc_scrollable_column_width(num_columns);\n                if (virtual_width !== 0) {\n                    const panel_width =\n                        this._container_size.width + virtual_width + 2;\n                    this._virtual_panel.style.width = panel_width + \"px\";\n                } else {\n                    this._virtual_panel.style.width = \"1px\";\n                }\n            }\n        }\n    }\n\n    /**\n     * Updates the `virtual_panel` height based on the view state.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} nrows\n     */\n    _update_virtual_panel_height(nrows) {\n        const { row_height = 19 } = this._column_sizes;\n        const header_height =\n            this._view_cache.config.column_pivots.length * row_height;\n        let virtual_panel_px_size;\n        virtual_panel_px_size = Math.min(\n            BROWSER_MAX_HEIGHT,\n            nrows * row_height + header_height,\n        );\n        this._virtual_panel.style.height = `${virtual_panel_px_size}px`;\n    }\n\n    /**\n     * Draws this virtual panel, given an object of render options that allow\n     * the implementor to fine tune the individual render frames based on the\n     * interaction and previous render state.\n     *\n     * @public\n     * @memberof RegularVirtualTableViewModel\n     * @param {DrawOptions} [options]\n     * @param {boolean} [options.invalid_viewport=true]\n     * @param {boolean} [options.preserve_width=false]\n     * @param {boolean} [options.throttle=true]\n     */\n    async draw(options = {}) {\n        if (typeof options.throttle !== \"undefined\" && !options.throttle) {\n            return await internal_draw.call(this, options);\n        } else {\n            return await throttle_tag(this, () =>\n                internal_draw.call(this, options),\n            );\n        }\n    }\n\n    async _draw_flush() {\n        await flush_tag(this);\n    }\n\n    update_sub_cell_offset(viewport) {\n        const y_offset =\n            this._column_sizes.row_height * (viewport.start_row % 1) || 0;\n        const x_offset =\n            this._column_sizes.indices[\n                (this.table_model._row_headers_length || 0) +\n                    Math.floor(viewport.start_col)\n            ] *\n                (viewport.start_col % 1) || 0;\n        let style = this._sub_cell_style.sheet?.cssRules[0].style;\n        if (style) {\n            style.setProperty(`--regular-table--clip-x`, `${x_offset}px`);\n            style.setProperty(`--regular-table--clip-y`, `${y_offset}px`);\n            style.setProperty(`--regular-table--transform-x`, `-${x_offset}px`);\n            style.setProperty(`--regular-table--transform-y`, `-${y_offset}px`);\n        }\n    }\n}\n\nasync function internal_draw(options) {\n    const __debug_start_time__ = DEBUG && performance.now();\n    const { invalid_viewport = true, preserve_width = false } = options;\n    const {\n        num_columns,\n        num_rows,\n        num_row_headers,\n        num_column_headers,\n        row_height,\n    } = await this._view_cache.view(0, 0, 0, 0);\n    if (num_row_headers !== undefined) {\n        this._view_cache.row_pivots = Array(num_row_headers).fill(0);\n    }\n\n    if (num_column_headers !== undefined) {\n        this._view_cache.column_pivots = Array(num_column_headers).fill(0);\n    }\n\n    this._container_size = {\n        width:\n            this._virtual_mode === \"none\" || this._virtual_mode === \"vertical\"\n                ? Infinity\n                : this._table_clip.clientWidth,\n        height:\n            this._virtual_mode === \"none\" || this._virtual_mode === \"horizontal\"\n                ? Infinity\n                : this._table_clip.clientHeight,\n    };\n\n    this._update_virtual_panel_height(num_rows);\n    if (!preserve_width) {\n        this._update_virtual_panel_width(invalid_viewport, num_columns);\n    }\n    const viewport = this._calculate_viewport(num_rows, num_columns);\n    const { invalid_row, invalid_column } = this._validate_viewport(viewport);\n    if (\n        this._invalid_schema ||\n        invalid_row ||\n        invalid_column ||\n        invalid_viewport\n    ) {\n        let autosize_cells = [],\n            needs_sub_cell_update = true;\n        for await (let last_cells of this.table_model.draw(\n            this._container_size,\n            this._view_cache,\n            this._selected_id,\n            preserve_width,\n            viewport,\n            num_columns,\n        )) {\n            if (last_cells !== undefined) {\n                autosize_cells = autosize_cells.concat(last_cells);\n            }\n\n            // We want to perform this before the next event loop so there\n            // is no scroll jitter, but only on the first iteration as\n            // subsequent viewports are incorrect.\n            if (needs_sub_cell_update) {\n                this.update_sub_cell_offset(viewport);\n                needs_sub_cell_update = false;\n            }\n\n            this._is_styling = true;\n            const callbacks = this._style_callbacks;\n            for (const callback of callbacks) {\n                await callback({ detail: this });\n            }\n\n            this._is_styling = false;\n            if (!this._invalidated && last_cells !== undefined) {\n                break;\n            }\n\n            this._invalidated = false;\n        }\n\n        this.table_model.autosize_cells(autosize_cells, row_height);\n        this.table_model.header.reset_header_cache();\n        if (!preserve_width) {\n            this._update_virtual_panel_width(\n                this._invalid_schema || invalid_column,\n                num_columns,\n            );\n        }\n        this._invalid_schema = false;\n    } else {\n        this.update_sub_cell_offset(viewport);\n    }\n\n    if (DEBUG) {\n        log_perf(performance.now() - __debug_start_time__);\n    }\n}\n\n/**\n * Options for the draw method.\n *\n * @public\n * @typedef DrawOptions\n * @type {object}\n * @property {boolean} [invalid_viewport]\n * @property {boolean} [preserve_width]\n */\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport { METADATA_MAP } from \"./constants\";\nimport { RegularVirtualTableViewModel } from \"./scroll_panel\";\nimport { throttle_tag } from \"./utils\";\n\n/**\n * WHen enabled, override iOS overscroll behavior by emulating scroll position\n * in JavaScript.  This prevents \"bounce\" on edges, but it also removes scroll\n * inertia.  This waspreviously enabled by default in `regular-table<=0.4.3`,\n * but this version also had bugged (exaggerated) position calculation.\n * As `0.5.0` introduces sub-cell scrolling by defualt, this is now disabled by\n * default as well.\n */\nconst IOS_DISABLE_OVERSCROLL = false;\n\n/**\n *\n *\n * @class RegularViewEventModel\n * @extends {RegularVirtualTableViewModel}\n */\nexport class RegularViewEventModel extends RegularVirtualTableViewModel {\n    register_listeners() {\n        // // TODO see `_on_click_or_dblclick` method jsdoc\n        // this.addEventListener(\"dblclick\", this._on_dblclick.bind(this));\n\n        this.addEventListener(\n            \"mousedown\",\n            this._on_click_or_dblclick.bind(this),\n        );\n        this.addEventListener(\"scroll\", this._on_scroll.bind(this), {\n            passive: true,\n        });\n\n        this._register_glitch_scroll_listeners();\n    }\n\n    /**\n     *\n     * @internal\n     * @private\n     * @memberof RegularViewEventModel\n     * @returns\n     */\n    async _on_scroll(event) {\n        event.stopPropagation();\n        await this.draw({ invalid_viewport: false });\n        this.dispatchEvent(new CustomEvent(\"regular-table-scroll\"));\n    }\n\n    /**\n     * Modern and mobile browsers implement complex scroll behavior to\n     * implement fancy touch and intertia effects;  these must be intercepted\n     * and disabled to achieve clean virtual scrolling in the presence of a\n     * `fixed` element.\n     *\n     * @internal\n     * @private\n     * @memberof RegularViewEventModel\n     */\n    _register_glitch_scroll_listeners() {\n        this.addEventListener(\"mousewheel\", this._on_mousewheel.bind(this), {\n            passive: true,\n        });\n\n        if (IOS_DISABLE_OVERSCROLL) {\n            this.addEventListener(\"touchmove\", this._on_touchmove.bind(this));\n            this.addEventListener(\n                \"touchstart\",\n                this._on_touchstart.bind(this),\n                {\n                    passive: true,\n                },\n            );\n        }\n    }\n    /**\n     * Mousewheel must precalculate in addition to `_on_scroll` to prevent\n     * visual artifacts due to scrolling \"inertia\" on modern browsers.\n     *\n     * @internal\n     * @private\n     * @memberof RegularViewEventModel\n     * @param {*} event\n     */\n    _on_mousewheel(event) {\n        if (!window.safari) {\n            // **** Apple\n            return;\n        }\n\n        const { clientWidth, clientHeight, scrollTop, scrollLeft } = this;\n        event.preventDefault();\n        event.returnValue = false;\n        const total_scroll_height = Math.max(\n            1,\n            this._virtual_panel.offsetHeight - clientHeight,\n        );\n        const total_scroll_width = Math.max(\n            1,\n            this._virtual_panel.offsetWidth - clientWidth,\n        );\n        this.scrollTop = Math.max(\n            0,\n            Math.min(total_scroll_height, scrollTop + event.deltaY),\n        );\n        this.scrollLeft = Math.max(\n            0,\n            Math.min(total_scroll_width, scrollLeft + event.deltaX),\n        );\n        this._on_scroll(event);\n    }\n\n    /**\n     * Touchmove/touchstart must precalculate in addition to `_on_scroll` to\n     * prevent visual artifacts due to scrolling \"inertia\" on mobile browsers.\n     * This has the unfortunate side-effect of disabling scroll intertia.\n     *\n     * @internal\n     * @private\n     * @memberof RegularViewEventModel\n     * @param {*} event\n     * @returns\n     */\n    _on_touchmove(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        event.returnValue = false;\n        const { clientWidth, clientHeight } = this;\n        const total_scroll_height = Math.max(\n            1,\n            this._virtual_panel.offsetHeight - clientHeight,\n        );\n        const total_scroll_width = Math.max(\n            1,\n            this._virtual_panel.offsetWidth - clientWidth,\n        );\n        this.scrollTop = Math.min(\n            total_scroll_height,\n            this._memo_scroll_top +\n                (this._memo_touch_startY - event.touches[0].pageY),\n        );\n        this.scrollLeft = Math.min(\n            total_scroll_width,\n            this._memo_scroll_left +\n                (this._memo_touch_startX - event.touches[0].pageX),\n        );\n        this._on_scroll(event);\n    }\n\n    _on_touchstart(event) {\n        this._memo_touch_startY = event.touches[0].pageY;\n        this._memo_touch_startX = event.touches[0].pageX;\n        this._memo_scroll_top = this.scrollTop;\n        this._memo_scroll_left = this.scrollLeft;\n    }\n\n    /**\n     * Handles double-click header width override reset.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} event\n     * @returns\n     */\n    async _on_dblclick(event) {\n        let element = event.target;\n        while (element.tagName !== \"TD\" && element.tagName !== \"TH\") {\n            element = element.parentElement;\n            if (!this.contains(element)) {\n                return;\n            }\n        }\n\n        const is_resize = event.target.classList.contains(\"rt-column-resize\");\n        const metadata = METADATA_MAP.get(element);\n        if (is_resize) {\n            event.stopImmediatePropagation();\n            // await new Promise(queueMicrotask);\n            element.style.minWidth = \"\";\n            element.style.maxWidth = \"\";\n            if (event.shiftKey) {\n                this._column_sizes.override = [];\n                this._column_sizes.auto = [];\n                this._column_sizes.indices = [];\n            } else {\n                this._column_sizes.override[metadata.size_key] = undefined;\n                this._column_sizes.auto[metadata.size_key] = undefined;\n                this._column_sizes.indices[metadata.size_key] = undefined;\n            }\n\n            for (const row of event.shiftKey\n                ? [\n                      this.table_model.header.cells[\n                          this.table_model.header.cells.length - 1\n                      ],\n                      ...this.table_model.body.cells,\n                  ]\n                : this.table_model.body.cells) {\n                for (const td of event.shiftKey\n                    ? row\n                    : [row[metadata._virtual_x]]) {\n                    if (!td) {\n                        continue;\n                    }\n\n                    td.style.minWidth = \"\";\n                    td.style.maxWidth = \"\";\n                    td.classList.remove(\"rt-cell-clip\");\n                }\n            }\n\n            await this.draw();\n        }\n    }\n\n    /**\n     * Dispatches all click events to other handlers, depending on\n     * `event.target`.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} event\n     * @returns\n     */\n    async _on_click(event) {\n        if (event.button !== 0) {\n            return;\n        }\n\n        let element = event.target;\n        while (element.tagName !== \"TD\" && element.tagName !== \"TH\") {\n            element = element.parentElement;\n            if (!this.contains(element)) {\n                return;\n            }\n        }\n\n        const is_resize = event.target.classList.contains(\"rt-column-resize\");\n        const metadata = METADATA_MAP.get(element);\n        if (is_resize) {\n            this._on_resize_column(event, element, metadata);\n            event.stopImmediatePropagation();\n        }\n    }\n\n    /**\n     * `dblclick` event does not work reliably for some reason so dispatch this\n     * event in JavaScript instead.\n     * @param {`*`} event\n     */\n    async _on_click_or_dblclick(event) {\n        const now = performance.now();\n        if (this._last_clicked_time && now - this._last_clicked_time < 500) {\n            this._last_clicked_time = now;\n            await this._on_dblclick(event);\n        } else {\n            this._last_clicked_time = now;\n            await this._on_click(event);\n        }\n    }\n\n    /**\n     * Regular event for column resize.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} event\n     * @param {*} element\n     * @param {*} metadata\n     */\n    _on_resize_column(event, element, metadata) {\n        const { _virtual_x, size_key } = metadata;\n        const start = event.pageX;\n        const header_x = _virtual_x + element.colSpan - 1;\n        const header_element =\n            this.table_model.header.get_column_header(header_x);\n        const width = this._column_sizes.indices[size_key];\n        const move = (event) =>\n            throttle_tag(\n                this,\n                async () =>\n                    await this._on_resize_column_move(\n                        event,\n                        header_element,\n                        start,\n                        width,\n                        size_key,\n                        header_x,\n                    ),\n            );\n        const up = () => {\n            document.removeEventListener(\"mousemove\", move);\n            document.removeEventListener(\"mouseup\", up);\n            const override_width = this._column_sizes.override[size_key];\n            const should_redraw =\n                this._column_sizes.indices[size_key] !== override_width;\n            this._column_sizes.indices[size_key] = override_width;\n            if (should_redraw) {\n                this.draw();\n            }\n        };\n\n        document.addEventListener(\"mousemove\", move);\n        document.addEventListener(\"mouseup\", up);\n    }\n\n    /**\n     * Regular event for mouse movement when resizing a column.\n     *\n     * @internal\n     * @private\n     * @memberof RegularVirtualTableViewModel\n     * @param {*} event\n     * @param {*} th\n     * @param {*} start\n     * @param {*} width\n     * @param {*} metadata\n     */\n    async _on_resize_column_move(event, th, start, width, size_key, virtual_x) {\n        await new Promise(requestAnimationFrame);\n        const diff = event.pageX - start;\n        const override_width = Math.max(1, width + diff);\n        this._column_sizes.override[size_key] = override_width;\n\n        // If the column is smaller, new columns may need to be fetched, so\n        // redraw, else just update the DOM widths as if redrawn.\n        if (diff < 0) {\n            await this.draw({ preserve_width: true, throttle: false });\n        } else {\n            th.style.minWidth = override_width + \"px\";\n            th.style.maxWidth = override_width + \"px\";\n            const auto_width = this._column_sizes.auto[size_key];\n            for (const row of this.table_model.body.cells) {\n                const td = row[virtual_x];\n                if (td) {\n                    td.style.maxWidth = td.style.minWidth =\n                        override_width + \"px\";\n                    td.classList.toggle(\n                        \"rt-cell-clip\",\n                        auto_width > override_width,\n                    );\n                }\n            }\n        }\n    }\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport { METADATA_MAP } from \"./constants\";\n\n/******************************************************************************\n *\n * View Model\n *\n */\n\nclass ElemFactory {\n    constructor(name) {\n        this._name = name;\n        this._elements = [];\n        this._index = 0;\n    }\n\n    reset() {\n        this._index = 0;\n    }\n\n    get() {\n        if (!this._elements[this._index]) {\n            this._elements[this._index] = document.createElement(this._name);\n        }\n\n        const elem = this._elements[this._index];\n        this._index += 1;\n        return elem;\n    }\n}\n\nexport class ViewModel {\n    constructor(column_sizes, container, table) {\n        this._column_sizes = column_sizes;\n        this._container = container;\n        this._span_factory = new ElemFactory(\"span\");\n        this.table = table;\n        this.cells = [];\n        this.rows = [];\n    }\n\n    num_columns() {\n        return this._get_row(Math.max(0, this.rows.length - 1)).row_container\n            .length;\n    }\n\n    num_rows() {\n        return this.cells.length;\n    }\n\n    _set_metadata(td, metadata) {\n        METADATA_MAP.set(td, metadata);\n    }\n\n    _get_or_create_metadata(td) {\n        if (td === undefined) {\n            return {};\n        } else if (METADATA_MAP.has(td)) {\n            return METADATA_MAP.get(td);\n        } else {\n            const metadata = {};\n            METADATA_MAP.set(td, metadata);\n            return metadata;\n        }\n    }\n\n    _replace_cell(ridx, cidx) {\n        const { tr, row_container } = this._get_row(ridx);\n        let td = row_container[cidx];\n        if (td) {\n            tr.removeChild(td);\n            row_container.splice(cidx, 1, undefined);\n        }\n        return td;\n    }\n\n    _fetch_cell(ridx, cidx) {\n        if (ridx < 0 || cidx < 0) {\n            return;\n        }\n\n        return this.cells[ridx]?.[cidx];\n    }\n\n    _get_row(ridx) {\n        let tr = this.rows[ridx];\n        if (!tr) {\n            tr = this.rows[ridx] = document.createElement(\"tr\");\n            this.table.appendChild(tr);\n        }\n\n        let row_container = this.cells[ridx];\n        if (!row_container) {\n            row_container = this.cells[ridx] = [];\n        }\n\n        return { tr, row_container };\n    }\n\n    _get_cell(tag = \"TD\", ridx, cidx) {\n        const { tr, row_container } = this._get_row(ridx);\n        let td = row_container[cidx];\n        if (!td) {\n            if (cidx < row_container.length) {\n                td = row_container[cidx] = document.createElement(tag);\n                tr.insertBefore(\n                    td,\n                    row_container.slice(cidx + 1).find((x) => x),\n                );\n            } else {\n                td = row_container[cidx] = document.createElement(tag);\n                tr.appendChild(td);\n            }\n        }\n        if (td.tagName !== tag) {\n            const new_td = document.createElement(tag);\n            tr.replaceChild(new_td, td);\n            this.cells[ridx].splice(cidx, 1, new_td);\n            td = new_td;\n        }\n        return td;\n    }\n\n    _clean_columns(cidx) {\n        for (let i = 0; i < this.rows.length; i++) {\n            const tr = this.rows[i];\n            const row_container = this.cells[i];\n            this.cells[i] = row_container.slice(0, cidx[i] || cidx);\n            const idx = this.cells[i].filter((x) => x !== undefined).length;\n            while (tr.children[idx]) {\n                tr.removeChild(tr.children[idx]);\n            }\n        }\n    }\n\n    _clean_rows(ridx) {\n        while (this.table.children[ridx]) {\n            this.table.removeChild(this.table.children[ridx]);\n        }\n        this.rows = this.rows.slice(0, ridx);\n        this.cells = this.cells.slice(0, ridx);\n    }\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport { ViewModel } from \"./view_model\";\n\n/**\n * <thead> view model.  This model accumulates state in the form of\n * column_sizes, which leverages <tables> autosize behavior across\n * virtual pages.\n *\n * @class RegularHeaderViewModel\n */\nexport class RegularHeaderViewModel extends ViewModel {\n    constructor(...args) {\n        super(...args);\n        this._group_header_cache = [];\n        this._offset_cache = [];\n    }\n\n    _draw_group_th(offset_cache, d, column) {\n        const th = this._get_cell(\"TH\", d, offset_cache[d] || 0);\n        offset_cache[d] += 1;\n        th.removeAttribute(\"colspan\");\n        th.style.minWidth = \"0\";\n\n        th.textContent = \"\";\n        if (column instanceof HTMLElement) {\n            th.appendChild(column);\n        } else {\n            const span = this._span_factory.get(\"span\");\n            span.textContent = column;\n            th.appendChild(span);\n        }\n\n        const resizeSpan = this._span_factory.get(\"span\");\n        resizeSpan.className = \"rt-column-resize\";\n        th.appendChild(resizeSpan);\n\n        return th;\n    }\n\n    _draw_group(column, column_name, th) {\n        const metadata = this._get_or_create_metadata(th);\n        metadata.column_header = column;\n        metadata.value = column_name;\n        metadata.value = column_name;\n        return metadata;\n    }\n\n    _draw_th(column, column_name, th, cidx, size_key) {\n        const metadata = this._get_or_create_metadata(th);\n        metadata.column_header = column;\n        metadata.value = column_name;\n        metadata.size_key = size_key.length ? size_key[0] : size_key; // FIXME\n\n        if (!(size_key.length > 1)) {\n            const override_width =\n                this._column_sizes.override[metadata.size_key];\n            const auto_width = this._column_sizes.auto[metadata.size_key];\n            if (override_width) {\n                th.classList.toggle(\n                    \"rt-cell-clip\",\n                    auto_width > override_width,\n                );\n                th.style.minWidth = override_width + \"px\";\n                th.style.maxWidth = override_width + \"px\";\n            } else if (auto_width) {\n                th.classList.remove(\"rt-cell-clip\");\n                th.style.maxWidth = \"\";\n                th.style.minWidth = auto_width + \"px\";\n            } else {\n                th.style.maxWidth = \"\";\n                th.style.maxWidth = \"\";\n            }\n        }\n\n        return metadata;\n    }\n\n    get_column_header(cidx) {\n        return this._get_cell(\"TH\", this.num_rows() - 1, cidx);\n    }\n\n    draw(\n        alias,\n        parts,\n        colspan,\n        x,\n        size_key,\n        x0,\n        _virtual_x,\n        column_header_merge_depth,\n        merge_headers,\n    ) {\n        const header_levels = parts?.length; //config.column_pivots.length + 1;\n        if (header_levels === 0) return;\n        let th, metadata, column_name;\n        let output = undefined;\n        column_header_merge_depth =\n            typeof column_header_merge_depth === \"undefined\"\n                ? header_levels - 1\n                : column_header_merge_depth;\n        for (let d = 0; d < header_levels; d++) {\n            column_name = parts[d] ? parts[d] : \"\";\n            this._offset_cache[d] = this._offset_cache[d] || 0;\n\n            if (d < column_header_merge_depth) {\n                if (\n                    merge_headers &&\n                    this._group_header_cache?.[d]?.[0]?.value === column_name\n                ) {\n                    th = this._group_header_cache[d][1];\n                    this._group_header_cache[d][2] += 1;\n                    if (colspan === 1) {\n                        this._group_header_cache[d][0].row_header_x = size_key;\n                    }\n                    th.setAttribute(\"colspan\", this._group_header_cache[d][2]);\n                } else {\n                    th = this._draw_group_th(\n                        this._offset_cache,\n                        d,\n                        column_name,\n                    );\n                    metadata = this._draw_group(parts, column_name, th);\n                    this._group_header_cache[d] = [metadata, th, 1];\n                }\n            } else {\n                th = this._draw_group_th(this._offset_cache, d, column_name);\n\n                // Update the group header's metadata such that each group\n                // header has the same metadata coordinates of its rightmost\n                // column.\n                metadata = this._draw_th(\n                    alias || parts,\n                    column_name,\n                    th,\n                    x,\n                    size_key,\n                );\n                if (typeof output === \"undefined\") {\n                    output = { th, metadata };\n                }\n\n                for (const [group_meta] of this._group_header_cache) {\n                    group_meta.size_key = metadata.size_key;\n                }\n                th.removeAttribute(\"colspan\");\n            }\n\n            this._get_row(d).tr.classList.toggle(\n                \"rt-autosize\",\n                d === column_header_merge_depth,\n            );\n            th.classList.toggle(\"rt-group-corner\", x === undefined);\n            if (metadata) {\n                metadata.x = typeof x === \"undefined\" ? x : Math.floor(x);\n                metadata.column_header_y = d;\n                metadata.x0 = Math.floor(x0);\n                metadata._virtual_x = _virtual_x;\n                if (colspan === 1) {\n                    metadata.row_header_x = size_key;\n                }\n            }\n        }\n\n        this._clean_rows(this._offset_cache.length);\n        output = output || { th, metadata };\n        return output;\n    }\n\n    clean() {\n        this._clean_columns(this._offset_cache);\n    }\n\n    reset_header_cache() {\n        this._offset_cache = [];\n        this._group_header_cache = [];\n    }\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport { ViewModel } from \"./view_model\";\n\n/**\n * <tbody> view model.\n *\n * @class RegularBodyViewModel\n */\nexport class RegularBodyViewModel extends ViewModel {\n    _draw_td(\n        tagName,\n        ridx,\n        val,\n        cidx,\n        { column_name },\n        { ridx_offset },\n        size_key,\n    ) {\n        const td = this._get_cell(tagName, ridx, cidx);\n        const metadata = this._get_or_create_metadata(td);\n        metadata.y = ridx + Math.floor(ridx_offset);\n        metadata.size_key = size_key;\n        if (tagName === \"TD\") {\n            metadata.column_header = column_name;\n        }\n        const override_width = this._column_sizes.override[metadata.size_key];\n        if (override_width) {\n            const auto_width = this._column_sizes.auto[metadata.size_key];\n            td.classList.toggle(\"rt-cell-clip\", auto_width > override_width);\n            td.style.minWidth = override_width + \"px\";\n            td.style.maxWidth = override_width + \"px\";\n        } else {\n            td.classList.remove(\"rt-cell-clip\");\n            td.style.minWidth = \"\";\n            td.style.maxWidth = \"\";\n        }\n\n        if (metadata.value !== val) {\n            if (val instanceof HTMLElement) {\n                td.textContent = \"\";\n                td.appendChild(val);\n            } else {\n                td.textContent = val;\n            }\n        }\n\n        metadata.value = val;\n        return { td, metadata };\n    }\n\n    draw(\n        container_height,\n        column_state,\n        view_state,\n        th = false,\n        x,\n        x0,\n        size_key,\n        merge_headers,\n    ) {\n        const {\n            cidx,\n            column_data,\n            row_headers,\n            column_data_listener_metadata,\n        } = column_state;\n        let { row_height } = view_state;\n        let metadata;\n        const ridx_offset = [],\n            tds = [];\n        let ridx = 0;\n        const cidx_offset = [];\n        for (let i = 0; i < (th ? view_state.row_headers_length : 1); i++) {\n            ridx = 0;\n\n            for (const val of column_data) {\n                const id = row_headers?.[ridx];\n                let obj;\n                if (th) {\n                    const row_header = val[i];\n                    const prev_row = this._fetch_cell(\n                        ridx - (ridx_offset[i] || 1),\n                        cidx + i,\n                    );\n                    const prev_row_metadata =\n                        this._get_or_create_metadata(prev_row);\n\n                    const prev_col = this._fetch_cell(\n                        ridx,\n                        cidx + i - (cidx_offset[ridx] || 1),\n                    );\n                    const prev_col_metadata =\n                        this._get_or_create_metadata(prev_col);\n\n                    if (\n                        merge_headers &&\n                        prev_col &&\n                        (prev_col_metadata.value === row_header ||\n                            row_header === undefined) &&\n                        !prev_col.hasAttribute(\"rowspan\")\n                    ) {\n                        cidx_offset[ridx] = cidx_offset[ridx]\n                            ? cidx_offset[ridx] + 1\n                            : 2;\n                        prev_col.setAttribute(\"colspan\", cidx_offset[ridx]);\n                        this._replace_cell(ridx, cidx + i);\n                    } else if (\n                        merge_headers &&\n                        prev_row &&\n                        prev_row_metadata.value === row_header &&\n                        !prev_row.hasAttribute(\"colspan\")\n                    ) {\n                        ridx_offset[i] = ridx_offset[i]\n                            ? ridx_offset[i] + 1\n                            : 2;\n                        prev_row.setAttribute(\"rowspan\", ridx_offset[i]);\n                        this._replace_cell(ridx, cidx + i);\n                    } else {\n                        obj = this._draw_td(\n                            \"TH\",\n                            ridx,\n                            row_header,\n                            cidx + i,\n                            column_state,\n                            view_state,\n                            i,\n                        );\n                        obj.td.style.display = \"\";\n                        obj.td.removeAttribute(\"rowspan\");\n                        obj.td.removeAttribute(\"colspan\");\n                        obj.metadata.row_header = val;\n                        obj.metadata.row_header_x = i;\n                        obj.metadata.y0 = Math.floor(view_state.ridx_offset);\n                        obj.metadata.y1 = Math.ceil(view_state.y1);\n                        obj.metadata._virtual_x = i;\n                        if (typeof x0 !== \"undefined\") {\n                            obj.metadata.x0 = Math.floor(x0);\n                        }\n                        ridx_offset[i] = 1;\n                        cidx_offset[ridx] = 1;\n                        tds[i] = obj;\n                    }\n                } else {\n                    obj = this._draw_td(\n                        \"TD\",\n                        ridx,\n                        val,\n                        cidx,\n                        column_state,\n                        view_state,\n                        size_key,\n                    );\n                    if (column_data_listener_metadata) {\n                        obj.metadata.user = column_data_listener_metadata[ridx];\n                    }\n\n                    obj.metadata.x =\n                        typeof x === \"undefined\" ? x : Math.floor(x);\n                    obj.metadata.x1 = Math.ceil(view_state.x1);\n                    obj.metadata.row_header = id || [];\n                    obj.metadata.y0 = Math.floor(view_state.ridx_offset);\n                    obj.metadata.y1 = Math.ceil(view_state.y1);\n                    obj.metadata.dx = Math.floor(x - x0);\n                    obj.metadata.dy =\n                        obj.metadata.y - Math.floor(obj.metadata.y0);\n                    obj.metadata._virtual_x = cidx;\n                    if (typeof x0 !== \"undefined\") {\n                        obj.metadata.x0 = Math.floor(x0);\n                    }\n\n                    tds[0] = obj;\n                }\n\n                ridx++;\n                metadata = obj ? obj.metadata : metadata;\n                row_height = row_height || obj?.td.offsetHeight;\n                if (ridx * row_height > container_height) {\n                    break;\n                }\n            }\n        }\n        this._clean_rows(ridx);\n        return { tds, ridx, metadata, row_height };\n    }\n\n    clean({ ridx, cidx }) {\n        this._clean_rows(ridx);\n        this._clean_columns(cidx);\n    }\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport { RegularHeaderViewModel } from \"./thead\";\nimport { RegularBodyViewModel } from \"./tbody\";\nimport { html } from \"./utils\";\n\n/**\n * <table> view model.  In order to handle unknown column width when `draw()`\n * is called, this model will iteratively fetch more data to fill in columns\n * until the page is complete, and makes some column viewport estimations\n * when this information is not availble.\n *\n * @class RegularTableViewModel\n */\nexport class RegularTableViewModel {\n    constructor(table_clip, column_sizes, element) {\n        this.clear(element);\n        const [table] = element.children;\n        const [thead, tbody] = table.children;\n        this.table = table;\n        this._column_sizes = column_sizes;\n        this.header = new RegularHeaderViewModel(\n            column_sizes,\n            table_clip,\n            thead,\n        );\n        this.body = new RegularBodyViewModel(column_sizes, table_clip, tbody);\n        this.fragment = document.createDocumentFragment();\n    }\n\n    num_columns() {\n        return this.header.num_columns();\n    }\n\n    clear(element) {\n        element.innerHTML = html`\n            <table cellspacing=\"0\">\n                <thead></thead>\n                <tbody></tbody>\n            </table>\n        `;\n    }\n\n    /**\n     * Calculate amendments to auto size from this render pass.\n     *\n     * @param {*} last_cells\n     * @param {*} {columns, column_pivots}\n     * @memberof RegularTableViewModel\n     */\n    autosize_cells(last_cells, override_row_height) {\n        while (last_cells.length > 0) {\n            const [cell, metadata] = last_cells.pop();\n            const box = cell.getBoundingClientRect();\n            if (!box) {\n                continue;\n            }\n            this._column_sizes.row_height =\n                override_row_height ||\n                Math.max(\n                    10,\n                    Math.min(\n                        this._column_sizes.row_height || box.height,\n                        box.height,\n                    ),\n                );\n            if (!metadata) {\n                continue;\n            }\n            this._column_sizes.indices[metadata.size_key] = box.width;\n            const is_override =\n                this._column_sizes.override[metadata.size_key] !== undefined;\n            if (box.width && !is_override) {\n                this._column_sizes.auto[metadata.size_key] = box.width;\n            }\n\n            if (cell.style.minWidth === \"0px\") {\n                cell.style.minWidth = `${box.width}px`;\n            }\n        }\n    }\n\n    async *draw(\n        container_size,\n        view_cache,\n        selected_id,\n        preserve_width,\n        viewport,\n        num_columns,\n    ) {\n        const { width: container_width, height: container_height } =\n            container_size;\n        const { view, config } = view_cache;\n        let {\n            data,\n            row_headers,\n            column_headers,\n            metadata: data_listener_metadata,\n            num_row_headers,\n            num_column_headers,\n            column_header_merge_depth,\n            merge_headers = \"both\",\n        } = await view(\n            Math.floor(viewport.start_col),\n            Math.floor(viewport.start_row),\n            Math.ceil(viewport.end_col),\n            Math.ceil(viewport.end_row),\n        );\n\n        const merge_row_headers =\n            merge_headers === \"both\" || merge_headers === \"row\";\n        const merge_column_headers =\n            merge_headers === \"both\" || merge_headers === \"column\";\n        const {\n            start_row: ridx_offset = 0,\n            start_col: x0 = 0,\n            end_col: x1 = 0,\n            end_row: y1 = 0,\n        } = viewport;\n\n        // pad row_headers for embedded renderer\n        // TODO maybe dont need this - perspective compat\n        if (row_headers) {\n            this._row_headers_length = row_headers.reduce(\n                (max, x) => Math.max(max, x.length),\n                0,\n            );\n            row_headers = row_headers.map((x) => {\n                x.length = this._row_headers_length;\n                return x;\n            });\n        }\n\n        if (num_row_headers !== undefined) {\n            view_cache.config.row_pivots = Array(num_row_headers).fill(0);\n        } else {\n            view_cache.config.row_pivots = Array(\n                row_headers?.[0]?.length || 0,\n            ).fill(0);\n        }\n\n        if (num_column_headers !== undefined) {\n            view_cache.config.column_pivots = Array(num_column_headers).fill(0);\n        } else {\n            view_cache.config.column_pivots = Array(\n                column_headers?.[0]?.length || 0,\n            ).fill(0);\n        }\n\n        const sub_cell_offset =\n            this._column_sizes.indices[\n                (this._row_headers_length || 0) + Math.floor(viewport.start_col)\n            ] || 0;\n\n        const view_state = {\n            viewport_width: 0,\n            selected_id,\n            ridx_offset,\n            sub_cell_offset,\n            x0: x0,\n            x1: x1,\n            y1: y1,\n            row_height: this._column_sizes.row_height,\n            row_headers_length: this._row_headers_length,\n        };\n\n        let cont_body,\n            _virtual_x = 0,\n            last_cells = [],\n            first_col = true;\n        if (row_headers?.length > 0) {\n            const column_name = config.row_pivots.join(\",\");\n\n            const column_state = {\n                column_name,\n                cidx: 0,\n                column_data: row_headers,\n                row_headers,\n                first_col,\n            };\n            const size_key = _virtual_x + Math.floor(x0);\n            cont_body = this.body.draw(\n                container_height,\n                column_state,\n                { ...view_state, x0: 0 },\n                true,\n                undefined,\n                undefined,\n                size_key,\n                merge_row_headers,\n            );\n            const cont_heads = [];\n            for (let i = 0; i < view_cache.config.row_pivots.length; i++) {\n                const header = this.header.draw(\n                    column_name,\n                    Array(view_cache.config.column_pivots.length).fill(\"\"),\n                    1,\n                    undefined,\n                    i,\n                    x0,\n                    i,\n                    column_header_merge_depth,\n                    merge_column_headers,\n                );\n                if (!!header) {\n                    cont_heads.push(header);\n                }\n            }\n            first_col = false;\n            view_state.viewport_width += cont_heads.reduce(\n                (total, { th }, i) =>\n                    total + (this._column_sizes.indices[i] || th.offsetWidth),\n                0,\n            );\n            view_state.row_height =\n                view_state.row_height || cont_body.row_height;\n            _virtual_x = row_headers[0].length;\n            if (!preserve_width) {\n                for (let i = 0; i < view_cache.config.row_pivots.length; i++) {\n                    const { td, metadata } = cont_body.tds[i] || {};\n                    const { th, metadata: hmetadata } = cont_heads[i] || {};\n                    if (!!td || !!th) {\n                        last_cells.push([th || td, hmetadata || metadata]);\n                    }\n                }\n            }\n        }\n\n        try {\n            let dcidx = 0;\n            const num_visible_columns = num_columns - viewport.start_col;\n            while (dcidx < num_visible_columns) {\n                // If there is no column for this data, our pre-fetch viewport\n                // estimate was wrong and we'll need to do a mid-render fetch\n                // to get more data.\n                if (!data[dcidx]) {\n                    let missing_cidx = Math.max(viewport.end_col, 0);\n                    viewport.start_col = missing_cidx;\n\n                    // Calculate a new data window width based on how large the\n                    // columns drawn so far take up.  This can either be\n                    // summed if we've drawn/measured these columns before,\n                    // or estimated by avg if the missing columns have never\n                    // been seen by the renderer.\n                    let end_col_offset = 0,\n                        size_extension = 0;\n                    while (\n                        this._column_sizes.indices.length >\n                            _virtual_x + x0 + end_col_offset + 1 &&\n                        size_extension + view_state.viewport_width <\n                            container_width\n                    ) {\n                        end_col_offset++;\n                        size_extension +=\n                            this._column_sizes.indices[\n                                _virtual_x + x0 + end_col_offset\n                            ];\n                    }\n\n                    if (\n                        size_extension + view_state.viewport_width <\n                        container_width\n                    ) {\n                        const estimate = Math.min(\n                            num_columns,\n                            missing_cidx + 5,\n                        ); //Math.ceil(((dcidx + end_col_offset) * container_width) / (view_state.viewport_width + size_extension) + 1);\n                        viewport.end_col = Math.max(\n                            1,\n                            Math.min(num_columns, estimate),\n                        );\n                    } else {\n                        viewport.end_col = Math.max(\n                            1,\n                            Math.min(\n                                num_columns,\n                                missing_cidx + end_col_offset,\n                            ),\n                        );\n                    }\n\n                    // Fetch the new data window extension and append it to the\n                    // cached data page and continue.\n                    const new_col_req = view(\n                        Math.floor(viewport.start_col),\n                        Math.floor(viewport.start_row),\n                        Math.ceil(viewport.end_col),\n                        Math.ceil(viewport.end_row),\n                    );\n                    yield undefined;\n                    const new_col = await new_col_req;\n\n                    if (\n                        typeof new_col.column_header_merge_depth !== \"undefined\"\n                    ) {\n                        column_header_merge_depth =\n                            new_col.column_header_merge_depth;\n                    }\n\n                    if (typeof new_col.merge_headers !== \"undefined\") {\n                        merge_headers = new_col.merge_headers;\n                    }\n\n                    if (new_col.data.length === 0) {\n                        // The viewport is size 0, first the estimate, then the\n                        // first-pass render, so really actually abort now.\n                        yield last_cells;\n                        return;\n                    }\n\n                    viewport.end_col = viewport.start_col + new_col.data.length;\n                    for (let i = 0; i < new_col.data.length; i++) {\n                        data[dcidx + i] = new_col.data[i];\n                        if (new_col.metadata) {\n                            data_listener_metadata[dcidx + i] =\n                                new_col.metadata[i];\n                        }\n\n                        if (column_headers) {\n                            column_headers[dcidx + i] =\n                                new_col.column_headers?.[i];\n                        }\n                    }\n                }\n\n                const column_name = column_headers?.[dcidx] || \"\";\n                const column_data = data[dcidx];\n                const column_data_listener_metadata =\n                    data_listener_metadata?.[dcidx];\n                const column_state = {\n                    column_name,\n                    cidx: _virtual_x,\n                    column_data,\n                    column_data_listener_metadata,\n                    row_headers,\n                    first_col,\n                };\n\n                const x = dcidx + x0;\n                const size_key = _virtual_x + Math.floor(x0);\n                const cont_head = this.header.draw(\n                    undefined,\n                    column_name,\n                    undefined,\n                    x,\n                    size_key,\n                    x0,\n                    _virtual_x,\n                    column_header_merge_depth,\n                    merge_column_headers,\n                );\n                cont_body = this.body.draw(\n                    container_height,\n                    column_state,\n                    view_state,\n                    false,\n                    x,\n                    x0,\n                    size_key,\n                    merge_row_headers,\n                );\n                first_col = false;\n                if (!preserve_width) {\n                    for (const { td, metadata } of cont_body.tds) {\n                        last_cells.push([\n                            cont_head?.th || td,\n                            cont_head?.metadata || metadata,\n                        ]);\n                    }\n                }\n\n                const last_measured_col_width =\n                    this._column_sizes.indices[_virtual_x + Math.floor(x0)];\n                if (last_measured_col_width) {\n                    view_state.viewport_width += last_measured_col_width;\n                } else {\n                    // This is probably wrong since the column has yet to be\n                    // styled, but we'll use it as an estimate and recalc after.\n                    view_state.viewport_width +=\n                        cont_head?.th?.offsetWidth ||\n                        cont_body.tds.reduce(\n                            (x, y) => x + y.td?.offsetWidth,\n                            0,\n                        );\n                }\n\n                view_state.row_height =\n                    view_state.row_height || cont_body.row_height;\n                _virtual_x++;\n                dcidx++;\n\n                if (\n                    view_state.viewport_width - view_state.sub_cell_offset >\n                    container_width\n                ) {\n                    this.body.clean({\n                        ridx: cont_body?.ridx || 0,\n                        cidx: _virtual_x,\n                    });\n                    this.header.clean();\n                    yield last_cells;\n\n                    // If we make it here, this draw() call was invalidated by\n                    // a call to `invalidate()` within a `StyleListener`, so\n                    // recalculate the cumulative width and keep drawing if\n                    // necessary.  Note `last_cells` is a list of 2-tuples but\n                    // we only bind the first var because _eslint_.\n                    view_state.viewport_width = 0;\n                    for (let [td] of last_cells) {\n                        view_state.viewport_width += td.offsetWidth;\n                    }\n\n                    // If there are still enough columns to fill the screen,\n                    // completely end the iteration here, otherwise\n                    // continue iterating to draw another column.\n                    if (\n                        view_state.viewport_width - view_state.sub_cell_offset >\n                        container_width\n                    ) {\n                        return;\n                    }\n                }\n            }\n            this.body.clean({ ridx: cont_body?.ridx || 0, cidx: _virtual_x });\n            this.header.clean();\n            yield last_cells;\n        } finally {\n            this.body.clean({ ridx: cont_body?.ridx || 0, cidx: _virtual_x });\n            this.header.clean();\n            this.body._span_factory.reset();\n            this.header._span_factory.reset();\n        }\n    }\n}\n", "/******************************************************************************\n *\n * Copyright (c) 2020, the Regular Table Authors.\n *\n * This file is part of the Regular Table library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport { METADATA_MAP } from \"./constants\";\nimport { RegularViewEventModel } from \"./events\";\nimport { RegularTableViewModel } from \"./table\";\nimport { get_draw_fps } from \"./utils\";\n\nconst VIRTUAL_MODES = [\"both\", \"horizontal\", \"vertical\", \"none\"];\n\n/**\n * The `<regular-table>` custom element.\n *\n * This module has no exports, but importing it has a side effect: the\n * `RegularTableElement` class is registered as a custom element, after which\n * it can be used as a standard DOM element.\n *\n * The documentation in this module defines the instance structure of a\n * `<regular-table>` DOM object instantiated typically, through HTML or any\n * relevent DOM method e.g. `document.createElement(\"perspective-viewer\")` or\n * `document.getElementsByTagName(\"perspective-viewer\")`.\n *\n * @public\n * @extends HTMLElement\n */\nclass RegularTableElement extends RegularViewEventModel {\n    constructor() {\n        super();\n        /** @private */\n        this._column_sizes = { auto: [], override: [], indices: [] };\n        /** @private */\n        this._style_callbacks = [];\n        /** @private */\n        this._initialized = false;\n    }\n\n    /* eslint-disable */\n    /**\n     * For internal use by the Custom Elements API: \"Invoked each time the\n     * custom element is appended into a document-connected element\".\n     * Ref: https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements#Using_the_lifecycle_callbacks\n     *\n     * @internal\n     * @private\n     * @memberof RegularTableElement\n     */\n    /* eslint-enable */\n    connectedCallback() {\n        if (!this._initialized) {\n            this.create_shadow_dom();\n            this.register_listeners();\n            this.setAttribute(\"tabindex\", \"0\");\n\n            this._initialized = true;\n            this.table_model = new RegularTableViewModel(\n                this._table_clip,\n                this._column_sizes,\n                this,\n            );\n        }\n    }\n\n    /**\n     * Reset the viewport of this regular table.\n     *\n     * @internal\n     * @private\n     * @memberof RegularTableElement\n     */\n    _reset_viewport() {\n        /** @private @type {number} */\n        this._start_row = undefined;\n        /** @private @type {number} */\n        this._end_row = undefined;\n        /** @private @type {number} */\n        this._start_col = undefined;\n        /** @private @type {number} */\n        this._end_col = undefined;\n    }\n\n    /**\n     * Reset the scroll position of this regular table back to the origin.\n     *\n     * @internal\n     * @private\n     * @memberof RegularTableElement\n     */\n    _reset_scroll() {\n        this._column_sizes.indices = [];\n        this.scrollTop = 0;\n        this.scrollLeft = 0;\n        this._reset_viewport();\n    }\n\n    /**\n     * Reset column autosizing, such that column sizes will be recalculated\n     * on the next draw() call.\n     *\n     * @internal\n     * @protected\n     * @memberof RegularTableElement\n     */\n    _resetAutoSize() {\n        this._column_sizes.auto = [];\n        this._column_sizes.override = [];\n        this._column_sizes.indices = [];\n\n        for (let i = 0; i < this.table_model.header.num_columns(); i++) {\n            const th = this.table_model.header.get_column_header(i);\n            th.style.minWidth = \"\";\n            th.style.maxWidth = \"\";\n        }\n    }\n\n    /**\n     * Clears the current renderer `<table>`.\n     *\n     * @public\n     * @memberof RegularTableElement\n     */\n    clear() {\n        this.table_model = new RegularTableViewModel(\n            this._table_clip,\n            this._column_sizes,\n            this,\n        );\n    }\n\n    /**\n     * Adds a style listener callback. The style listeners are called\n     * whenever the <table> is re-rendered, such as through API invocations\n     * of draw() and user-initiated events such as scrolling. Within this\n     * optionally async callback, you can select <td>, <th>, etc. elements\n     * via regular DOM API methods like querySelectorAll().\n     *\n     * Example:\n     * const unsubscribe = table.addStyleListener(() => {\n     *     for (const td of table.querySelectorAll(\"td\")) {\n     *         td.setAttribute(\"contenteditable\", true);\n     *     }\n     * });\n     *\n     * setTimeout(() => {\n     *     unsubscribe();\n     * }, 1000);\n     * @public\n     * @memberof RegularTableElement\n     * @param {function({detail: RegularTableElement}): void} styleListener - A\n     * (possibly async) function that styles the inner <table>.\n     * @returns {function(): void} A function to remove this style listener.\n     */\n    addStyleListener(styleListener) {\n        this._style_callbacks = this._style_callbacks.concat(styleListener);\n\n        let isSubscribed = true;\n\n        const unsubscribe = () => {\n            if (!isSubscribed) {\n                return;\n            }\n            isSubscribed = false;\n\n            const callbacks = (this._style_callbacks =\n                this._style_callbacks.slice());\n            const index = callbacks.indexOf(styleListener);\n            callbacks.splice(index, 1);\n        };\n        return unsubscribe;\n    }\n\n    /**\n     * Removes a style listener added by `addStyleListener`.\n     * `removeStyleListener` throws an error if the provided listener is not\n     * registered.\n     * @param {*} styleListener A listener previously added with\n     * `addStyleListener`\n     */\n    removeStyleListener(styleListener) {\n        const start_len = this._style_callbacks.length;\n        this._style_callbacks = this._style_callbacks.filter(\n            (x) => x !== styleListener,\n        );\n        console.assert(\n            this._style_callbacks.length === start_len - 1,\n            \"No listener found\",\n        );\n    }\n\n    /**\n     * When called within the execution scope of a function registered to this\n     * `<regular-table>` as a `StyleListener`, invalidate this draw's\n     * dimensions and attempt to draw more columns.  Useful if your\n     * `StyleListener` changes a cells dimensions, otherwise `<regular-table>`\n     * may not draw enough columns to fill the screen.\n     *\n     * @public\n     * @memberof RegularTableElement\n     */\n    invalidate() {\n        if (!this._is_styling) {\n            throw new Error(\n                \"Cannot call `invalidate()` outside of a `StyleListener`\",\n            );\n        }\n        /** @private */\n        this._invalidated = true;\n    }\n\n    /**\n     * Returns the `MetaData` object associated with a `<td>` or `<th>`.  When\n     * your `StyleListener` is invoked, use this method to look up additional\n     * `MetaData` about any `HTMLTableCellElement` in the rendered `<table>`.\n     *\n     * Example:\n     * const elems = document.querySelector(\"td:last-child td:last_child\");\n     * const metadata = table.getMeta(elems);\n     * console.log(`Viewport corner is ${metadata.x}, ${metadata.y}`);\n     *\n     * const header = table.getMeta({row_header_x: 1, y: 3}).row_header;\n     * @public\n     * @memberof RegularTableElement\n     * @param {HTMLTableCellElement|Partial<MetaData>} element - The child\n     * element of this `<regular-table>` for which to look up metadata, or a\n     * coordinates-like object to refer to metadata by logical position.\n     * @returns {MetaData} The metadata associated with the element.\n     */\n    getMeta(element) {\n        if (typeof element === \"undefined\") {\n            return;\n        } else if (element instanceof HTMLElement) {\n            return METADATA_MAP.get(element);\n        } else if (element.row_header_x >= 0) {\n            if (\n                element.row_header_x < this._view_cache.config.row_pivots.length\n            ) {\n                const td = this.table_model.body._fetch_cell(\n                    element.y,\n                    element.row_header_x,\n                );\n                return this.getMeta(td);\n            }\n        } else if (element.column_header_y >= 0) {\n            if (\n                element.column_header_y <\n                this._view_cache.config.column_pivots.length\n            ) {\n                const td = this.table_model.body._fetch_cell(\n                    element.column_header_y,\n                    element.y,\n                );\n                return this.getMeta(td);\n            }\n        } else {\n            return this.getMeta(\n                this.table_model.body._fetch_cell(\n                    element.dy,\n                    element.dx + this.table_model._row_headers_length,\n                ),\n            );\n        }\n    }\n\n    /**\n     * Get performance statistics about this `<regular-table>`.  Calling this\n     * method resets the internal state, which makes it convenient to measure\n     * performance at regular intervals (see example).\n     *\n     * Example:\n     * const table = document.getElementById(\"my_regular_table\");\n     * setInterval(() => {\n     *     const {real_fps} = table.getDrawFPS();\n     *     console.log(`Measured ${fps} fps`)\n     * });\n     * @public\n     * @memberof RegularTableElement\n     * @returns {Performance} Performance data aggregated since the last\n     * call to `getDrawFPS()`.\n     */\n    getDrawFPS() {\n        return get_draw_fps();\n    }\n\n    /**\n     * Call this method to set the `scrollLeft` and `scrollTop` for this\n     * `<regular-table>` by calculating the position of this `scrollLeft`\n     * and `scrollTop` relative to the underlying widths of its columns\n     * and heights of its rows.\n     *\n     * Example:\n     * table.scrollToCell(1, 3, 10, 30);\n     * @public\n     * @memberof RegularTableElement\n     * @param {number} x - The left most `x` index column to scroll into view.\n     * @param {number} y - The top most `y` index row to scroll into view.\n     */\n    async scrollToCell(x, y) {\n        if (!this._view_cache) {\n            console.warn(\"data listener not configured\");\n            return;\n        }\n\n        const viewport_row_height = this._column_sizes.row_height || 19;\n        const header_height =\n            this._view_cache.config.column_pivots.length * viewport_row_height;\n        const body_height = this._table_clip.offsetHeight - header_height;\n        const row_height_offset = body_height % viewport_row_height;\n        let real_row_height =\n            (this._virtual_panel.offsetHeight - row_height_offset) /\n            this._nrows;\n        this.scrollTop = Math.ceil(real_row_height * y);\n\n        let scroll_left = 0;\n        while (x > 0) {\n            x--;\n            scroll_left +=\n                this._column_sizes.indices[\n                    x + this._view_cache.config.row_pivots.length\n                ] || 60;\n        }\n\n        this.scrollLeft = Math.ceil(scroll_left);\n        await new Promise(requestAnimationFrame);\n        await this._draw_flush();\n    }\n\n    /**\n     * Call this method to set `DataListener` for this `<regular-table>`,\n     * which will be called whenever a new data slice is needed to render.\n     * Calls to `draw()` will fail if no `DataListener` has been set\n     *\n     * Example:\n     * table.setDataListener((x0, y0, x1, y1) => {\n     *     return {\n     *         num_rows: num_rows = DATA[0].length,\n     *         num_columns: DATA.length,\n     *         data: DATA.slice(x0, x1).map(col => col.slice(y0, y1))\n     *     };\n     * })\n     * @public\n     * @memberof RegularTableElement\n     * @param {DataListener} dataListener\n     * `dataListener` is called by to request a rectangular section of data\n     * for a virtual viewport, (x0, y0, x1, y1), and returns a `DataReponse`\n     * object.\n     * @param {Object} options\n     * @param {boolean} preserve_state If `setDataListener` has already been\n     * called, setting this flag will prevent the internal state from being\n     * reset (other than the callback itself).\n     * @param {(\"both\"|\"horizontal\"|\"vertical\"|\"none\")} options.virtual_mode\n     * The `virtual_mode` options flag may be one of \"both\", \"horizontal\",\n     * \"vertical\", or \"none\" indicating which dimensions of the table should be\n     * virtualized (vs. rendering completely).\n     */\n    setDataListener(\n        dataListener,\n        { virtual_mode = \"both\", preserve_state = false } = {},\n    ) {\n        console.assert(\n            VIRTUAL_MODES.indexOf(virtual_mode) > -1,\n            `Unknown virtual_mode ${virtual_mode};  valid options are \"both\" (default), \"horizontal\", \"vertical\" or \"none\"`,\n        );\n\n        const virtual_mode_changed = this._virtual_mode !== virtual_mode;\n        if (preserve_state) {\n            console.assert(\n                !virtual_mode_changed,\n                \"preserve_state called with modified virtual_mode\",\n            );\n            this._view_cache.view = dataListener;\n        } else {\n            const config = {\n                row_pivots: [],\n                column_pivots: [],\n            };\n\n            /** @private */\n            this._virtual_mode = virtual_mode;\n\n            /** @private */\n            this._invalid_schema = true;\n\n            /** @private */\n            this._view_cache = { view: dataListener, config };\n            if (virtual_mode_changed) {\n                this._setup_virtual_scroll();\n            }\n        }\n    }\n\n    /**\n     * This func only exists to provide hints to doc compulation tools.\n     * Should never be run, and even if it is the body of the func will\n     * never execute.\n     *\n     * @internal\n     * @private\n     * @memberof RegularTableElement\n     */\n    __noop_jsdoc_hints() {\n        if (false) {\n            /**\n             * Draws this virtual panel, given an object of render options that\n             * allow the implementor to fine tune the individual render frames\n             * based on the interaction and previous render state.\n             *\n             * @public\n             * @type {(opt?: DrawOptions) => void}\n             * @memberof RegularTableElement\n             * */\n            this.draw = null;\n        }\n    }\n}\n\nif (document.createElement(\"regular-table\").constructor === HTMLElement) {\n    window.customElements.define(\"regular-table\", RegularTableElement);\n}\n\n/**\n * An object with performance statistics about calls to\n * `draw()` from some time interval (captured in milliseconds by the\n * `elapsed` proprty).\n *\n * @public\n * @typedef Performance\n * @type {object}\n * @property {number} avg - Avergage milliseconds per call.\n * @property {number} real_fps - `num_frames` / `elapsed`\n * @property {number} virtual_fps - `elapsed` / `avg`\n * @property {number} num_frames - Number of frames rendered.\n * @property {number} elapsed - Number of milliseconds since last call\n * to `getDrawFPS()`.\n */\n\n/**\n * An object describing virtual rendering metadata about an\n * `HTMLTableCellElement`, use this object to map rendered `<th>` or `<td>`\n * elements back to your `data`, `row_headers` or `column_headers` within\n * listener functions for `addStyleListener()` and `addEventListener()`.\n *\n * Example:\n *\n * MetaData                     (x = 0, column_header_y = 0)\n *                              *-------------------------------------+\n *                              |                                     |\n *                              |                                     |\n *                              +-------------------------------------+\n * (row_header_x = 0, y = 0)    (x = 0, y = 0)\n * *------------------------+   *-------------------------------------+\n * |                        |   |                                     |\n * |                        |   |      (x0, y0)                       |\n * |                        |   |      *---------------*              |\n * |                        |   |      |               |              |\n * |                        |   |      |     * (x, y)  |              |\n * |                        |   |      |               |              |\n * |                        |   |      *---------------* (x1, y1)     |\n * |                        |   |                                     |\n * +------------------------+   +-------------------------------------+\n *\n * @public\n * @typedef MetaData\n * @type {object}\n * @property {number} [x] - The `x` index in your virtual data model.\n * property is only generated for `<td>`, `<th>` from `row_headers`.\n * @property {number} [y] - The `y` index in your virtual data model.\n * property is only generated for `<td>`, `<th>` from `row_headers`.\n * @property {number} [x0] - The `x` index of the viewport origin in\n * your data model, e.g. what was passed to `x0` when your\n * `dataListener` was invoked.\n * @property {number} [y0] - The `y` index of the viewport origin in\n * your data model, e.g. what was passed to `y0` when your\n * `dataListener` was invoked.\n * @property {number} [x1] - The `x` index of the viewport corner in\n * your data model, e.g. what was passed to `x1` when your\n * `dataListener` was invoked.\n * @property {number} [y1] - The `y` index of the viewport corner in\n * your data model, e.g. what was passed to `y1` when your\n * `dataListener` was invoked.\n * @property {number} [dx] - The `x` index in `DataResponse.data`, this\n * property is only generated for `<td>`, and `<th>` from `column_headers`.\n * @property {number} [dy] - The `y` index in `DataResponse.data`, this\n * property is only generated for `<td>`, `<th>` from `row_headers`.\n * @property {number} [column_header_y] - The `y` index in\n * `DataResponse.column_headers[x]`, this property is only generated for `<th>`\n * from `column_headers`.\n * @property {number} [row_header_x] - The `x` index in\n * `DataResponse.row_headers[y]`, this property is only generated for `<th>`\n * from `row_headers`.\n * @property {number} size_key - The unique index of this column in a full\n * `<table>`, which is `x` + (Total Row Header Columns).\n * @property {(string|HTMLElement)[]} [row_header] - The `Array` for this `y` in\n * `DataResponse.row_headers`, if it was provided.\n * @property {(string|HTMLElement)[]} [column_header] - The `Array` for this `x`\n * in `DataResponse.column_headers`, if it was provided.\n * @property {(string|HTMLElement)} [value] - The value dispalyed in the cell or\n * header.\n */\n\n/**\n * The `DataResponse` object describes a rectangular region of a virtual\n * data set, and some associated metadata.  `<regular-table>` will use this\n * object to render the `<table>`, though it may make multiple requests for\n * different regions to achieve a compelte render as it must estimate\n * certain dimensions.  You must construct a `DataResponse` object to\n * implement a `DataListener`.\n *\n * Example:\n * {\n *     \"num_rows\": 26,\n *     \"num_columns\": 3,\n *     \"data\": [\n *         [0, 1],\n *         [\"A\", \"B\"]\n *     ],\n *     \"row_headers\": [\n *         [\"Rowgroup 1\", \"Row 1\"],\n *         [\"Rowgroup 1\", \"Row 2\"]\n *     ],\n *     \"column_headers\": [\n *         [\"Colgroup 1\", \"Column 1\"],\n *         [\"Colgroup 1\", \"Column 2\"]\n *     ]\n * }\n * @public\n * @typedef DataResponse\n * @type {object}\n * @property {(string|HTMLElement)[][]} [column_headers] - A two dimensional\n * `Array` of column group headers, in specificity order.  No `<thead>`\n * will be generated if this property is not provided.\n * @property {(string|HTMLElement)[][]} [row_headers] - A two dimensional\n * `Array` of row group headers, in specificity order.  No `<th>`\n * elements within `<tbody>` will be generated if this property is not\n * provided.\n * @property {number?} num_row_headers - Optional number of row headers.\n * * @property {number?} num_row_headers - Optional number of column headers.\n * @property {(string|HTMLElement)[][]} data - A two dimensional `Array`\n * representing a rectangular section of the underlying data set from\n * (x0, y0) to (x1, y1), arranged in columnar fashion such that\n * `data[x][y]` returns the `y`th row of the `x`th column of the slice.\n * @property {number} num_rows - Total number of rows in the underlying\n * data set.\n * @property {number} num_columns - Total number of columns in the\n * underlying data set.\n */\n\n/**\n * The `DataListener` is similar to a normal event listener function.\n * Unlike a normal event listener, it takes regular arguments (not an\n * `Event`); and returns a `Promise` for a `DataResponse` object for this\n * region (as opposed to returning `void` as a standard event listener).\n *\n * @public\n * @callback DataListener\n * @param {number} x0 - The origin `x` index (column).\n * @param {number} y0 - The origin `y` index (row).\n * @param {number} x1 - The corner `x` index (column).\n * @param {number} y1 - The corner `y` index (row).\n * @returns {Promise<DataResponse>} The resulting `DataResponse`.  Make sure\n * to `resolve` or `reject` the `Promise`, or your `<regular-table>` will\n * never render!\n */\n\n/**\n * Options for the draw method.\n *\n * @public\n * @typedef DrawOptions\n * @type {object}\n * @property {boolean} [invalid_viewport]\n * @property {boolean} [preserve_width]\n */\n\n/**\n * Public summary of table_model type.\n *\n * @public\n * @typedef TableModel\n * @type {object}\n * @property {ViewModel} header\n * @property {ViewModel} body\n * @property {() => number} num_columns\n */\n\n/**\n * Public summary of table_model.header and table_model.body base type.\n *\n * @public\n * @typedef ViewModel\n * @type {object}\n * @property {any} table\n * @property {any[]} cells\n * @property {any[]} rows\n * @property {() => number} num_columns\n * @property {() => number} num_rows\n */\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport const PRIVATE_PLUGIN_SYMBOL = Symbol(\"Plugin Symbol\");\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nfunction get_psp_type(metadata) {\n    if (metadata.x >= 0) {\n        return this._column_types[metadata.x];\n    } else {\n        return this._row_header_types[metadata.row_header_x - 1];\n    }\n}\n\nexport function style_selected_column(regularTable, viewer, selectedColumn) {\n    const group_header_trs = Array.from(\n        regularTable.children[0].children[0].children\n    );\n\n    const len = group_header_trs.length;\n    const settings_open = viewer.hasAttribute(\"settings\");\n    if (len <= 1) {\n        group_header_trs[0]?.removeAttribute(\"id\");\n    } else {\n        group_header_trs.forEach((tr, i) => {\n            const offset = settings_open ? 1 : 0;\n            let id =\n                i === len - (offset + 1)\n                    ? \"psp-column-titles\"\n                    : i === len - offset\n                    ? \"psp-column-edit-buttons\"\n                    : null;\n            id ? tr.setAttribute(\"id\", id) : tr.removeAttribute(\"id\");\n        });\n    }\n\n    viewer.classList.toggle(\"psp-menu-open\", !!selectedColumn);\n    if (settings_open && len >= 2) {\n        // if settings_open, you will never have less than 2 trs unless the\n        // table is empty, but possibly more e.g. with group-by.\n        // edit and title are guaranteed to be the last two rows\n        let titles = Array.from(group_header_trs[len - 2].children);\n        let editBtns = Array.from(group_header_trs[len - 1].children);\n        if (titles && editBtns) {\n            // clear any sticky styles from tr changes\n            group_header_trs.slice(0, len - 2).forEach((tr) => {\n                Array.from(tr.children).forEach((th) => {\n                    th.classList.toggle(\"psp-menu-open\", false);\n                });\n            });\n\n            for (let i = 0; i < titles.length; i++) {\n                const title = titles[i];\n                const editBtn = editBtns[i];\n\n                let open = title.textContent === selectedColumn;\n                title.classList.toggle(\"psp-menu-open\", open);\n                editBtn.classList.toggle(\"psp-menu-open\", open);\n                if (this._config.columns.length > 1) {\n                    for (const r of regularTable.querySelectorAll(\"td\")) {\n                        const meta = regularTable.getMeta(r);\n                        const open =\n                            meta.column_header[\n                                meta.column_header.length - 2\n                            ] === selectedColumn;\n                        r.classList.toggle(\"psp-menu-open\", open);\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function column_header_style_listener(regularTable, viewer) {\n    let group_header_trs = Array.from(\n        regularTable.children[0].children[0].children\n    );\n\n    if (group_header_trs.length > 0) {\n        style_selected_column.call(\n            this,\n            regularTable,\n            viewer,\n            this._column_settings_selected_column\n        );\n\n        let [col_headers] = group_header_trs.splice(\n            this._config.split_by.length,\n            1\n        );\n\n        if (col_headers) {\n            style_column_header_row.call(\n                this,\n                regularTable,\n                col_headers,\n                false\n            );\n        }\n\n        let [style_menu_headers] = group_header_trs.splice(\n            this._config.split_by.length,\n            1\n        );\n\n        if (style_menu_headers) {\n            style_column_header_row.call(\n                this,\n                regularTable,\n                style_menu_headers,\n                true\n            );\n        }\n    }\n}\n\nfunction style_column_header_row(regularTable, col_headers, is_menu_row) {\n    // regular header styling\n    const header_depth = regularTable._view_cache.config.row_pivots.length - 1;\n    for (const td of col_headers.children) {\n        const metadata = regularTable.getMeta(td);\n        const column_name =\n            metadata.column_header?.[this._config.split_by.length];\n        const sort = this._config.sort.find((x) => x[0] === column_name);\n        let needs_border = metadata.row_header_x === header_depth;\n        const is_corner = typeof metadata.x === \"undefined\";\n        needs_border =\n            needs_border ||\n            (metadata.x + 1) % this._config.columns.length === 0;\n        td.classList.toggle(\"psp-header-border\", needs_border);\n        td.classList.toggle(\"psp-header-group\", false);\n        td.classList.toggle(\"psp-header-leaf\", true);\n        td.classList.toggle(\"psp-is-top\", false);\n        td.classList.toggle(\"psp-header-corner\", is_corner);\n        td.classList.toggle(\n            \"psp-header-sort-asc\",\n            !is_menu_row && !!sort && sort[1] === \"asc\"\n        );\n\n        td.classList.toggle(\n            \"psp-header-sort-desc\",\n            !is_menu_row && !!sort && sort[1] === \"desc\"\n        );\n\n        td.classList.toggle(\n            \"psp-header-sort-col-asc\",\n            !is_menu_row && !!sort && sort[1] === \"col asc\"\n        );\n\n        td.classList.toggle(\n            \"psp-header-sort-col-desc\",\n            !is_menu_row && !!sort && sort[1] === \"col desc\"\n        );\n\n        td.classList.toggle(\n            \"psp-header-sort-abs-asc\",\n            !is_menu_row && !!sort && sort[1] === \"asc abs\"\n        );\n\n        td.classList.toggle(\n            \"psp-header-sort-abs-desc\",\n            !is_menu_row && !!sort && sort[1] === \"desc abs\"\n        );\n\n        td.classList.toggle(\n            \"psp-header-sort-abs-col-asc\",\n            !is_menu_row && !!sort && sort[1] === \"col asc abs\"\n        );\n\n        td.classList.toggle(\n            \"psp-header-sort-abs-col-desc\",\n            !is_menu_row && !!sort && sort[1] === \"col desc abs\"\n        );\n\n        let type = get_psp_type.call(this, metadata);\n        const is_numeric = type === \"integer\" || type === \"float\";\n        const is_string = type === \"string\";\n        const is_date = type === \"date\";\n        const is_datetime = type === \"datetime\";\n        td.classList.toggle(\"psp-align-right\", is_numeric);\n        td.classList.toggle(\"psp-align-left\", !is_numeric);\n\n        td.classList.toggle(\n            \"psp-menu-enabled\",\n            (is_string || is_numeric || is_date || is_datetime) &&\n                !is_corner &&\n                metadata.column_header_y == this._config.split_by.length + 1\n        );\n\n        td.classList.toggle(\n            \"psp-sort-enabled\",\n            (is_string || is_numeric || is_date || is_datetime) &&\n                !is_corner &&\n                metadata.column_header_y === this._config.split_by.length\n        );\n\n        td.classList.toggle(\n            \"psp-is-width-override\",\n            regularTable._column_sizes?.override[metadata.size_key] !==\n                undefined\n        );\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport function group_header_style_listener(regularTable) {\n    const header_depth = regularTable._view_cache.config.row_pivots.length - 1;\n    let group_header_trs = Array.from(\n        regularTable.children[0].children[0].children\n    );\n\n    const m = [];\n    let marked = new Set();\n    const table = regularTable.children[0];\n    for (let y = 0; y < group_header_trs.length; y++) {\n        let row = table.rows[y];\n        const tops = new Set();\n        for (let x = 0; x < row.cells.length; x++) {\n            const td = row.cells[x];\n            td.style.backgroundColor = \"\";\n            const metadata = regularTable.getMeta(td);\n            let needs_border =\n                (header_depth > 0 && metadata.row_header_x === header_depth) ||\n                metadata.x >= 0;\n\n            td.classList.toggle(\"psp-align-right\", false);\n            td.classList.toggle(\"psp-align-left\", false);\n            td.classList.toggle(\"psp-header-group\", true);\n            td.classList.toggle(\"psp-header-leaf\", false);\n            td.classList.toggle(\"psp-header-border\", needs_border);\n            td.classList.toggle(\n                \"psp-header-group-corner\",\n                typeof metadata.x === \"undefined\"\n            );\n\n            td.classList.toggle(\"psp-color-mode-bar\", false);\n            td.classList.toggle(\"psp-header-sort-asc\", false);\n            td.classList.toggle(\"psp-header-sort-desc\", false);\n            td.classList.toggle(\"psp-header-sort-col-asc\", false);\n            td.classList.toggle(\"psp-header-sort-col-desc\", false);\n            td.classList.toggle(\"psp-sort-enabled\", false);\n\n            let cell = row.cells[x],\n                xx = x,\n                tx,\n                ty;\n\n            for (; m[y] && m[y][xx]; ++xx);\n            tops.add(xx);\n            for (tx = xx; tx < xx + cell.colSpan; ++tx) {\n                for (ty = y; ty < y + cell.rowSpan; ++ty) {\n                    if (!m[ty]) m[ty] = [];\n                    m[ty][tx] = true;\n                }\n            }\n\n            cell.classList.toggle(\"psp-is-top\", y === 0 || !marked.has(tx));\n        }\n        marked = tops;\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport function style_cell_flash(\n    metadata,\n    td,\n    [, , , , , pos_s, pos_e],\n    [, , , , , neg_s, neg_e],\n    is_settings_open\n) {\n    const id = this._ids?.[metadata.dy]?.join(\"|\");\n    const metadata_path = (\n        is_settings_open\n            ? metadata.column_header.slice(0, -1)\n            : metadata.column_header\n    ).join(\"|\");\n\n    if (\n        this.last_reverse_columns?.has(metadata_path) &&\n        this.last_reverse_ids?.has(id)\n    ) {\n        const row_idx = this.last_reverse_ids?.get(id);\n        const col_idx = this.last_reverse_columns.get(metadata_path);\n        if (!this._is_old_viewport) {\n            td.style.animation = \"\";\n        } else if (this.last_meta?.[col_idx]?.[row_idx] > metadata.user) {\n            td.style.setProperty(\"--pulse--background-color-start\", neg_s);\n            td.style.setProperty(\"--pulse--background-color-end\", neg_e);\n            if (td.style.animationName === \"pulse_neg\") {\n                td.style.animation = \"pulse_neg2 0.5s linear\";\n            } else {\n                td.style.animation = \"pulse_neg 0.5s linear\";\n            }\n        } else if (this.last_meta?.[col_idx]?.[row_idx] < metadata.user) {\n            td.style.setProperty(\"--pulse--background-color-start\", pos_s);\n            td.style.setProperty(\"--pulse--background-color-end\", pos_e);\n            if (td.style.animationName === \"pulse_pos\") {\n                td.style.animation = \"pulse_pos2 0.5s linear\";\n            } else {\n                td.style.animation = \"pulse_pos 0.5s linear\";\n            }\n        } else if (row_idx !== metadata.dy) {\n            td.style.animation = \"\";\n        }\n    } else {\n        td.style.animation = \"\";\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport chroma from \"chroma-js\";\n\nexport function blend(a, b) {\n    return chroma.mix(a, `rgb(${b[0]},${b[1]},${b[2]})`, 0.5).hex();\n}\n\n// AFAICT `chroma-js` has no alpha-aware blending? So we need a function to get\n// the color of a heatmap cell over the background.\nexport function rgbaToRgb([r, g, b, a], source = [255, 255, 255]) {\n    function f(i, c) {\n        return ((1 - a) * (source[i] / 255) + a * (c / 255)) * 255;\n    }\n\n    return [f(0, r), f(1, g), f(2, b)];\n}\n\n// Chroma does this but why bother?\nexport function infer_foreground_from_background([r, g, b]) {\n    // TODO Implement dark/light themes.\n    return Math.sqrt(r * r * 0.299 + g * g * 0.587 + b * b * 0.114) > 130\n        ? \"#161616\"\n        : \"#ffffff\";\n}\n\nfunction make_gradient(chromahex) {\n    const [r, g, b] = chromahex.rgb();\n    const [r1, g1, b1] = chromahex\n        .set(\"hsl.h\", (chromahex.get(\"hsl.h\") - 15) % 360)\n        .rgb();\n    const [r2, g2, b2] = chromahex\n        .set(\"hsl.h\", (chromahex.get(\"hsl.h\") + 15) % 360)\n        .rgb();\n    return `linear-gradient(to right top,rgb(${r1},${g1},${b1}),rgb(${r},${g},${b}) 50%,rgb(${r2},${g2},${b2}))`;\n}\n\nexport function make_color_record(color) {\n    const chroma_neg = chroma(color);\n    const _neg_grad = make_gradient(chroma_neg);\n    const rgb = chroma_neg.rgb();\n\n    return [\n        color,\n        ...rgb,\n        _neg_grad,\n        `rgba(${rgb[0]},${rgb[1]},${rgb[2]},1)`,\n        `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0)`,\n    ];\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { style_cell_flash } from \"./cell_flash.js\";\nimport {\n    rgbaToRgb,\n    infer_foreground_from_background,\n} from \"../../color_utils.js\";\n\nexport function cell_style_numeric(plugin, td, metadata, is_settings_open) {\n    const is_positive = metadata.user > 0;\n    const is_negative = metadata.user < 0;\n\n    let pos_bg_color;\n    if (plugin?.pos_bg_color !== undefined) {\n        pos_bg_color = plugin.pos_bg_color;\n    } else {\n        pos_bg_color = this._pos_bg_color;\n    }\n\n    let neg_bg_color;\n    if (plugin?.neg_bg_color !== undefined) {\n        neg_bg_color = plugin.neg_bg_color;\n    } else {\n        neg_bg_color = this._neg_bg_color;\n    }\n\n    const bg_tuple = is_positive\n        ? pos_bg_color\n        : is_negative\n        ? neg_bg_color\n        : [\"\", ...this._plugin_background, \"\"];\n\n    {\n        const [hex, r, g, b, _gradhex] = bg_tuple;\n\n        td.style.position = \"\";\n        if (metadata._is_hidden_by_aggregate_depth) {\n            td.style.animation = \"\";\n            td.style.backgroundColor = \"\";\n        } else if (plugin?.number_bg_mode === \"color\") {\n            td.style.animation = \"\";\n            td.style.backgroundColor = hex;\n        } else if (plugin?.number_bg_mode === \"gradient\") {\n            const a = Math.max(\n                0,\n                Math.min(1, Math.abs(metadata.user / plugin.bg_gradient))\n            );\n            const source = this._plugin_background;\n            const foreground = infer_foreground_from_background(\n                rgbaToRgb([r, g, b, a], source)\n            );\n\n            td.style.animation = \"\";\n            td.style.color = foreground;\n            td.style.backgroundColor = `rgba(${r},${g},${b},${a})`;\n        } else if (plugin?.number_bg_mode === \"pulse\") {\n            // TODO!\n            style_cell_flash.call(\n                this,\n                metadata,\n                td,\n                pos_bg_color,\n                neg_bg_color,\n                is_settings_open\n            );\n            td.style.backgroundColor = \"\";\n        } else if (\n            plugin?.number_bg_mode === \"disabled\" ||\n            !plugin?.number_bg_mode\n        ) {\n            td.style.animation = \"\";\n            td.style.backgroundColor = \"\";\n        } else {\n            td.style.animation = \"\";\n            td.style.backgroundColor = \"\";\n        }\n    }\n\n    const [hex, r, g, b, gradhex] = (() => {\n        if (plugin?.pos_fg_color !== undefined) {\n            return is_positive\n                ? plugin.pos_fg_color\n                : is_negative\n                ? plugin.neg_fg_color\n                : [\"\", ...this._plugin_background, \"\"];\n        } else {\n            return is_positive\n                ? this._pos_fg_color\n                : is_negative\n                ? this._neg_fg_color\n                : [\"\", ...this._plugin_background, \"\"];\n        }\n    })();\n\n    if (metadata._is_hidden_by_aggregate_depth) {\n        td.style.backgroundColor = \"\";\n        td.style.color = \"\";\n    } else if (plugin?.number_fg_mode === \"disabled\") {\n        if (plugin?.number_bg_mode === \"color\") {\n            const source = this._plugin_background;\n            const foreground = infer_foreground_from_background(\n                rgbaToRgb([bg_tuple[1], bg_tuple[2], bg_tuple[3], 1], source)\n            );\n            td.style.color = foreground;\n        } else if (plugin?.number_bg_mode === \"gradient\") {\n        } else {\n            td.style.color = \"\";\n        }\n    } else if (plugin?.number_fg_mode === \"bar\") {\n        td.style.color = \"\";\n        td.style.position = \"relative\";\n        if (\n            gradhex !== \"\" &&\n            td.children.length > 0 &&\n            td.children[0].nodeType === Node.ELEMENT_NODE\n        ) {\n            td.children[0].style.background = gradhex;\n        }\n    } else if (plugin?.number_fg_mode === \"color\" || !plugin?.number_fg_mode) {\n        td.style.color = hex;\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport chroma from \"chroma-js\";\nimport {\n    rgbaToRgb,\n    infer_foreground_from_background,\n} from \"../../color_utils.js\";\n\nexport function cell_style_string(plugin, td, metadata) {\n    const column_name = metadata.column_header?.[this._config.split_by.length];\n    const [hex, r, g, b, gradhex] = (() => {\n        if (plugin?.color !== undefined) {\n            return plugin.color;\n        } else {\n            return this._color;\n        }\n    })();\n\n    if (metadata._is_hidden_by_aggregate_depth) {\n        td.style.backgroundColor = \"\";\n        td.style.color = \"\";\n    } else if (\n        plugin?.string_color_mode === \"foreground\" &&\n        metadata.user !== null\n    ) {\n        td.style.color = hex;\n        td.style.backgroundColor = \"\";\n        if (plugin?.format === \"link\") {\n            td.children[0].style.color = hex;\n        }\n    } else if (\n        plugin?.string_color_mode === \"background\" &&\n        metadata.user !== null\n    ) {\n        const source = this._plugin_background;\n        const foreground = infer_foreground_from_background(\n            rgbaToRgb([r, g, b, 1], source)\n        );\n        td.style.color = foreground;\n        td.style.backgroundColor = hex;\n    } else if (\n        plugin?.string_color_mode === \"series\" &&\n        metadata.user !== null\n    ) {\n        if (!this._series_color_map.has(column_name)) {\n            this._series_color_map.set(column_name, new Map());\n            this._series_color_seed.set(column_name, 0);\n        }\n\n        const series_map = this._series_color_map.get(column_name);\n        if (!series_map.has(metadata.user)) {\n            const seed = this._series_color_seed.get(column_name);\n            series_map.set(metadata.user, seed);\n            this._series_color_seed.set(column_name, seed + 1);\n        }\n\n        const color_seed = series_map.get(metadata.user);\n        let [h, s, l] = chroma(hex).hsl();\n        h = h + ((color_seed * 150) % 360);\n        const color2 = chroma(h, s, l, \"hsl\");\n        const [r, g, b] = color2.rgb();\n        const hex2 = color2.hex();\n        const source = this._plugin_background;\n        const foreground = infer_foreground_from_background(\n            rgbaToRgb([r, g, b, 1], source)\n        );\n        td.style.color = foreground;\n        td.style.backgroundColor = hex2;\n    } else {\n        td.style.backgroundColor = \"\";\n        td.style.color = \"\";\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport chroma from \"chroma-js\";\nimport {\n    rgbaToRgb,\n    infer_foreground_from_background,\n} from \"../../color_utils.js\";\n\nexport function cell_style_datetime(plugin, td, metadata) {\n    const column_name = metadata.column_header?.[this._config.split_by.length];\n\n    const [hex, r, g, b, gradhex] = (() => {\n        if (plugin?.color !== undefined) {\n            return plugin.color;\n        } else {\n            return this._color;\n        }\n    })();\n\n    if (metadata._is_hidden_by_aggregate_depth) {\n        td.style.backgroundColor = \"\";\n        td.style.color = \"\";\n    } else if (\n        plugin?.datetime_color_mode === \"foreground\" &&\n        metadata.user !== null\n    ) {\n        td.style.color = hex;\n        td.style.backgroundColor = \"\";\n    } else if (\n        plugin?.datetime_color_mode === \"background\" &&\n        metadata.user !== null\n    ) {\n        const source = this._plugin_background;\n        const foreground = infer_foreground_from_background(\n            rgbaToRgb([r, g, b, 1], source)\n        );\n        td.style.color = foreground;\n        td.style.backgroundColor = hex;\n    } else {\n        td.style.backgroundColor = \"\";\n        td.style.color = \"\";\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport function cell_style_boolean(plugin, td, metadata) {\n    if (metadata._is_hidden_by_aggregate_depth) {\n        td.style.backgroundColor = \"\";\n        td.style.color = \"\";\n    } else {\n        const [hex] =\n            metadata.user === true\n                ? this._pos_fg_color\n                : metadata.user === false\n                ? this._neg_fg_color\n                : [\"\", 0, 0, 0, \"\"];\n        td.style.backgroundColor = \"\";\n        td.style.color = hex;\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport function cell_style_row_header(regularTable, td, metadata) {\n    const is_not_empty =\n        typeof metadata.value != undefined &&\n        typeof metadata.value != null &&\n        metadata.value?.toString()?.trim().length > 0;\n    const is_leaf = metadata.row_header_x >= this._config.group_by.length;\n    const next = regularTable.getMeta({\n        dx: 0,\n        dy: metadata.y - metadata.y0 + 1,\n    });\n    const is_collapse =\n        next &&\n        next.row_header &&\n        typeof next.row_header[metadata.row_header_x + 1] !== \"undefined\";\n    td.classList.toggle(\"psp-tree-label\", is_not_empty && !is_leaf);\n    td.classList.toggle(\n        \"psp-tree-label-expand\",\n        is_not_empty && !is_leaf && !is_collapse\n    );\n    td.classList.toggle(\n        \"psp-tree-label-collapse\",\n        is_not_empty && !is_leaf && is_collapse\n    );\n    td.classList.toggle(\"psp-tree-leaf\", is_not_empty && is_leaf);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { PRIVATE_PLUGIN_SYMBOL } from \"../../model\";\n\nimport { cell_style_numeric } from \"./numeric.js\";\nimport { cell_style_string } from \"./string.js\";\nimport { cell_style_datetime } from \"./datetime.js\";\nimport { cell_style_boolean } from \"./boolean.js\";\nimport { cell_style_row_header } from \"./row_header.js\";\n\nfunction get_psp_type(metadata) {\n    if (metadata.x >= 0) {\n        return this._column_types[metadata.x];\n    } else {\n        return this._row_header_types[metadata.row_header_x - 1];\n    }\n}\n\nexport function table_cell_style_listener(regularTable, viewer) {\n    const plugins = regularTable[PRIVATE_PLUGIN_SYMBOL] || {};\n    const is_settings_open = viewer.hasAttribute(\"settings\");\n\n    for (const tr of regularTable.children[0].children[1].children) {\n        for (const td of tr.children) {\n            const metadata = regularTable.getMeta(td);\n\n            const column_name =\n                metadata.column_header?.[this._config.split_by.length];\n\n            let type = get_psp_type.call(this, metadata);\n            const plugin = plugins[column_name];\n            const is_numeric = type === \"integer\" || type === \"float\";\n\n            // Check if aggregate depth hides this cell\n            metadata._is_hidden_by_aggregate_depth = ((x) =>\n                x === 0\n                    ? false\n                    : x - 1 <\n                      Math.min(\n                          this._config.group_by.length,\n                          plugin?.aggregate_depth\n                      ))(\n                metadata.row_header?.filter((x) => x !== undefined)?.length\n            );\n\n            if (is_numeric) {\n                cell_style_numeric.call(\n                    this,\n                    plugin,\n                    td,\n                    metadata,\n                    is_settings_open\n                );\n            } else if (type === \"boolean\") {\n                cell_style_boolean.call(this, plugin, td, metadata);\n            } else if (type === \"string\") {\n                cell_style_string.call(this, plugin, td, metadata);\n            } else if (type === \"date\" || type === \"datetime\") {\n                cell_style_datetime.call(this, plugin, td, metadata);\n            } else {\n                td.style.backgroundColor = \"\";\n                td.style.color = \"\";\n            }\n\n            td.classList.toggle(\n                \"psp-bool-type\",\n                type === \"boolean\" && metadata.user !== null\n            );\n\n            const is_th = td.tagName === \"TH\";\n            if (is_th) {\n                cell_style_row_header.call(this, regularTable, td, metadata);\n            }\n\n            tr.dataset.y = metadata.y;\n            if (\n                metadata.row_header_x === undefined ||\n                metadata.row_header_x === metadata.row_header.length - 1 ||\n                metadata.row_header[metadata.row_header_x + 1] === undefined\n            ) {\n                td.dataset.y = metadata.y;\n                td.dataset.x = metadata.x;\n            } else {\n                delete td.dataset.y;\n                delete td.dataset.x;\n            }\n\n            td.classList.toggle(\"psp-null\", metadata.value === null);\n            td.classList.toggle(\"psp-align-right\", !is_th && is_numeric);\n            td.classList.toggle(\"psp-align-left\", is_th || !is_numeric);\n            td.classList.toggle(\n                \"psp-color-mode-bar\",\n                plugin?.number_fg_mode === \"bar\" && is_numeric\n            );\n        }\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport async function sortHandler(regularTable, viewer, event, target) {\n    const meta = regularTable.getMeta(target);\n    const column_name = meta.column_header[this._config.split_by.length];\n    const sort_method =\n        event.ctrlKey || event.metaKet || event.altKey\n            ? append_sort\n            : override_sort;\n\n    const abs = event.shiftKey;\n    const sort = sort_method.call(this, column_name, abs);\n    await viewer.restore({ sort });\n}\n\nexport function append_sort(column_name, abs) {\n    const sort = [];\n    let found = false;\n    for (const sort_term of this._config.sort) {\n        const [_column_name, _sort_dir] = sort_term;\n        if (_column_name === column_name) {\n            found = true;\n            const term = create_sort.call(this, column_name, _sort_dir, abs);\n            if (term) {\n                sort.push(term);\n            }\n        } else {\n            sort.push(sort_term);\n        }\n    }\n    if (!found) {\n        sort.push([column_name, abs ? \"desc abs\" : \"desc\"]);\n    }\n    return sort;\n}\n\nexport function override_sort(column_name, abs) {\n    for (const [_column_name, _sort_dir] of this._config.sort) {\n        if (_column_name === column_name) {\n            const sort = create_sort.call(this, column_name, _sort_dir, abs);\n            return sort ? [sort] : [];\n        }\n    }\n    return [[column_name, abs ? \"desc abs\" : \"desc\"]];\n}\n\nexport function create_sort(column_name, sort_dir, abs) {\n    const is_col_sortable = this._config.split_by.length > 0;\n    const order = is_col_sortable ? ROW_COL_SORT_ORDER : ROW_SORT_ORDER;\n    let inc_sort_dir = sort_dir ? order[sort_dir] : \"desc\";\n    if (inc_sort_dir) {\n        return [column_name, inc_sort_dir];\n    }\n}\n\nconst ROW_SORT_ORDER = {\n    desc: \"asc\",\n    asc: undefined,\n    \"desc abs\": \"asc abs\",\n    \"asc abs\": undefined,\n};\nconst ROW_COL_SORT_ORDER = {\n    desc: \"asc\",\n    asc: \"col desc\",\n    \"desc abs\": \"asc abs\",\n    \"asc abs\": \"col desc abs\",\n    \"col desc\": \"col asc\",\n    \"col asc\": undefined,\n    \"col desc abs\": \"col asc abs\",\n    \"col asc abs\": undefined,\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport async function expandCollapseHandler(regularTable, event) {\n    const meta = regularTable.getMeta(event.target);\n    const is_collapse = event.target.classList.contains(\n        \"psp-tree-label-collapse\"\n    );\n    if (event.shiftKey && is_collapse) {\n        this._view.set_depth(\n            meta.row_header.filter((x) => x !== undefined).length - 2\n        );\n    } else if (event.shiftKey) {\n        this._view.set_depth(\n            meta.row_header.filter((x) => x !== undefined).length - 1\n        );\n    } else if (is_collapse) {\n        this._view.collapse(meta.y);\n    } else {\n        this._view.expand(meta.y);\n    }\n    this._num_rows = await this._view.num_rows();\n    this._num_columns = await this._view.num_columns();\n    regularTable.draw();\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { sortHandler } from \"./sort.js\";\nimport { expandCollapseHandler } from \"./expand_collapse.js\";\n\nexport async function mousedown_listener(regularTable, viewer, event) {\n    if (event.which !== 1) {\n        return;\n    }\n\n    let target = event.target;\n    if (target.tagName === \"A\") {\n        return;\n    }\n\n    while (target.tagName !== \"TD\" && target.tagName !== \"TH\") {\n        target = target.parentElement;\n        if (!regularTable.contains(target)) {\n            return;\n        }\n    }\n\n    if (target.classList.contains(\"psp-tree-label\")) {\n        expandCollapseHandler.call(this, regularTable, event);\n        return;\n    }\n\n    if (target.classList.contains(\"psp-menu-enabled\")) {\n        const meta = regularTable.getMeta(target);\n        const column_name = meta.column_header?.[this._config.split_by.length];\n        await viewer.toggleColumnSettings(column_name);\n    } else if (target.classList.contains(\"psp-sort-enabled\")) {\n        sortHandler.call(this, regularTable, viewer, event, target);\n    }\n}\n\n// TODO I hav eno idea what this does ...\n\nexport function click_listener(regularTable, event) {\n    if (event.which !== 1) {\n        return;\n    }\n\n    let target = event.target;\n    while (target.tagName !== \"TD\" && target.tagName !== \"TH\") {\n        target = target.parentElement;\n        if (!regularTable.contains(target)) {\n            return;\n        }\n    }\n\n    if (target.classList.contains(\"psp-tree-label\") && event.offsetX < 26) {\n        event.stopImmediatePropagation();\n    } else if (\n        target.classList.contains(\"psp-header-leaf\") &&\n        !target.classList.contains(\"psp-header-corner\")\n    ) {\n        event.stopImmediatePropagation();\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { PRIVATE_PLUGIN_SYMBOL } from \"../model\";\n\nfunction isEditable(viewer, allowed = false) {\n    const has_pivots =\n        this._config.group_by.length === 0 &&\n        this._config.split_by.length === 0;\n    const selectable = viewer.hasAttribute(\"selectable\");\n    const editable =\n        allowed ||\n        viewer.querySelector(\"perspective-viewer-datagrid\").dataset.editMode ===\n            \"EDIT\";\n    return has_pivots && !selectable && editable;\n}\n\nexport function editable_style_listener(table, viewer, datagrid) {\n    // Independently check \"editable\" and `isEditable()`, so we can skip\n    // the styler entirely if editing was disabled at the time of element\n    // creation, but toggle in when e.g. pivots or selectable will\n    // affect editability.\n    const plugins = table[PRIVATE_PLUGIN_SYMBOL] || {};\n    const edit = isEditable.call(this, viewer);\n    datagrid.classList.toggle(\n        \"edit-mode-allowed\",\n        isEditable.call(this, viewer, true)\n    );\n\n    for (const td of table.querySelectorAll(\"td\")) {\n        const meta = table.getMeta(td);\n        const type = this.get_psp_type(meta);\n        if (edit && this._is_editable[meta.x]) {\n            const col_name = meta.column_header[this._config.split_by.length];\n            if (type === \"string\" && plugins[col_name]?.format === \"link\") {\n                td.toggleAttribute(\"contenteditable\", false);\n                td.classList.toggle(\"boolean-editable\", false);\n            } else if (type === \"boolean\") {\n                td.toggleAttribute(\"contenteditable\", false);\n                td.classList.toggle(\"boolean-editable\", meta.user !== null);\n            } else {\n                if (edit !== td.hasAttribute(\"contenteditable\")) {\n                    td.toggleAttribute(\"contenteditable\", edit);\n                }\n                td.classList.toggle(\"boolean-editable\", false);\n            }\n        } else {\n            td.toggleAttribute(\"contenteditable\", false);\n            td.classList.toggle(\"boolean-editable\", false);\n        }\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\n// const selected_position_map = new WeakMap();\n\nexport const focus_style_listener = (table, _viewer, selected_position_map) => {\n    const tds = table.querySelectorAll(\"td\");\n    const selected_position = selected_position_map.get(table);\n    const host = table.getRootNode();\n    if (selected_position) {\n        for (const td of tds) {\n            const meta = table.getMeta(td);\n            if (\n                meta.x === selected_position.x &&\n                meta.y === selected_position.y\n            ) {\n                if (host.activeElement !== td) {\n                    td.focus({ preventScroll: true });\n                }\n                return true;\n            }\n        }\n        if (\n            document.activeElement !== document.body &&\n            table.contains(host.activeElement)\n        ) {\n            host.activeElement.blur();\n        }\n    }\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport function write_cell(table, model, active_cell) {\n    const meta = table.getMeta(active_cell);\n    const type = model._schema[model._column_paths[meta.x]];\n    if (meta) {\n        let text = active_cell.textContent;\n        const id = model._ids[meta.y - meta.y0][0];\n        if (type === \"float\" || type === \"integer\") {\n            text = parseFloat(text.replace(/,/g, \"\"));\n            if (isNaN(text)) {\n                return false;\n            }\n        } else if (type === \"date\" || type === \"datetime\") {\n            text = Date.parse(text);\n            if (isNaN(text)) {\n                return false;\n            }\n        } else if (type === \"boolean\") {\n            text = text === \"true\" ? false : text === \"false\" ? true : null;\n        }\n\n        const msg = {\n            __INDEX__: id,\n            [model._column_paths[meta.x]]: text,\n        };\n\n        model._table.update([msg], { port_id: model._edit_port });\n        return true;\n    }\n}\n\nexport function clickListener(table, _viewer, event) {\n    const meta = table.getMeta(event.target);\n    if (typeof meta?.x !== \"undefined\") {\n        const is_editable2 = this._is_editable[meta.x];\n        const is_bool = this.get_psp_type(meta) === \"boolean\";\n        const is_null = event.target.classList.contains(\"psp-null\");\n        if (is_editable2 && is_bool && !is_null) {\n            write_cell(table, this, event.target);\n        }\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { focus_style_listener } from \"../../style_handlers/focus.js\";\n\nfunction lock(body) {\n    let lock;\n    return async function (...args) {\n        if (!!lock && (await lock) && !!lock) {\n            return;\n        }\n\n        let resolve;\n        lock = new Promise((x) => (resolve = x));\n        await body.apply(this, args);\n        lock = undefined;\n        resolve();\n    };\n}\n\nfunction getPos() {\n    if (this.isContentEditable) {\n        let _range = this.getRootNode().getSelection().getRangeAt(0);\n        let range = _range.cloneRange();\n        range.selectNodeContents(this);\n        range.setEnd(_range.endContainer, _range.endOffset);\n        return range.toString().length;\n    } else {\n        return this.target.selectionStart;\n    }\n}\n\nconst moveSelection = lock(async function (\n    table,\n    selected_position_map,\n    active_cell,\n    dx,\n    dy\n) {\n    const meta = table.getMeta(active_cell);\n    const num_columns = this._column_paths.length;\n    const num_rows = this._num_rows;\n    const selected_position = selected_position_map.get(table);\n    if (!selected_position) {\n        return;\n    }\n\n    if (meta.x + dx < num_columns && 0 <= meta.x + dx) {\n        selected_position.x = meta.x + dx;\n    }\n\n    if (meta.y + dy < num_rows && 0 <= meta.y + dy) {\n        selected_position.y = meta.y + dy;\n    }\n\n    const xmin = Math.max(meta.x0 - 10, 0);\n    const xmax = Math.min(meta.x0 + 10, num_columns);\n    const ymin = Math.max(meta.y0 - 5, 0);\n    const ymax = Math.min(meta.y0 + 10, num_rows);\n    let x = meta.x0 + dx,\n        y = meta.y0 + dy;\n    while (\n        !focus_style_listener(table, undefined, selected_position_map) &&\n        x >= xmin &&\n        x < xmax &&\n        y >= ymin &&\n        y < ymax\n    ) {\n        await table.scrollToCell(x, y, num_columns, num_rows);\n        selected_position_map.set(table, selected_position);\n        x += dx;\n        y += dy;\n    }\n});\n\nfunction isLastCell(model, table, target) {\n    const meta = table.getMeta(target);\n    return meta.y === model._num_rows - 1;\n}\n\n// Events\nexport function keydownListener(table, viewer, selected_position_map, event) {\n    const target = table.getRootNode().activeElement;\n    event.target.classList.remove(\"psp-error\");\n    switch (event.key) {\n        case \"Enter\":\n            event.preventDefault();\n            if (isLastCell(this, table, target)) {\n                target.blur();\n                selected_position_map.delete(table);\n            } else if (event.shiftKey) {\n                moveSelection.call(\n                    this,\n                    table,\n                    selected_position_map,\n                    target,\n                    0,\n                    -1\n                );\n            } else {\n                moveSelection.call(\n                    this,\n                    table,\n                    selected_position_map,\n                    target,\n                    0,\n                    1\n                );\n            }\n            break;\n        case \"ArrowLeft\":\n            if (getPos.call(target) == 0) {\n                event.preventDefault();\n                moveSelection.call(\n                    this,\n                    table,\n                    selected_position_map,\n                    target,\n                    -1,\n                    0\n                );\n            }\n            break;\n        case \"ArrowUp\":\n            event.preventDefault();\n            moveSelection.call(\n                this,\n                table,\n                selected_position_map,\n                target,\n                0,\n                -1\n            );\n            break;\n        case \"ArrowRight\":\n            if (getPos.call(target) == target.textContent.length) {\n                event.preventDefault();\n                moveSelection.call(\n                    this,\n                    table,\n                    selected_position_map,\n                    target,\n                    1,\n                    0\n                );\n            }\n            break;\n        case \"ArrowDown\":\n            event.preventDefault();\n            moveSelection.call(\n                this,\n                table,\n                selected_position_map,\n                target,\n                0,\n                1\n            );\n            break;\n        default:\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as edit_click from \"./click/edit_click.js\";\nimport * as edit_keydown from \"./keydown/edit_keydown.js\";\n\nexport function is_editable(viewer, allowed = false) {\n    const has_pivots =\n        this._config.group_by.length === 0 &&\n        this._config.split_by.length === 0;\n    const selectable = viewer.hasAttribute(\"selectable\");\n    const editable = allowed || !!(viewer.children[0]._edit_mode === \"EDIT\");\n    return has_pivots && !selectable && editable;\n}\n\nexport function keydownListener(table, viewer, selected_position_map, event) {\n    if (this._edit_mode === \"EDIT\") {\n        if (!is_editable.call(this, viewer)) {\n            return;\n        }\n\n        edit_keydown.keydownListener.call(\n            this,\n            table,\n            viewer,\n            selected_position_map,\n            event\n        );\n    } else {\n        console.debug(\n            `Mode ${this._edit_mode} for \"keydown\" event not yet implemented`\n        );\n    }\n}\n\nexport function clickListener(table, viewer, event) {\n    if (this._edit_mode === \"EDIT\") {\n        if (!is_editable.call(this, viewer)) {\n            return;\n        }\n\n        edit_click.clickListener.call(this, table, viewer, event);\n    } else if (this._edit_mode === \"READ_ONLY\") {\n    } else if (this._edit_mode === \"SELECT_COLUMN\") {\n    } else if (this._edit_mode === \"SELECT_ROW\") {\n    } else if (this._edit_mode === \"SELECT_REGION\") {\n    } else {\n        console.debug(\n            `Mode ${this._edit_mode} for \"click\" event not yet implemented`\n        );\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { is_editable } from \"./click.js\";\nimport { write_cell } from \"./click/edit_click.js\";\n\nexport function focusoutListener(table, viewer, selected_position_map, event) {\n    if (is_editable.call(this, viewer) && selected_position_map.has(table)) {\n        event.target.classList.remove(\"psp-error\");\n        const selectedPosition = selected_position_map.get(table);\n        selected_position_map.delete(table);\n        if (selectedPosition.content !== event.target.textContent) {\n            if (!write_cell(table, this, event.target)) {\n                event.target.textContent = selectedPosition.content;\n                event.target.classList.add(\"psp-error\");\n                event.target.focus();\n            }\n        }\n    }\n}\n\nexport function focusinListener(table, _viewer, selected_position_map, event) {\n    const meta = table.getMeta(event.target);\n    if (meta) {\n        const new_state = {\n            x: meta.x,\n            y: meta.y,\n            content: event.target.textContent,\n        };\n        selected_position_map.set(table, new_state);\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport default async function getCellConfig(\n    { _view, _config },\n    row_idx,\n    col_idx\n) {\n    const group_by = _config.group_by;\n    const split_by = _config.split_by;\n    const start_row = row_idx >= 0 ? row_idx : 0;\n    const end_row = start_row + 1;\n    const r = await _view.to_json({ start_row, end_row });\n    const row_paths = r.map((x) => x.__ROW_PATH__);\n    const group_by_values = row_paths[0] || [];\n    const row_filters = group_by\n        .map((pivot, index) => {\n            const pivot_value = group_by_values[index];\n            return pivot_value ? [pivot, \"==\", pivot_value] : undefined;\n        })\n        .filter((x) => x);\n\n    const column_index = group_by.length > 0 ? col_idx + 1 : col_idx;\n    const column_paths = Object.keys(r[0])[column_index];\n    const result = { row: r[0] };\n    let column_filters = [];\n    if (column_paths) {\n        const split_by_values = column_paths.split(\"|\");\n        result.column_names = [split_by_values[split_by.length]];\n        column_filters = split_by\n            .map((pivot, index) => {\n                const pivot_value = split_by_values[index];\n                return pivot_value ? [pivot, \"==\", pivot_value] : undefined;\n            })\n            .filter((x) => x)\n            .filter(([, , value]) => value !== \"__ROW_PATH__\");\n    }\n\n    const filter = _config.filter.concat(row_filters).concat(column_filters);\n    result.config = { filter };\n    return result;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport getCellConfig from \"../get_cell_config.js\";\n\nexport async function selectionListener(\n    regularTable,\n    viewer,\n    selected_rows_map,\n    event\n) {\n    const meta = regularTable.getMeta(event.target);\n    if (!viewer.hasAttribute(\"selectable\")) return;\n    if (event.handled) return;\n    if (event.which !== 1) {\n        return;\n    }\n\n    if (!meta) {\n        return;\n    }\n\n    const id = this._ids?.[meta.y - meta.y0];\n    if (meta && meta.y >= 0) {\n        const selected = selected_rows_map.get(regularTable);\n        const key_match =\n            !!selected &&\n            selected.reduce((agg, x, i) => agg && x === id[i], true);\n\n        const is_deselect =\n            !!selected && id.length === selected.length && key_match;\n\n        let detail = { selected: !is_deselect };\n        const { row, column_names, config } = await getCellConfig(\n            this,\n            meta.y,\n            meta.x\n        );\n\n        if (is_deselect) {\n            selected_rows_map.delete(regularTable);\n            detail = {\n                ...detail,\n                row,\n                config: { filter: structuredClone(this._config.filter) },\n            };\n        } else {\n            selected_rows_map.set(regularTable, id);\n            detail = { ...detail, row, column_names, config };\n        }\n\n        await regularTable.draw({ preserve_width: true });\n        event.handled = true;\n        viewer.dispatchEvent(\n            new CustomEvent(\"perspective-select\", {\n                bubbles: true,\n                composed: true,\n                detail,\n            })\n        );\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport function selectionStyleListener(\n    regularTable,\n    viewer,\n    selected_rows_map\n) {\n    if (!viewer.hasAttribute(\"selectable\")) return;\n    const has_selected = selected_rows_map.has(regularTable);\n    const selected = selected_rows_map.get(regularTable);\n    for (const td of regularTable.querySelectorAll(\"td\")) {\n        if (!has_selected) {\n            td.classList.toggle(\"psp-row-selected\", false);\n            td.classList.toggle(\"psp-row-subselected\", false);\n        } else {\n            const meta = regularTable.getMeta(td);\n            const id = this._ids[meta.y - meta.y0];\n            const key_match = selected.reduce(\n                (agg, x, i) => agg && x === id[i],\n                true\n            );\n            td.classList.toggle(\n                \"psp-row-selected\",\n                id.length === selected.length && key_match\n            );\n            td.classList.toggle(\n                \"psp-row-subselected\",\n                id.length !== selected.length && key_match\n            );\n        }\n    }\n\n    for (const th of regularTable.querySelectorAll(\"tbody th\")) {\n        const meta = regularTable.getMeta(th);\n        const id = this._ids[meta.y - meta.y0];\n        if (!has_selected || !!id[meta.row_header_x]) {\n            th.classList.toggle(\"psp-row-selected\", false);\n            th.classList.toggle(\"psp-row-subselected\", false);\n        } else {\n            const key_match = selected.reduce(\n                (agg, x, i) => agg && x === id[i],\n                true\n            );\n            th.classList.toggle(\n                \"psp-row-selected\",\n                id.length === selected.length && key_match\n            );\n            th.classList.toggle(\n                \"psp-row-subselected\",\n                id.length !== selected.length && key_match\n            );\n        }\n    }\n}\n\n//  export function configureRowSelectable(table, viewer) {\n//      table.addStyleListener(selectionStyleListener.bind(this, table, viewer));\n//      table.addEventListener(\n//          \"mousedown\",\n//          selectionListener.bind(this, table, viewer)\n//      );\n//  }\n\n// export async function deselect(regularTable) {\n//     selected_rows_map.delete(regularTable);\n//     for (const td of regularTable.querySelectorAll(\"td,th\")) {\n//         td.classList.toggle(\"psp-row-selected\", false);\n//         td.classList.toggle(\"psp-row-subselected\", false);\n//     }\n// }\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport async function deselect_all_listener(\n    regularTable,\n    _viewer,\n    selected_rows_map\n) {\n    selected_rows_map.delete(regularTable);\n    for (const td of regularTable.querySelectorAll(\"td,th\")) {\n        td.classList.toggle(\"psp-row-selected\", false);\n        td.classList.toggle(\"psp-row-subselected\", false);\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport chroma from \"chroma-js\";\nimport { createDataListener } from \"../data_listener\";\nimport { blend, make_color_record } from \"../color_utils.js\";\n\nfunction get_rule(regular, tag, def) {\n    let color = window.getComputedStyle(regular).getPropertyValue(tag).trim();\n    if (color.length > 0) {\n        return color;\n    } else {\n        return def;\n    }\n}\n\nclass ElemFactory {\n    constructor(name) {\n        this._name = name;\n        this._elements = [];\n        this._index = 0;\n    }\n\n    clear() {\n        this._index = 0;\n    }\n\n    get() {\n        if (!this._elements[this._index]) {\n            this._elements[this._index] = document.createElement(this._name);\n        }\n        const elem = this._elements[this._index];\n        this._index += 1;\n        return elem;\n    }\n}\n\nfunction get_psp_type(metadata) {\n    if (metadata.x >= 0) {\n        return this._column_types[metadata.x];\n    } else {\n        return this._row_header_types[metadata.row_header_x - 1];\n    }\n}\n\nexport async function createModel(regular, table, view, extend = {}) {\n    const config = await view.get_config();\n    if (this?.model?._config) {\n        const old = this.model._config;\n        let group_by_changed = old.group_by.length !== config.group_by.length;\n        const type_changed =\n            (old.group_by.length === 0 || config.group_by.length === 0) &&\n            group_by_changed;\n\n        if (!group_by_changed) {\n            for (const lvl in old.group_by) {\n                group_by_changed ||= config.group_by[lvl] !== old.group_by[lvl];\n            }\n        }\n\n        let split_by_changed = old.split_by.length !== config.split_by.length;\n        if (split_by_changed) {\n            for (const lvl in old.split_by) {\n                split_by_changed ||= config.split_by[lvl] !== old.split_by[lvl];\n            }\n        }\n\n        let columns_changed = old.columns.length !== config.columns.length;\n        if (columns_changed) {\n            for (const lvl in old.columns) {\n                columns_changed ||= config.columns[lvl] !== old.columns[lvl];\n            }\n        }\n\n        let filter_changed = old.filter.length !== config.filter.length;\n        if (filter_changed) {\n            for (const lvl in old.filter) {\n                for (const i in config.filter[lvl]) {\n                    filter_changed ||=\n                        config.filter[lvl][i] !== old.filter[lvl][i];\n                }\n            }\n        }\n\n        let sort_changed = old.sort.length !== config.sort.length;\n        if (sort_changed) {\n            for (const lvl in old.sort) {\n                for (const i in config.sort[lvl]) {\n                    sort_changed ||= config.sort[lvl][i] !== old.sort[lvl][i];\n                }\n            }\n        }\n\n        this._reset_scroll_top = group_by_changed;\n        this._reset_scroll_left = split_by_changed;\n        this._reset_select =\n            group_by_changed ||\n            split_by_changed ||\n            filter_changed ||\n            sort_changed ||\n            columns_changed;\n\n        this._reset_column_size =\n            split_by_changed ||\n            group_by_changed ||\n            columns_changed ||\n            type_changed;\n    }\n\n    const [\n        table_schema,\n        num_rows,\n        schema,\n        expression_schema,\n        column_paths,\n        _edit_port,\n    ] = await Promise.all([\n        table.schema(),\n        view.num_rows(),\n        view.schema(),\n        view.expression_schema(),\n        view.column_paths(),\n        this.parentElement.getEditPort(),\n    ]);\n\n    const _plugin_background = chroma(\n        get_rule(regular, \"--plugin--background\", \"#FFFFFF\")\n    ).rgb();\n\n    const _pos_fg_color = make_color_record(\n        get_rule(regular, \"--rt-pos-cell--color\", \"#338DCD\")\n    );\n\n    const _neg_fg_color = make_color_record(\n        get_rule(regular, \"--rt-neg-cell--color\", \"#FF5942\")\n    );\n\n    const _pos_bg_color = make_color_record(\n        blend(_pos_fg_color[0], _plugin_background)\n    );\n\n    const _neg_bg_color = make_color_record(\n        blend(_neg_fg_color[0], _plugin_background)\n    );\n\n    const _color = make_color_record(\n        get_rule(regular, \"--active--color\", \"#ff0000\")\n    );\n\n    const _schema = { ...schema, ...expression_schema };\n    const _table_schema = {\n        ...table_schema,\n        ...expression_schema,\n    };\n\n    const _column_paths = column_paths.filter((path) => {\n        return path !== \"__ROW_PATH__\" && path !== \"__ID__\";\n    });\n\n    const _is_editable = [];\n    const _column_types = [];\n    for (const column_path of _column_paths) {\n        const column_path_parts = column_path.split(\"|\");\n        const column = column_path_parts[config.split_by.length];\n        _column_types.push(_schema[column]);\n        _is_editable.push(!!table_schema[column]);\n    }\n\n    let _edit_mode = this._edit_mode || \"READ_ONLY\";\n    this._edit_button.dataset.editMode = _edit_mode;\n    const model = Object.assign(extend, {\n        _edit_port,\n        _view: view,\n        _table: table,\n        _table_schema,\n        _config: config,\n        _num_rows: num_rows,\n        _schema,\n        _ids: [],\n        _plugin_background,\n        _color,\n        _pos_fg_color,\n        _neg_fg_color,\n        _pos_bg_color,\n        _neg_bg_color,\n        _column_paths,\n        _column_types,\n        _is_editable,\n        _edit_mode,\n        _selection_state: {\n            selected_areas: [],\n            dirty: false,\n        },\n        _row_header_types: config.group_by.map((column_path) => {\n            return _table_schema[column_path];\n        }),\n        _series_color_map: new Map(),\n        _series_color_seed: new Map(),\n        get_psp_type,\n    });\n\n    // Re-use div factory\n    model._div_factory = model._div_factory || new ElemFactory(\"div\");\n    regular.setDataListener(\n        createDataListener(this.parentElement).bind(model, regular),\n        {\n            virtual_mode:\n                window\n                    .getComputedStyle(regular)\n                    .getPropertyValue(\"--datagrid-virtual-mode\")\n                    ?.trim() || \"both\",\n        }\n    );\n\n    return model;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nconst FORMATTER_CONS = {\n    datetime: Intl.DateTimeFormat,\n    date: Intl.DateTimeFormat,\n    integer: Intl.NumberFormat,\n    float: Intl.NumberFormat,\n    boolean: class {\n        format(val) {\n            return val ? \"true\" : \"false\";\n        }\n    },\n};\n\nconst LEGACY_CONFIG = {\n    types: {\n        float: {\n            format: {\n                style: \"decimal\",\n                minimumFractionDigits: 2,\n                maximumFractionDigits: 2,\n            },\n        },\n        datetime: {\n            format: {\n                dateStyle: \"short\",\n                timeStyle: \"medium\",\n            },\n        },\n        date: {\n            format: {\n                dateStyle: \"short\",\n            },\n        },\n    },\n};\n\nexport class FormatterCache {\n    constructor() {\n        this._formatters = new Map();\n    }\n\n    create_datetime_formatter(type, plugin) {\n        const type_config = {\n            dateStyle: \"short\",\n            timeStyle: \"medium\",\n        };\n\n        if (plugin.date_format?.format !== \"custom\") {\n            const options = {\n                ...type_config,\n                timeZone: plugin.date_format?.timeZone,\n                dateStyle: plugin.date_format?.dateStyle,\n                timeStyle: plugin.date_format?.timeStyle,\n            };\n            if (options.dateStyle === \"disabled\") {\n                options.dateStyle = undefined;\n            } else if (options.dateStyle === undefined) {\n                options.dateStyle = \"short\";\n            }\n\n            if (options.timeStyle === \"disabled\") {\n                options.timeStyle = undefined;\n            } else if (options.timeStyle === undefined) {\n                options.timeStyle = \"medium\";\n            }\n\n            return new Intl.DateTimeFormat(navigator.languages, options);\n        } else {\n            const options = {\n                // ...type_config.format,\n                timeZone: plugin.date_format?.timeZone,\n                second: plugin.date_format?.second,\n                minute: plugin.date_format?.minute,\n                hour: plugin.date_format?.hour,\n                day: plugin.date_format?.day,\n                weekday: plugin.date_format?.weekday,\n                month: plugin.date_format?.month,\n                year: plugin.date_format?.year,\n                hour12: plugin.date_format?.hour12,\n                fractionalSecondDigits:\n                    plugin.date_format?.fractionalSecondDigits,\n            };\n\n            if (options.year === \"disabled\") {\n                options.year = undefined;\n            } else if (options.year === undefined) {\n                options.year = \"2-digit\";\n            }\n\n            if (options.month === \"disabled\") {\n                options.month = undefined;\n            } else if (options.month === undefined) {\n                options.month = \"numeric\";\n            }\n\n            if (options.day === \"disabled\") {\n                options.day = undefined;\n            } else if (options.day === undefined) {\n                options.day = \"numeric\";\n            }\n\n            if (options.weekday === \"disabled\") {\n                options.weekday = undefined;\n            }\n\n            if (options.hour === \"disabled\") {\n                options.hour = undefined;\n            } else if (options.hour === undefined) {\n                options.hour = \"numeric\";\n            }\n\n            if (options.minute === \"disabled\") {\n                options.minute = undefined;\n            } else if (options.minute === undefined) {\n                options.minute = \"numeric\";\n            }\n\n            if (options.second === \"disabled\") {\n                options.second = undefined;\n            } else if (options.second === undefined) {\n                options.second = \"numeric\";\n            }\n\n            if (options.hour12 === undefined) {\n                options.hour12 = true;\n            }\n\n            return new Intl.DateTimeFormat(navigator.languages, options);\n        }\n    }\n\n    create_date_formatter(type, plugin) {\n        const options = {\n            dateStyle: plugin.date_format?.dateStyle,\n            timeZone: \"utc\",\n        };\n\n        if (options.dateStyle === \"disabled\") {\n            options.dateStyle = undefined;\n        } else if (options.dateStyle === undefined) {\n            options.dateStyle = \"short\";\n        }\n\n        return new Intl.DateTimeFormat(navigator.languages, options);\n    }\n\n    create_number_formatter(type, plugin) {\n        let format = LEGACY_CONFIG.types[type]?.format;\n        if (plugin.number_format !== undefined) {\n            format = plugin.number_format;\n        }\n\n        return new FORMATTER_CONS[type](navigator.languages, format);\n    }\n\n    create_boolean_formatter(type, plugin) {\n        return new FORMATTER_CONS[type](navigator.languages, {});\n    }\n\n    get(type, plugin) {\n        let formatter_key = [\n            type,\n            ...Object.values(plugin.date_format ?? {}),\n            ...Object.values(plugin.number_format ?? {}),\n        ].join(\"-\");\n\n        if (!this._formatters.has(formatter_key)) {\n            if (type === \"date\") {\n                this._formatters.set(\n                    formatter_key,\n                    this.create_date_formatter(type, plugin)\n                );\n            } else if (type === \"datetime\") {\n                this._formatters.set(\n                    formatter_key,\n                    this.create_datetime_formatter(type, plugin)\n                );\n            } else if (type === \"integer\" || type === \"float\") {\n                this._formatters.set(\n                    formatter_key,\n                    this.create_number_formatter(type, plugin)\n                );\n            } else if (type === \"boolean\") {\n                this._formatters.set(\n                    formatter_key,\n                    this.create_boolean_formatter(type, plugin)\n                );\n            } else {\n                this._formatters.set(formatter_key, false);\n            }\n        }\n\n        return this._formatters.get(formatter_key);\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { FormatterCache } from \"./formatter_cache\";\n\nconst FORMAT_CACHE = new FormatterCache();\nconst MAX_BAR_WIDTH_PCT = 1;\n\nexport function format_raw(type, value) {\n    return FORMAT_CACHE.get(type, value);\n}\n\n/**\n * Format a single cell's text content as the content of a `<td>` or `<th>`.\n *\n * @param {*} parts\n * @param {*} val\n * @param {*} plugins\n * @param {*} use_table_schema\n * @returns\n */\nexport function format_cell(\n    title,\n    val,\n    plugins = {},\n    use_table_schema = false\n) {\n    if (val === null) {\n        return null;\n    }\n\n    const type =\n        (use_table_schema && this._table_schema[title]) ||\n        this._schema[title] ||\n        \"string\";\n    const plugin = plugins[title] || {};\n    const is_numeric = type === \"integer\" || type === \"float\";\n    if (is_numeric && plugin?.number_fg_mode === \"bar\") {\n        const a = Math.max(\n            0,\n            Math.min(\n                MAX_BAR_WIDTH_PCT,\n                Math.abs(val / plugin.fg_gradient) * MAX_BAR_WIDTH_PCT\n            )\n        );\n\n        const div = this._div_factory.get();\n        const anchor = val >= 0 ? \"left\" : \"right\";\n        const pct = (a * 100).toFixed(2);\n        div.setAttribute(\n            \"style\",\n            `width:calc(${pct}% - 4px);position:absolute;${anchor}:2px;height:80%;top:10%;pointer-events:none;`\n        );\n\n        return div;\n    } else if (plugin?.format === \"link\" && type === \"string\") {\n        const anchor = document.createElement(\"a\");\n        anchor.setAttribute(\"href\", val);\n        anchor.setAttribute(\"target\", \"_blank\");\n        anchor.textContent = val;\n        return anchor;\n    } else if (plugin?.format === \"bold\" && type === \"string\") {\n        const anchor = document.createElement(\"b\");\n        anchor.textContent = val;\n        return anchor;\n    } else if (plugin?.format === \"italics\" && type === \"string\") {\n        const anchor = document.createElement(\"i\");\n        anchor.textContent = val;\n        return anchor;\n    } else {\n        const formatter = FORMAT_CACHE.get(type, plugin);\n        return formatter ? formatter.format(val) : val;\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { PRIVATE_PLUGIN_SYMBOL } from \"../model\";\nimport { format_cell } from \"./format_cell.js\";\n\n/**\n * Format a single cell of the `group_by` tree header.\n *\n * @param {*} paths\n * @param {*} row_headers\n * @param {*} regularTable\n */\nexport function* format_tree_header_row_path(\n    paths = [],\n    row_headers,\n    regularTable\n) {\n    const plugins = regularTable[PRIVATE_PLUGIN_SYMBOL];\n    for (let path of paths) {\n        path = [\"TOTAL\", ...path];\n        const last = path[path.length - 1];\n        path = path.slice(0, path.length - 1).fill(\"\");\n        const formatted = format_cell.call(\n            this,\n            row_headers[path.length - 1],\n            last,\n            plugins,\n            true\n        );\n\n        if (formatted instanceof HTMLElement) {\n            path = path.concat(formatted);\n        } else {\n            path = path.concat({ toString: () => formatted });\n        }\n\n        path.length = row_headers.length + 1;\n        yield path;\n    }\n}\n\nexport function* format_tree_header(paths = [], row_headers, regularTable) {\n    const plugins = regularTable[PRIVATE_PLUGIN_SYMBOL];\n    for (let path of paths) {\n        const new_path = [\"\"];\n        for (const idx in path) {\n            new_path.push(\n                format_cell.call(\n                    this,\n                    row_headers[idx],\n                    path[idx],\n                    plugins,\n                    true\n                )\n            );\n        }\n\n        yield path;\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { PRIVATE_PLUGIN_SYMBOL } from \"../model\";\nimport { format_cell } from \"./format_cell.js\";\nimport {\n    format_tree_header,\n    format_tree_header_row_path,\n} from \"./format_tree_header.js\";\n\n/**\n * Creates a new DataListener, suitable for passing to `regular-table`'s\n * `.setDataListener()` method.  This should be called as a method on the\n * plugin.\n *\n * @returns A data listener for the plugin.\n */\nexport function createDataListener(viewer) {\n    let last_meta;\n    let last_column_paths;\n    let last_ids;\n    let last_reverse_ids;\n    let last_reverse_columns;\n    return async function dataListener(regularTable, x0, y0, x1, y1) {\n        let columns = {};\n        let new_window;\n        if (x1 - x0 > 0 && y1 - y0 > 0) {\n            this._is_old_viewport =\n                this._last_window?.start_row === y0 &&\n                this._last_window?.end_row === y1 &&\n                this._last_window?.start_col === x0 &&\n                this._last_window?.end_col === x1;\n\n            new_window = {\n                start_row: y0,\n                start_col: x0,\n                end_row: y1,\n                end_col: x1,\n                id: true,\n            };\n\n            if (this._config.split_by?.length > 0) {\n                const [x, y] = await Promise.all([\n                    this._view.to_columns_string(new_window),\n                    this._view.column_paths(new_window),\n                ]);\n\n                columns = JSON.parse(x);\n                const new_col_paths = y.filter(\n                    (x) => x !== \"__ROW_PATH__\" && x !== \"__ID__\"\n                );\n\n                const old_length = this._column_paths.length;\n                this._column_paths.splice(\n                    new_window.start_col,\n                    new_col_paths.length,\n                    ...new_col_paths\n                );\n\n                if (this._column_paths.length !== old_length) {\n                    const [a, b] = await Promise.all([\n                        this._view.schema(),\n                        this._view.expression_schema(),\n                    ]);\n\n                    this._schema = { ...a, ...b };\n                    for (let i = 0; i < new_col_paths.length; i++) {\n                        const column_path_parts = new_col_paths[i].split(\"|\");\n                        const column =\n                            column_path_parts[this._config.split_by.length];\n\n                        this._column_types[i + new_window.start_col] =\n                            this._schema[column];\n                    }\n                }\n            } else {\n                columns = JSON.parse(\n                    await this._view.to_columns_string(new_window)\n                );\n            }\n\n            this._last_window = new_window;\n            this._ids =\n                columns.__ID__ ||\n                Array(y1 - y0)\n                    .fill()\n                    .map((_, index) => [index + y0]);\n\n            this._reverse_columns = this._column_paths\n                .slice(x0, x1)\n                .reduce((acc, x, i) => {\n                    acc.set(x, i);\n                    return acc;\n                }, new Map());\n\n            this._reverse_ids = this._ids?.reduce((acc, x, i) => {\n                acc.set(x?.join(\"|\"), i);\n                return acc;\n            }, new Map());\n        } else {\n            this._div_factory.clear();\n        }\n\n        const data = [],\n            metadata = [],\n            column_headers = [],\n            column_paths = [];\n\n        const is_settings_open = viewer.hasAttribute(\"settings\");\n        for (\n            let ipath = x0;\n            ipath < Math.min(x1, this._column_paths.length);\n            ++ipath\n        ) {\n            const path = this._column_paths[ipath];\n            const path_parts = path.split(\"|\");\n            const column = columns[path] || new Array(y1 - y0).fill(null);\n            const agg_depth = Math.min(\n                regularTable[PRIVATE_PLUGIN_SYMBOL]?.[\n                    path_parts[this._config.split_by.length]\n                ]?.aggregate_depth || 0,\n                this._config.group_by.length\n            );\n\n            data.push(\n                column.map((x, i) => {\n                    if (columns?.__ROW_PATH__?.[i]?.length < agg_depth) {\n                        return \"\";\n                    } else {\n                        return format_cell.call(\n                            this,\n                            path_parts[this._config.split_by.length],\n                            x,\n                            regularTable[PRIVATE_PLUGIN_SYMBOL]\n                        );\n                    }\n                })\n            );\n\n            metadata.push(column);\n            if (is_settings_open) {\n                path_parts.push(\"\");\n            }\n\n            column_headers.push(path_parts);\n            column_paths.push(path);\n        }\n\n        // Only update the last state if this is not a \"phantom\" call.\n        if (x1 - x0 > 0 && y1 - y0 > 0) {\n            this.last_column_paths = last_column_paths;\n            this.last_meta = last_meta;\n            this.last_ids = last_ids;\n            this.last_reverse_ids = last_reverse_ids;\n            this.last_reverse_columns = last_reverse_columns;\n\n            last_column_paths = column_paths;\n            last_meta = metadata;\n            last_ids = this._ids;\n            last_reverse_ids = this._reverse_ids;\n            last_reverse_columns = this._reverse_columns;\n        }\n\n        const is_row_path = columns.__ROW_PATH__ !== undefined;\n        const row_headers = Array.from(\n            (is_row_path\n                ? format_tree_header_row_path\n                : format_tree_header\n            ).call(\n                this,\n                columns.__ROW_PATH__,\n                this._config.group_by,\n                regularTable\n            )\n        );\n\n        const num_row_headers = row_headers[0]?.length;\n\n        const result = {\n            num_column_headers: column_headers[0]?.length || 1,\n            num_row_headers,\n            num_rows: this._num_rows,\n            num_columns: this._column_paths.length,\n            row_headers,\n            column_headers,\n            data,\n            metadata,\n            column_header_merge_depth: Math.max(\n                0,\n                this._config.split_by.length\n            ),\n        };\n\n        return result;\n    };\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport getCellConfig from \"../get_cell_config\";\n\nexport async function dispatch_click_listener(table, viewer, event) {\n    const meta = table.getMeta(event.target);\n    if (!meta) return;\n    const { x, y } = meta;\n\n    const { row, column_names, config } = await getCellConfig(this, y, x);\n\n    viewer.dispatchEvent(\n        new CustomEvent(\"perspective-click\", {\n            bubbles: true,\n            composed: true,\n            detail: {\n                row,\n                column_names,\n                config,\n            },\n        })\n    );\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\n// const PRIVATE = Symbol(\"Area Mouse Selection\");\nconst MOUSE_SELECTED_AREA_CLASS = \"mouse-selected-area\";\n\nexport const addAreaMouseSelection = (\n    datagrid,\n    table,\n    { className = MOUSE_SELECTED_AREA_CLASS, selected = [] } = {}\n) => {\n    datagrid.model._selection_state = {\n        selected_areas: selected,\n        dirty: true,\n    };\n\n    table.addEventListener(\n        \"mousedown\",\n        getMousedownListener(datagrid, table, className)\n    );\n\n    table.addEventListener(\n        \"mouseover\",\n        getMouseoverListener(datagrid, table, className)\n    );\n\n    table.addEventListener(\n        \"mouseup\",\n        getMouseupListener(datagrid, table, className)\n    );\n\n    table.addStyleListener(() =>\n        applyMouseAreaSelections(datagrid, table, className)\n    );\n\n    return table;\n};\n\nconst getMousedownListener = (datagrid, table, className) => (event) => {\n    if (\n        event.button === 0 &&\n        (datagrid.model._edit_mode === \"SELECT_REGION\" ||\n            datagrid.model._edit_mode === \"SELECT_ROW\" ||\n            datagrid.model._edit_mode === \"SELECT_COLUMN\")\n    ) {\n        datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES = {};\n        const meta = table.getMeta(event.target);\n        if (meta && meta.x !== undefined && meta.y !== undefined) {\n            datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES = {\n                x: meta.x,\n                y: meta.y,\n            };\n\n            // // TODO: Enable multiselect here\n            // if (!event.ctrlKey && !event.metaKey) {\n            //     datagrid.model._selection_state.selected_areas = [];\n            // }\n\n            datagrid.model._selection_state.old_selected_areas =\n                datagrid.model._selection_state.selected_areas;\n            datagrid.model._selection_state.selected_areas = [];\n\n            const start = {\n                x0: meta.x,\n                x1: meta.x,\n                y0: meta.y,\n                y1: meta.y,\n            };\n            datagrid.model._selection_state.potential_selection = start;\n            applyMouseAreaSelections(\n                datagrid,\n                table,\n                className,\n                datagrid.model._selection_state.selected_areas.concat([start])\n            );\n\n            return;\n        }\n    }\n\n    datagrid.model._selection_state.selected_areas = [];\n};\n\nconst getMouseoverListener = (datagrid, table, className) => (event) => {\n    if (\n        datagrid.model._edit_mode === \"SELECT_REGION\" ||\n        datagrid.model._edit_mode === \"SELECT_ROW\" ||\n        datagrid.model._edit_mode === \"SELECT_COLUMN\"\n    ) {\n        if (\n            datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES &&\n            datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x !==\n                undefined\n        ) {\n            const meta = table.getMeta(event.target);\n            if (meta && meta.x !== undefined && meta.y !== undefined) {\n                const potentialSelection = {\n                    x0: Math.min(\n                        meta.x,\n                        datagrid.model._selection_state\n                            .CURRENT_MOUSEDOWN_COORDINATES.x\n                    ),\n                    x1: Math.max(\n                        meta.x,\n                        datagrid.model._selection_state\n                            .CURRENT_MOUSEDOWN_COORDINATES.x\n                    ),\n                    y0: Math.min(\n                        meta.y,\n                        datagrid.model._selection_state\n                            .CURRENT_MOUSEDOWN_COORDINATES.y\n                    ),\n                    y1: Math.max(\n                        meta.y,\n                        datagrid.model._selection_state\n                            .CURRENT_MOUSEDOWN_COORDINATES.y\n                    ),\n                };\n\n                datagrid.model._selection_state.potential_selection =\n                    potentialSelection;\n\n                applyMouseAreaSelections(\n                    datagrid,\n                    table,\n                    className,\n                    datagrid.model._selection_state.selected_areas.concat([\n                        potentialSelection,\n                    ])\n                );\n            }\n        }\n    }\n};\n\nconst getMouseupListener = (datagrid, table, className) => (event) => {\n    if (\n        datagrid.model._edit_mode === \"SELECT_REGION\" ||\n        datagrid.model._edit_mode === \"SELECT_ROW\" ||\n        datagrid.model._edit_mode === \"SELECT_COLUMN\"\n    ) {\n        const meta = table.getMeta(event.target);\n        if (datagrid.model._selection_state.old_selected_areas?.length > 0) {\n            const selected =\n                datagrid.model._selection_state.old_selected_areas[0];\n            if (\n                selected.x0 === selected.x1 &&\n                selected.y0 === selected.y1 &&\n                selected.x0 === meta.x &&\n                selected.y0 === meta.y\n            ) {\n                datagrid.model._selection_state.selected_areas = [];\n                datagrid.model._selection_state.old_selected_areas = [];\n                datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES =\n                    {};\n                datagrid.model._selection_state.potential_selection = undefined;\n                applyMouseAreaSelections(datagrid, table, className, []);\n                return;\n            }\n        }\n\n        datagrid.model._selection_state.old_selected_areas = [];\n\n        if (\n            datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES &&\n            datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x !==\n                undefined &&\n            meta.x !== undefined &&\n            meta.y !== undefined\n        ) {\n            const selection = {\n                x0: Math.min(\n                    meta.x,\n                    datagrid.model._selection_state\n                        .CURRENT_MOUSEDOWN_COORDINATES.x\n                ),\n                x1: Math.max(\n                    meta.x,\n                    datagrid.model._selection_state\n                        .CURRENT_MOUSEDOWN_COORDINATES.x\n                ),\n                y0: Math.min(\n                    meta.y,\n                    datagrid.model._selection_state\n                        .CURRENT_MOUSEDOWN_COORDINATES.y\n                ),\n                y1: Math.max(\n                    meta.y,\n                    datagrid.model._selection_state\n                        .CURRENT_MOUSEDOWN_COORDINATES.y\n                ),\n            };\n            datagrid.model._selection_state.selected_areas.push(selection);\n            applyMouseAreaSelections(datagrid, table, className);\n        }\n\n        datagrid.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES = {};\n        datagrid.model._selection_state.potential_selection = undefined;\n    }\n};\n\nfunction set_psp_selection(viewer, datagrid, { x0, x1, y0, y1 }) {\n    const viewport = {};\n    const mode = datagrid.model._edit_mode;\n    if (\n        x0 !== undefined &&\n        [\"SELECT_COLUMN\", \"SELECT_REGION\"].indexOf(mode) > -1\n    ) {\n        viewport.start_col = x0;\n    }\n\n    if (\n        x1 !== undefined &&\n        [\"SELECT_COLUMN\", \"SELECT_REGION\"].indexOf(mode) > -1\n    ) {\n        viewport.end_col = x1 + 1;\n    }\n\n    if (\n        y0 !== undefined &&\n        [\"SELECT_ROW\", \"SELECT_REGION\"].indexOf(mode) > -1\n    ) {\n        viewport.start_row = y0;\n    }\n\n    if (\n        y1 !== undefined &&\n        [\"SELECT_ROW\", \"SELECT_REGION\"].indexOf(mode) > -1\n    ) {\n        viewport.end_row = y1 + 1;\n    }\n\n    viewer.setSelection(viewport);\n}\n\nexport const applyMouseAreaSelections = (\n    datagrid,\n    table,\n    className,\n    selected\n) => {\n    if (\n        datagrid.model._edit_mode === \"SELECT_REGION\" ||\n        datagrid.model._edit_mode === \"SELECT_ROW\" ||\n        datagrid.model._edit_mode === \"SELECT_COLUMN\"\n    ) {\n        selected = datagrid.model._selection_state.selected_areas.slice(0);\n        if (datagrid.model._selection_state.potential_selection) {\n            selected.push(datagrid.model._selection_state.potential_selection);\n        }\n\n        const tds = table.querySelectorAll(\"tbody td\");\n\n        if (selected.length > 0) {\n            set_psp_selection(datagrid.parentElement, datagrid, selected[0]);\n            applyMouseAreaSelection(datagrid, table, selected, className);\n        } else {\n            datagrid.parentElement.setSelection();\n            for (const td of tds) {\n                td.classList.remove(className);\n            }\n        }\n    } else if (datagrid.model._selection_state.dirty) {\n        datagrid.model._selection_state.dirty = false;\n        const tds = table.querySelectorAll(\"tbody td\");\n        for (const td of tds) {\n            td.classList.remove(className);\n        }\n    }\n};\n\nconst applyMouseAreaSelection = (datagrid, table, selected, className) => {\n    if (datagrid.model._edit_mode === \"SELECT_REGION\" && selected.length > 0) {\n        const tds = table.querySelectorAll(\"tbody td\");\n\n        for (const td of tds) {\n            const meta = table.getMeta(td);\n            let rendered = false;\n            for (const { x0, x1, y0, y1 } of selected) {\n                if (\n                    x0 !== undefined &&\n                    y0 !== undefined &&\n                    x1 !== undefined &&\n                    y1 !== undefined\n                ) {\n                    if (\n                        x0 <= meta.x &&\n                        meta.x <= x1 &&\n                        y0 <= meta.y &&\n                        meta.y <= y1\n                    ) {\n                        rendered = true;\n                        datagrid.model._selection_state.dirty = true;\n                        td.classList.add(className);\n                    }\n                }\n            }\n\n            if (!rendered) {\n                td.classList.remove(className);\n            }\n        }\n    } else if (\n        datagrid.model._edit_mode === \"SELECT_ROW\" &&\n        selected.length > 0\n    ) {\n        const tds = table.querySelectorAll(\"tbody td\");\n\n        for (const td of tds) {\n            const meta = table.getMeta(td);\n            let rendered = false;\n            for (const { x0, x1, y0, y1 } of selected) {\n                if (\n                    x0 !== undefined &&\n                    y0 !== undefined &&\n                    x1 !== undefined &&\n                    y1 !== undefined\n                ) {\n                    if (y0 <= meta.y && meta.y <= y1) {\n                        datagrid.model._selection_state.dirty = true;\n                        rendered = true;\n                        td.classList.add(className);\n                    }\n                }\n            }\n\n            if (!rendered) {\n                td.classList.remove(className);\n            }\n        }\n    } else if (\n        datagrid.model._edit_mode === \"SELECT_COLUMN\" &&\n        selected.length > 0\n    ) {\n        const tds = table.querySelectorAll(\"tbody td\");\n\n        for (const td of tds) {\n            const meta = table.getMeta(td);\n            let rendered = false;\n            for (const { x0, x1, y0, y1 } of selected) {\n                if (\n                    x0 !== undefined &&\n                    y0 !== undefined &&\n                    x1 !== undefined &&\n                    y1 !== undefined\n                ) {\n                    if (x0 <= meta.x && meta.x <= x1) {\n                        datagrid.model._selection_state.dirty = true;\n                        rendered = true;\n                        td.classList.add(className);\n                    }\n                }\n            }\n\n            if (!rendered) {\n                td.classList.remove(className);\n            }\n        }\n    }\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport {\n    column_header_style_listener,\n    style_selected_column,\n} from \"../style_handlers/column_header.js\";\nimport { group_header_style_listener } from \"../style_handlers/group_header.js\";\nimport { table_cell_style_listener } from \"../style_handlers/table_cell\";\nimport {\n    click_listener,\n    mousedown_listener,\n} from \"../event_handlers/header_click.js\";\n\nimport { editable_style_listener } from \"../style_handlers/editable.js\";\nimport { focus_style_listener } from \"../style_handlers/focus.js\";\nimport { focusinListener, focusoutListener } from \"../event_handlers/focus.js\";\nimport { keydownListener, clickListener } from \"../event_handlers/click.js\";\n\nimport { selectionListener } from \"../event_handlers/row_select_click\";\nimport { selectionStyleListener } from \"../style_handlers/selection\";\nimport { deselect_all_listener } from \"../event_handlers/deselect_all.js\";\n\nimport { createModel } from \"../model/create.js\";\nimport { dispatch_click_listener } from \"../event_handlers/dispatch_click\";\n\nimport { addAreaMouseSelection } from \"../event_handlers/select_region.js\";\n\n/**\n * Lazy initialize this plugin with various listeners.\n */\nexport async function activate(view) {\n    let viewer = this.parentElement;\n    let table = await viewer.getTable(true);\n\n    if (!this._initialized) {\n        this.innerHTML = \"\";\n        if (this.shadowRoot) {\n            this.shadowRoot.appendChild(this.regular_table);\n        } else {\n            this.appendChild(this.regular_table);\n        }\n\n        this.model = await createModel.call(\n            this,\n            this.regular_table,\n            table,\n            view\n        );\n\n        if (!this.model) {\n            return;\n        }\n\n        addAreaMouseSelection(this, this.regular_table, {\n            className: \"psp-select-region\",\n        });\n\n        this.regular_table.addStyleListener(\n            table_cell_style_listener.bind(\n                this.model,\n                this.regular_table,\n                viewer\n            )\n        );\n\n        this.regular_table.addStyleListener(\n            group_header_style_listener.bind(this.model, this.regular_table)\n        );\n\n        this.regular_table.addStyleListener(\n            column_header_style_listener.bind(\n                this.model,\n                this.regular_table,\n                viewer\n            )\n        );\n\n        // uh ..\n        this.regular_table.addEventListener(\n            \"click\",\n            click_listener.bind(this.model, this.regular_table)\n        );\n\n        // tree collapse, expand, edit button headers\n        this.regular_table.addEventListener(\n            \"mousedown\",\n            mousedown_listener.bind(this.model, this.regular_table, viewer)\n        );\n\n        // (Legacy) Row selection\n        const selected_rows_map = new WeakMap();\n        this.regular_table.addStyleListener(\n            selectionStyleListener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                selected_rows_map\n            )\n        );\n\n        this.regular_table.addEventListener(\n            \"mousedown\",\n            selectionListener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                selected_rows_map\n            )\n        );\n\n        this.regular_table.addEventListener(\n            \"psp-deselect-all\",\n            deselect_all_listener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                selected_rows_map\n            )\n        );\n\n        // User event click\n        this.regular_table.addEventListener(\n            \"click\",\n            dispatch_click_listener.bind(this.model, this.regular_table, viewer)\n        );\n\n        // Editing\n        const selected_position_map = new WeakMap();\n        this.regular_table.addStyleListener(\n            editable_style_listener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                this\n            )\n        );\n        this.regular_table.addStyleListener(\n            focus_style_listener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                selected_position_map\n            )\n        );\n\n        // TODO relies on this.model._is_editable\n        this.regular_table.addEventListener(\n            \"click\",\n            clickListener.bind(this.model, this.regular_table, viewer)\n        );\n\n        this.regular_table.addEventListener(\n            \"focusin\",\n            focusinListener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                selected_position_map\n            )\n        );\n        this.regular_table.addEventListener(\n            \"focusout\",\n            focusoutListener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                selected_position_map\n            )\n        );\n        this.regular_table.addEventListener(\n            \"keydown\",\n            keydownListener.bind(\n                this.model,\n                this.regular_table,\n                viewer,\n                selected_position_map\n            )\n        );\n\n        // viewer event listeners\n        viewer.addEventListener(\n            \"perspective-toggle-column-settings\",\n            (event) => {\n                if (this.isConnected) {\n                    style_selected_column.call(\n                        this.model,\n                        this.regular_table,\n                        viewer,\n                        event.detail.column_name\n                    );\n                    if (!event.detail.open) {\n                        this.model._column_settings_selected_column = null;\n                        return;\n                    }\n\n                    this.model._column_settings_selected_column =\n                        event.detail.column_name;\n                }\n            }\n        );\n\n        this._initialized = true;\n    } else {\n        await createModel.call(\n            this,\n            this.regular_table,\n            table,\n            view,\n            this.model\n        );\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\n/**\n * Restore a saved column width override token.\n *\n * @param {*} token An object previously returned by a call to\n * `_save_column_size_overrides()`\n * @param {*} [cache=false] A flag indicating whether this value should\n * be cached so a future `resetAutoSize()` call does not clear it.\n * @returns\n */\nexport function restore_column_size_overrides(old_sizes, cache = false) {\n    if (!this._initialized) {\n        return;\n    }\n\n    if (cache) {\n        this._cached_column_sizes = old_sizes;\n    }\n\n    const overrides = {};\n    const { group_by, columns } = this.model._config;\n    const tree_header_offset = group_by?.length > 0 ? group_by.length + 1 : 0;\n\n    for (const key of Object.keys(old_sizes)) {\n        if (key === \"__ROW_PATH__\") {\n            overrides[tree_header_offset - 1] = old_sizes[key];\n        } else {\n            const index = this.model._column_paths.indexOf(key);\n            overrides[index + tree_header_offset] = old_sizes[key];\n        }\n    }\n\n    this.regular_table._column_sizes.override = overrides;\n}\n\n/**\n * Extract the current user-overriden column widths from\n * `regular-table`.  This functiond depends on the internal\n * implementation of `regular-table` and may break!\n *\n * @returns An Object-as-dictionary keyed by column_path string, and\n * valued by the column's user-overridden pixel width.\n */\nexport function save_column_size_overrides() {\n    if (!this._initialized) {\n        return [];\n    }\n\n    if (this._cached_column_sizes) {\n        const x = this._cached_column_sizes;\n        this._cached_column_sizes = undefined;\n        return x;\n    }\n\n    const overrides = this.regular_table._column_sizes.override;\n    const { group_by, columns } = this.model._config;\n    const tree_header_offset = group_by?.length > 0 ? group_by.length + 1 : 0;\n\n    const old_sizes = {};\n    for (const key of Object.keys(overrides)) {\n        if (overrides[key] !== undefined) {\n            const index = key - tree_header_offset;\n            if (index > -1) {\n                old_sizes[this.model._column_paths[index]] = overrides[key];\n            } else if (index === -1) {\n                old_sizes[\"__ROW_PATH__\"] = overrides[key];\n            }\n        }\n    }\n\n    return old_sizes;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport const EDIT_MODES = [\n    \"READ_ONLY\",\n    \"EDIT\",\n    \"SELECT_ROW\",\n    \"SELECT_COLUMN\",\n    \"SELECT_REGION\",\n];\n\nexport function toggle_edit_mode(mode = undefined) {\n    if (typeof mode === \"undefined\") {\n        mode =\n            EDIT_MODES[\n                (EDIT_MODES.indexOf(this._edit_mode) + 1) % EDIT_MODES.length\n            ];\n    }\n\n    this.parentElement?.setSelection();\n    this._edit_mode = mode;\n    if (this.model) {\n        this.model._edit_mode = mode;\n        this.model._selection_state = {\n            selected_areas: [],\n            dirty: true,\n        };\n    }\n\n    if (this._edit_button !== undefined) {\n        this._edit_button.dataset.editMode = mode;\n    }\n\n    this.dataset.editMode = mode;\n}\n\nexport function toggle_scroll_lock(force = undefined) {\n    if (typeof force === \"undefined\") {\n        force = !this._is_scroll_lock;\n    }\n\n    this._is_scroll_lock = force;\n    this.classList.toggle(\"sub-cell-scroll-disabled\", force);\n    if (this._scroll_lock !== undefined) {\n        this._scroll_lock.classList.toggle(\"lock-scroll\", force);\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { restore_column_size_overrides } from \"../model/column_overrides.js\";\nimport {\n    EDIT_MODES,\n    toggle_edit_mode,\n    toggle_scroll_lock,\n} from \"../model/toolbar.js\";\nimport { PRIVATE_PLUGIN_SYMBOL } from \"../model\";\nimport { make_color_record } from \"../color_utils.js\";\n\n/**\n * Restore this plugin's state from a previously saved `token`.\n *\n * @param {*} token A token returned from `save()`.\n * @param {import(\"@finos/perspective-viewer\").PerspectiveColumnConfig} columns Viewer column settings\n */\nexport function restore(token, columns) {\n    token = JSON.parse(JSON.stringify(token));\n    columns = JSON.parse(JSON.stringify(columns));\n    const overrides = {};\n\n    if (token.columns) {\n        for (const [col, value] of Object.entries(token.columns)) {\n            if (value.column_size_override !== undefined) {\n                overrides[col] = value.column_size_override;\n                delete value[\"column_size_override\"];\n            }\n        }\n    }\n\n    let styles = {};\n    if (columns) {\n        for (const [col_name, controls] of Object.entries(columns)) {\n            styles[col_name] = {\n                ...controls,\n                pos_fg_color: controls.pos_fg_color\n                    ? make_color_record(controls.pos_fg_color)\n                    : undefined,\n                neg_fg_color: controls.neg_fg_color\n                    ? make_color_record(controls.neg_fg_color)\n                    : undefined,\n                pos_bg_color: controls.pos_bg_color\n                    ? make_color_record(controls.pos_bg_color)\n                    : undefined,\n                neg_bg_color: controls.neg_bg_color\n                    ? make_color_record(controls.neg_bg_color)\n                    : undefined,\n                color: controls.color\n                    ? make_color_record(controls.color)\n                    : undefined,\n            };\n        }\n    }\n\n    // TODO this is going away.\n    if (\"edit_mode\" in token) {\n        if (EDIT_MODES.indexOf(token.edit_mode) !== -1) {\n            toggle_edit_mode.call(this, token.edit_mode);\n        } else {\n            console.error(\"Unknown edit mode \" + token.edit_mode);\n        }\n    }\n\n    if (\"scroll_lock\" in token) {\n        toggle_scroll_lock.call(this, token.scroll_lock);\n    }\n\n    const datagrid = this.regular_table;\n    restore_column_size_overrides.call(this, overrides, true);\n    datagrid[PRIVATE_PLUGIN_SYMBOL] = styles;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { PRIVATE_PLUGIN_SYMBOL } from \"../model\";\nimport { save_column_size_overrides } from \"../model/column_overrides.js\";\n\n/**\n * Serialize the state of this plugin to a token.\n *\n * @returns This plugin's state as a token.\n */\nexport function save() {\n    if (this.regular_table) {\n        const token = {\n            columns: {},\n            scroll_lock: !!this._is_scroll_lock,\n            edit_mode: this._edit_mode,\n        };\n\n        const column_size_overrides = save_column_size_overrides.call(this);\n\n        for (const col of Object.keys(column_size_overrides || {})) {\n            if (!token.columns[col]) {\n                token.columns[col] = {};\n            }\n\n            token.columns[col].column_size_override =\n                column_size_overrides[col];\n        }\n\n        return JSON.parse(JSON.stringify(token));\n    }\n    return {};\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { restore_column_size_overrides } from \"../model/column_overrides.js\";\nimport { save_column_size_overrides } from \"../model/column_overrides.js\";\n\n/**\n * Draw this datagrid instance.\n *\n * @param {perspective.View} view\n * @returns\n */\nexport async function draw(view) {\n    if (this.parentElement) {\n        await this.activate(view);\n    }\n\n    if (!this.isConnected || this.offsetParent == null || !this.model) {\n        return;\n    }\n\n    const old_sizes = save_column_size_overrides.call(this);\n    const draw = this.regular_table.draw({ invalid_columns: true });\n    if (this._reset_scroll_top) {\n        // group_by\n        this.regular_table.scrollTop = 0;\n        this._reset_scroll_top = false;\n    }\n\n    if (this._reset_scroll_left) {\n        // split_by\n        this.regular_table.scrollLeft = 0;\n        this._reset_scroll_left = false;\n    }\n    if (this._reset_select) {\n        // filter, group_by, sort ... if (col-select) { columns, split_by }\n        this.regular_table.dispatchEvent(\n            new CustomEvent(\"psp-deselect-all\", { bubbles: false })\n        );\n        this._reset_select = false;\n    }\n\n    if (this._reset_column_size) {\n        // split_by, group_by (?),\n        this.regular_table._resetAutoSize();\n        this._reset_column_size = false;\n    }\n\n    restore_column_size_overrides.call(this, old_sizes);\n    await draw;\n\n    this._toolbar.classList.toggle(\n        \"aggregated\",\n        this.model._config.group_by.length > 0 ||\n            this.model._config.split_by.length > 0\n    );\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\n/**\n * @param {import(\"@finos/perspective\").Type} type\n * @param {string} _group\n * @returns {import(\"@finos/perspective-viewer\").PerspectiveColumnConfigValue}\n */\nexport default function column_style_opts(type, _group) {\n    if (type === \"integer\" || type === \"float\")\n        return {\n            datagrid_number_style: {\n                fg_gradient: 0,\n                pos_fg_color: this.model._pos_fg_color[0],\n                neg_fg_color: this.model._neg_fg_color[0],\n                number_fg_mode: \"color\",\n                bg_gradient: 0,\n                pos_bg_color: this.model._pos_bg_color[0],\n                neg_bg_color: this.model._neg_bg_color[0],\n                number_bg_mode: \"disabled\",\n            },\n            number_string_format: true,\n        };\n    else if (type === \"date\" || type === \"datetime\" || type === \"string\") {\n        let control =\n            type === \"date\" || type === \"datetime\"\n                ? \"datagrid_datetime_style\"\n                : `datagrid_string_style`;\n        return {\n            [control]: {\n                color: this.model._color[0],\n                bg_color: this.model._color[0],\n            },\n        };\n    } else {\n        return null;\n    }\n}\n", "regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}regular-table td.psp-null:after,regular-table th.psp-null:after{content:var(--null--content,\"-\");}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}.psp-header-sort-abs-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-desc-icon--mask-image);mask-image:var(--sort-abs-desc-icon--mask-image);}.psp-header-sort-abs-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-asc-icon--mask-image);mask-image:var(--sort-abs-asc-icon--mask-image);}.psp-header-sort-abs-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-col-desc-icon--mask-image);mask-image:var(--sort-abs-col-desc-icon--mask-image);}.psp-header-sort-abs-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:\"\";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:11px;margin-left:4px;-webkit-mask-image:var(--sort-abs-col-asc-icon--mask-image);mask-image:var(--sort-abs-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,\"+\");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,\"-\");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table table td.psp-select-region,regular-table table th.psp-select-region{background-color:var(--icon--color)!important;color:var(--plugin--background)!important;border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-select-region.psp-menu-open{box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,\"Edit\");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:\" \";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:\" \";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { PRIVATE_PLUGIN_SYMBOL } from \"../model\";\nimport { activate } from \"../plugin/activate.js\";\nimport { restore } from \"../plugin/restore.js\";\nimport { save } from \"../plugin/save\";\nimport { draw } from \"../plugin/draw\";\nimport column_style_controls from \"../plugin/column_style_controls.js\";\nimport datagridStyles from \"../../../dist/css/perspective-viewer-datagrid.css\";\nimport { format_raw } from \"../data_listener/format_cell.js\";\n\n/**\n * The custom element class for this plugin.  The interface methods for this\n */\nexport class HTMLPerspectiveViewerDatagridPluginElement extends HTMLElement {\n    static #global_stylesheet_installed = false;\n\n    static #sheet;\n\n    // Determines whether this datagrid renders in the light DOM. This will\n    // break style encapsulation and may cause inconsistent behavior.\n    static renderTarget =\n        window.CSS?.supports &&\n        window.CSS?.supports(\"selector(:host-context(foo))\")\n            ? \"shadow\"\n            : \"light\";\n\n    constructor() {\n        super();\n        this.regular_table = document.createElement(\"regular-table\");\n        this.regular_table.part = \"regular-table\";\n        this._is_scroll_lock = false;\n        this._edit_mode = \"READ_ONLY\";\n        const Elem = HTMLPerspectiveViewerDatagridPluginElement;\n        if (!Elem.#sheet) {\n            Elem.#sheet = new CSSStyleSheet();\n            Elem.#sheet.replaceSync(datagridStyles);\n        }\n\n        if (Elem.renderTarget === \"shadow\") {\n            const shadow = this.attachShadow({ mode: \"open\" });\n            shadow.adoptedStyleSheets.push(Elem.#sheet);\n        } else if (\n            Elem.renderTarget === \"light\" &&\n            !Elem.#global_stylesheet_installed\n        ) {\n            Elem.#global_stylesheet_installed = true;\n            document.adoptedStyleSheets.push(Elem.#sheet);\n        }\n    }\n\n    connectedCallback() {\n        if (!this._toolbar) {\n            this._toolbar = document.createElement(\n                \"perspective-viewer-datagrid-toolbar\"\n            );\n        }\n\n        const parent = this.parentElement;\n        if (parent) {\n            parent.appendChild(this._toolbar);\n        }\n    }\n\n    disconnectedCallback() {\n        this._toolbar?.parentElement?.removeChild?.(this._toolbar);\n    }\n\n    async activate(view) {\n        return await activate.call(this, view);\n    }\n\n    get name() {\n        return \"Datagrid\";\n    }\n\n    get category() {\n        return \"Basic\";\n    }\n\n    get select_mode() {\n        return \"toggle\";\n    }\n\n    get min_config_columns() {\n        return undefined;\n    }\n\n    get config_column_names() {\n        return [\"Columns\"];\n    }\n\n    /**\n     * Give the Datagrid a higher priority so it is loaded\n     * over the default charts by default.\n     */\n    get priority() {\n        return 1;\n    }\n\n    can_render_column_styles(type, _group) {\n        return type !== \"boolean\";\n    }\n\n    column_style_controls(type, group) {\n        return column_style_controls.call(this, type, group);\n    }\n\n    async draw(view) {\n        return await draw.call(this, view);\n    }\n\n    async update(view) {\n        if (this.model === undefined) {\n            await this.draw(view);\n        } else if (this.model._config.split_by?.length > 0) {\n            const dimensions = await view.dimensions();\n            this.model._num_rows = dimensions.num_view_rows;\n            // if (this.model._column_paths.length !== dimensions.num_view_columns) {\n            // await this.draw(view);\n            // } else {\n            await this.regular_table.draw();\n            // }\n        } else {\n            this.model._num_rows = await view.num_rows();\n            await this.regular_table.draw();\n        }\n    }\n\n    async render(viewport) {\n        const view = await this.parentElement.getView();\n        const json = await view.to_columns(viewport);\n        const cols = await view\n            .column_paths()\n            .then((x) => x.slice(viewport.start_col, viewport.end_col));\n\n        const nrows = viewport.end_row - viewport.start_row;\n        let out = \"\";\n        for (let ridx = 0; ridx < nrows; ridx++) {\n            for (const col_name of cols) {\n                const col = json[col_name];\n                const type = this.model._schema[col_name];\n                const formatter = format_raw(\n                    type,\n                    this.regular_table[PRIVATE_PLUGIN_SYMBOL][\n                        col_name.split(\"|\").at(-1)\n                    ] || {}\n                );\n\n                if (formatter) {\n                    out += formatter.format(col[ridx]) + \"\\t\";\n                } else {\n                    out += col[ridx] + \"\\t\";\n                }\n            }\n            out += \"\\n\";\n        }\n\n        return out.trim();\n    }\n\n    async resize() {\n        if (!this.isConnected || this.offsetParent == null) {\n            return;\n        }\n\n        if (this._initialized) {\n            await this.regular_table.draw();\n        }\n    }\n\n    async clear() {\n        this.regular_table._resetAutoSize();\n        this.regular_table.clear();\n    }\n\n    save() {\n        return save.call(this);\n    }\n\n    restore(token, columns_config) {\n        return restore.call(this, token, columns_config);\n    }\n\n    async restyle(view) {\n        await this.draw(view);\n    }\n\n    delete() {\n        this._toolbar = undefined;\n        if (this.regular_table.table_model) {\n            this.regular_table._resetAutoSize();\n        }\n\n        this.regular_table.clear();\n    }\n}\n", ":host{position:relative;display:block;height:100%;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:stretch;height:100%;}:host #toolbar .hover-target{margin:0;display:inline-flex;align-items:center;cursor:pointer;}:host #toolbar .hover-target:hover{box-shadow:-4px 0 0 var(--icon--color),4px 0 0 var(--icon--color);background-color:var(--icon--color);}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:\"highlight_alt\";}#edit_mode:before{-webkit-mask-image:\"\";}#edit_mode[data-edit-mode=\"READ_ONLY\"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode=\"EDIT\"]:before{-webkit-mask-image:var(--toolbar-edit-mode--edit--content);}:host(.aggregated) #toolbar #edit_mode[data-edit-mode=\"EDIT\"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode=\"SELECT_ROW\"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-row--content);}#edit_mode[data-edit-mode=\"SELECT_COLUMN\"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-column--content);}#edit_mode[data-edit-mode=\"SELECT_REGION\"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-region--content);}#edit_mode[data-edit-mode=\"READ_ONLY\"] span:before{content:var(--edit-mode--read-only--content,\"Read Only\");}#edit_mode[data-edit-mode=\"EDIT\"] span:before{content:var(--edit-mode--edit--content,\"Editable\");}#edit_mode[data-edit-mode=\"SELECT_ROW\"] span:before{content:var(--edit-mode--select-row--content,\"Row Select\");}#edit_mode[data-edit-mode=\"SELECT_COLUMN\"] span:before{content:var(--edit-mode--select-column--content,\"Column Select\");}#edit_mode[data-edit-mode=\"SELECT_REGION\"] span:before{content:var(--edit-mode--select-region--content,\"Region Select\");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,\"Free Scroll\");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,\"Align Scroll\");}.button:before{width:21px;height:21px;content:\"\";-webkit-mask-size:cover;mask-size:cover;background-color:var(--icon--color);}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;justify-content:center;align-items:center;user-select:none;padding:0 5px;border:1px solid transparent;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.hover-target:focus-within .button,.hover-target:hover .button{position:relative;background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;}.hover-target:focus-within .button:before,.hover-target:hover .button:before{background-color:var(--plugin--background);}.hover-target:focus-within .button>span,.hover-target:hover .button>span{display:block;position:absolute;top:calc(100% + 3px);left:50%;translate:-50%;margin:0;padding:5px;height:auto;white-space:pre-wrap;line-height:1;font-size:9px;background-color:var(--icon--color);width:35px;text-align:center;border-radius:0 0 3px 3px;}", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport TOOLBAR_STYLE from \"../../../dist/css/perspective-viewer-datagrid-toolbar.css\";\nimport { toggle_edit_mode, toggle_scroll_lock } from \"../model/toolbar\";\n\nconst stylesheet = new CSSStyleSheet();\nstylesheet.replaceSync(TOOLBAR_STYLE);\n\n/**\n * The custom element for this plugin's toolbar, a component which displays in\n * the host `<perspective-viewer>`'s status bar when this plugin is active.\n * In the case of Datagrid, this comprises \"Editable\" and \"Scroll Lock\" toggle\n * buttons.\n */\nexport class HTMLPerspectiveViewerDatagridToolbarElement extends HTMLElement {\n    connectedCallback() {\n        if (this._initialized) {\n            return;\n        }\n\n        this._initialized = true;\n        this.setAttribute(\"slot\", \"plugin-settings\");\n        this.attachShadow({ mode: \"open\" });\n        this.shadowRoot.adoptedStyleSheets.push(stylesheet);\n        this.shadowRoot.innerHTML = `\n            <div id=\"toolbar\">\n                <span class=\"hover-target\">\n                    <span id=\"scroll_lock\" class=\"button\">\n                        <span></span>\n                    </span>\n                </span>\n                <span class=\"hover-target\">\n                    <span id=\"edit_mode\" class=\"button\" data-edit-mode=\"READ_ONLY\">\n                        <span></span>\n                    </span>\n                </span>\n            </div>\n        `;\n\n        const viewer = this.parentElement;\n        const plugin = viewer.querySelector(\"perspective-viewer-datagrid\");\n        plugin._scroll_lock = this.shadowRoot.querySelector(\"#scroll_lock\");\n        plugin._scroll_lock.addEventListener(\"click\", () =>\n            toggle_scroll_lock.call(plugin)\n        );\n\n        plugin._edit_button = this.shadowRoot.querySelector(\"#edit_mode\");\n        plugin._edit_button.addEventListener(\"click\", () => {\n            toggle_edit_mode.call(plugin);\n            plugin.regular_table.draw();\n            viewer.dispatchEvent(new Event(\"perspective-config-update\"));\n        });\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport \"regular-table\";\n\nimport { HTMLPerspectiveViewerDatagridPluginElement } from \"./custom_elements/datagrid.js\";\nimport { HTMLPerspectiveViewerDatagridToolbarElement } from \"./custom_elements/toolbar.js\";\n\n/******************************************************************************\n *\n * Main\n *\n */\n\nasync function _register_element() {\n    customElements.define(\n        \"perspective-viewer-datagrid-toolbar\",\n        HTMLPerspectiveViewerDatagridToolbarElement\n    );\n\n    customElements.define(\n        \"perspective-viewer-datagrid\",\n        HTMLPerspectiveViewerDatagridPluginElement\n    );\n\n    await customElements.whenDefined(\"perspective-viewer\");\n    customElements\n        .get(\"perspective-viewer\")\n        .registerPlugin(\"perspective-viewer-datagrid\");\n}\n\n_register_element();\n"],
  "mappings": "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",
  "names": ["require_chroma", "__commonJSMin", "exports", "module", "Color", "DEG2RAD", "LAB_CONSTANTS", "PI", "PITHIRD", "RAD2DEG", "TWOPI", "_average_lrgb", "_guess_formats", "_guess_formats_sorted", "_input", "_interpolators", "abs", "atan2", "bezier", "blend", "blend_f", "brewer", "burn", "chroma", "clip_rgb", "cmyk2rgb", "colors", "cos", "css2rgb", "darken", "dodge", "each", "floor", "hcg2rgb", "hex2rgb", "hsi2rgb", "hsl2css", "hsl2rgb", "hsv2rgb", "interpolate", "interpolate_hsx", "interpolate_lab", "interpolate_lrgb", "interpolate_num", "interpolate_rgb", "lab2lch", "lab2rgb", "lab_xyz", "lch2lab", "lch2rgb", "lighten", "limit", "log", "luminance_x", "m", "max", "multiply", "normal", "num2rgb", "overlay", "pow", "rgb2cmyk", "rgb2css", "rgb2hcg", "rgb2hex", "rgb2hsi", "rgb2hsl", "rgb2hsv", "rgb2lab", "rgb2lch", "rgb2luminance", "rgb2num", "rgb2temperature", "rgb2xyz", "rgb_xyz", "rnd", "root", "round", "screen", "sin", "sqrt", "temperature2rgb", "type", "unpack", "w3cx11", "xyz_lab", "xyz_rgb", "slice", "classToType", "len", "name", "o", "ref", "obj", "strType", "x", "min", "args", "rgb", "func", "ctor", "child", "result", "arg", "chk", "len1", "me", "mode", "w", "a", "b", "key", "results", "g", "l", "r", "y", "z", "t", "ref1", "I", "I0", "I1", "lab0", "lab1", "lab2", "lab3", "ref2", "i", "lab", "f", "start", "rotations", "hue", "gamma", "lightness", "dh", "dl", "fract", "amp", "cos_a", "h", "sin_a", "s", "code", "digits", "col1", "col2", "interpol", "res", "k", "v", "n", "xyz0", "xyz1", "col", "xyz", "A", "alpha", "cnt", "dx", "dy", "first", "xyz2", "c", "hex", "u", "channels", "hxa", "str", "t1", "t2", "t3", "p", "q", "ref3", "ref4", "ref5", "delta", "num", "_c", "_g", "css", "aa", "ab", "hsl", "rgba", "L", "lum", "cur_lum", "eps", "max_iter", "test", "lm", "kelvin", "temp", "maxTemp", "minTemp", "l1", "l2", "d", "sum_sq", "C", "L1", "L2", "a1", "a2", "b1", "b2", "c1", "c2", "c4", "dH2", "delA", "delB", "delC", "delL", "h1", "sc", "sh", "sl", "v1", "v2", "v3", "modechan", "channel", "src", "value", "amount", "lch", "bottom", "top", "c0", "out", "data", "val", "positions", "_classes", "_colorCache", "_colors", "_correctLightness", "_domain", "_fixed", "_gamma", "_max", "_min", "_mode", "_nacol", "_out", "_padding", "_pos", "_spread", "_useCache", "classifyValue", "getClass", "getColor", "resetCache", "setColors", "tmap", "maxc", "minc", "bypassMap", "classes", "domain", "_m", "_o", "L0", "L_actual", "L_diff", "L_ideal", "pol", "t0", "numColors", "dd", "dm", "samples", "filter", "add", "visit", "ac", "ad", "ae", "af", "ag", "ah", "ai", "aj", "ak", "al", "am", "assignments", "best", "centroids", "cluster", "clusterSizes", "dist", "j", "kClusters", "limits", "max_log", "min_log", "mindist", "nb_iters", "newCentroids", "pb", "pr", "ref10", "ref11", "ref12", "ref13", "ref14", "ref6", "ref7", "ref8", "ref9", "repeat", "sum", "tmpKMeansBreaks", "values", "hue0", "hue1", "lbv", "lbv0", "lbv1", "sat", "sat0", "sat1", "n1", "n2", "METADATA_MAP", "DEBUG", "isFirefox", "BROWSER_MAX_HEIGHT", "AVG", "TOTAL", "START", "get_draw_fps", "now", "elapsed", "avg", "real_fps", "virtual_fps", "num_frames", "log_perf", "x", "html", "strings", "args", "str", "i", "a", "invertPromise", "_resolve", "promise", "resolve", "TAGS", "flush_tag", "tag", "throttle_tag", "f", "l", "container_default", "sub_cell_offsets_default", "RegularVirtualTableViewModel", "slot", "style", "virtual_panel", "table_clip", "nrows", "num_columns", "start_row", "end_row", "start_col", "end_col", "height", "row_height", "header_levels", "total_scroll_height", "percent_scroll", "clip_panel_row_height", "scroll_index_offset", "offset_width", "diff", "new_val", "vis_cols", "width", "w", "max_scroll_column", "invalid_column", "invalid_row", "cidx", "virtual_width", "viewport_width", "y", "invalid", "panel_width", "header_height", "virtual_panel_px_size", "options", "internal_draw", "viewport", "y_offset", "x_offset", "__debug_start_time__", "invalid_viewport", "preserve_width", "num_rows", "num_row_headers", "num_column_headers", "autosize_cells", "needs_sub_cell_update", "last_cells", "callbacks", "callback", "IOS_DISABLE_OVERSCROLL", "RegularViewEventModel", "event", "clientWidth", "clientHeight", "scrollTop", "scrollLeft", "total_scroll_width", "element", "is_resize", "metadata", "row", "td", "_virtual_x", "size_key", "start", "header_x", "header_element", "move", "up", "override_width", "should_redraw", "th", "virtual_x", "auto_width", "ElemFactory", "name", "elem", "ViewModel", "column_sizes", "container", "table", "ridx", "tr", "row_container", "new_td", "idx", "RegularHeaderViewModel", "offset_cache", "d", "column", "span", "resizeSpan", "column_name", "alias", "parts", "colspan", "x0", "column_header_merge_depth", "merge_headers", "output", "group_meta", "RegularBodyViewModel", "tagName", "val", "ridx_offset", "container_height", "column_state", "view_state", "column_data", "row_headers", "column_data_listener_metadata", "tds", "cidx_offset", "id", "obj", "row_header", "prev_row", "prev_row_metadata", "prev_col", "prev_col_metadata", "RegularTableViewModel", "thead", "tbody", "override_row_height", "cell", "box", "is_override", "container_size", "view_cache", "selected_id", "container_width", "view", "config", "data", "column_headers", "data_listener_metadata", "merge_row_headers", "merge_column_headers", "x1", "y1", "max", "sub_cell_offset", "cont_body", "first_col", "cont_heads", "header", "total", "hmetadata", "dcidx", "num_visible_columns", "missing_cidx", "end_col_offset", "size_extension", "estimate", "new_col_req", "new_col", "cont_head", "last_measured_col_width", "VIRTUAL_MODES", "RegularTableElement", "styleListener", "isSubscribed", "index", "start_len", "viewport_row_height", "row_height_offset", "real_row_height", "scroll_left", "dataListener", "virtual_mode", "preserve_state", "virtual_mode_changed", "PRIVATE_PLUGIN_SYMBOL", "get_psp_type", "metadata", "style_selected_column", "regularTable", "viewer", "selectedColumn", "group_header_trs", "len", "settings_open", "tr", "i", "offset", "id", "titles", "editBtns", "th", "title", "editBtn", "open", "r", "meta", "column_header_style_listener", "col_headers", "style_column_header_row", "style_menu_headers", "is_menu_row", "header_depth", "td", "column_name", "sort", "x", "needs_border", "is_corner", "type", "is_numeric", "is_string", "is_date", "is_datetime", "group_header_style_listener", "regularTable", "header_depth", "group_header_trs", "m", "marked", "table", "y", "row", "tops", "x", "td", "metadata", "needs_border", "cell", "xx", "tx", "ty", "style_cell_flash", "metadata", "td", "pos_s", "pos_e", "neg_s", "neg_e", "is_settings_open", "id", "metadata_path", "row_idx", "col_idx", "import_chroma_js", "blend", "a", "b", "chroma", "rgbaToRgb", "r", "g", "source", "f", "i", "c", "infer_foreground_from_background", "make_gradient", "chromahex", "r1", "g1", "b1", "r2", "g2", "b2", "make_color_record", "color", "chroma_neg", "_neg_grad", "rgb", "cell_style_numeric", "plugin", "td", "metadata", "is_settings_open", "is_positive", "is_negative", "pos_bg_color", "neg_bg_color", "bg_tuple", "hex", "r", "g", "b", "_gradhex", "a", "source", "foreground", "infer_foreground_from_background", "rgbaToRgb", "style_cell_flash", "gradhex", "import_chroma_js", "cell_style_string", "plugin", "td", "metadata", "column_name", "hex", "r", "g", "b", "gradhex", "source", "foreground", "infer_foreground_from_background", "rgbaToRgb", "series_map", "seed", "color_seed", "h", "s", "l", "chroma", "color2", "hex2", "import_chroma_js", "cell_style_datetime", "plugin", "td", "metadata", "column_name", "hex", "r", "g", "b", "gradhex", "source", "foreground", "infer_foreground_from_background", "rgbaToRgb", "cell_style_boolean", "plugin", "td", "metadata", "hex", "cell_style_row_header", "regularTable", "td", "metadata", "is_not_empty", "is_leaf", "next", "is_collapse", "get_psp_type", "metadata", "table_cell_style_listener", "regularTable", "viewer", "plugins", "PRIVATE_PLUGIN_SYMBOL", "is_settings_open", "tr", "td", "column_name", "type", "plugin", "is_numeric", "x", "cell_style_numeric", "cell_style_boolean", "cell_style_string", "cell_style_datetime", "is_th", "cell_style_row_header", "sortHandler", "regularTable", "viewer", "event", "target", "column_name", "sort_method", "append_sort", "override_sort", "abs", "sort", "found", "sort_term", "_column_name", "_sort_dir", "term", "create_sort", "sort_dir", "order", "ROW_COL_SORT_ORDER", "ROW_SORT_ORDER", "inc_sort_dir", "expandCollapseHandler", "regularTable", "event", "meta", "is_collapse", "x", "mousedown_listener", "regularTable", "viewer", "event", "target", "expandCollapseHandler", "column_name", "sortHandler", "click_listener", "isEditable", "viewer", "allowed", "has_pivots", "selectable", "editable", "editable_style_listener", "table", "datagrid", "plugins", "PRIVATE_PLUGIN_SYMBOL", "edit", "td", "meta", "type", "col_name", "focus_style_listener", "table", "_viewer", "selected_position_map", "tds", "selected_position", "host", "td", "meta", "write_cell", "table", "model", "active_cell", "meta", "type", "text", "id", "msg", "clickListener", "_viewer", "event", "is_editable2", "is_bool", "is_null", "lock", "body", "args", "resolve", "x", "getPos", "_range", "range", "moveSelection", "table", "selected_position_map", "active_cell", "dx", "dy", "meta", "num_columns", "num_rows", "selected_position", "xmin", "xmax", "ymin", "ymax", "y", "focus_style_listener", "isLastCell", "model", "target", "keydownListener", "viewer", "event", "is_editable", "viewer", "allowed", "has_pivots", "selectable", "editable", "keydownListener", "table", "selected_position_map", "event", "clickListener", "focusoutListener", "table", "viewer", "selected_position_map", "event", "is_editable", "selectedPosition", "write_cell", "focusinListener", "_viewer", "meta", "new_state", "getCellConfig", "_view", "_config", "row_idx", "col_idx", "group_by", "split_by", "start_row", "end_row", "r", "group_by_values", "x", "row_filters", "pivot", "index", "pivot_value", "column_index", "column_paths", "result", "column_filters", "split_by_values", "value", "filter", "selectionListener", "regularTable", "viewer", "selected_rows_map", "event", "meta", "id", "selected", "key_match", "agg", "x", "i", "is_deselect", "detail", "row", "column_names", "config", "getCellConfig", "selectionStyleListener", "regularTable", "viewer", "selected_rows_map", "has_selected", "selected", "td", "meta", "id", "key_match", "agg", "x", "i", "th", "deselect_all_listener", "regularTable", "_viewer", "selected_rows_map", "td", "import_chroma_js", "FORMATTER_CONS", "val", "LEGACY_CONFIG", "FormatterCache", "type", "plugin", "type_config", "options", "format", "formatter_key", "FORMAT_CACHE", "FormatterCache", "MAX_BAR_WIDTH_PCT", "format_raw", "type", "value", "format_cell", "title", "val", "plugins", "use_table_schema", "plugin", "a", "div", "anchor", "pct", "formatter", "format_tree_header_row_path", "paths", "row_headers", "regularTable", "plugins", "PRIVATE_PLUGIN_SYMBOL", "path", "last", "formatted", "format_cell", "format_tree_header", "new_path", "idx", "createDataListener", "viewer", "last_meta", "last_column_paths", "last_ids", "last_reverse_ids", "last_reverse_columns", "regularTable", "x0", "y0", "x1", "y1", "columns", "new_window", "x", "y", "new_col_paths", "old_length", "a", "b", "i", "column", "_", "index", "acc", "data", "metadata", "column_headers", "column_paths", "is_settings_open", "ipath", "path", "path_parts", "agg_depth", "PRIVATE_PLUGIN_SYMBOL", "format_cell", "is_row_path", "row_headers", "format_tree_header_row_path", "format_tree_header", "num_row_headers", "get_rule", "regular", "tag", "def", "color", "ElemFactory", "name", "elem", "get_psp_type", "metadata", "createModel", "table", "view", "extend", "config", "old", "group_by_changed", "type_changed", "lvl", "split_by_changed", "columns_changed", "filter_changed", "i", "sort_changed", "table_schema", "num_rows", "schema", "expression_schema", "column_paths", "_edit_port", "_plugin_background", "chroma", "_pos_fg_color", "make_color_record", "_neg_fg_color", "_pos_bg_color", "blend", "_neg_bg_color", "_color", "_schema", "_table_schema", "_column_paths", "path", "_is_editable", "_column_types", "column_path", "column", "_edit_mode", "model", "createDataListener", "dispatch_click_listener", "table", "viewer", "event", "meta", "x", "y", "row", "column_names", "config", "getCellConfig", "MOUSE_SELECTED_AREA_CLASS", "addAreaMouseSelection", "datagrid", "table", "className", "selected", "getMousedownListener", "getMouseoverListener", "getMouseupListener", "applyMouseAreaSelections", "event", "meta", "start", "potentialSelection", "selection", "set_psp_selection", "viewer", "x0", "x1", "y0", "y1", "viewport", "mode", "tds", "applyMouseAreaSelection", "td", "rendered", "activate", "view", "viewer", "table", "createModel", "addAreaMouseSelection", "table_cell_style_listener", "group_header_style_listener", "column_header_style_listener", "click_listener", "mousedown_listener", "selected_rows_map", "selectionStyleListener", "selectionListener", "deselect_all_listener", "dispatch_click_listener", "selected_position_map", "editable_style_listener", "focus_style_listener", "clickListener", "focusinListener", "focusoutListener", "keydownListener", "event", "style_selected_column", "restore_column_size_overrides", "old_sizes", "cache", "overrides", "group_by", "columns", "tree_header_offset", "key", "index", "save_column_size_overrides", "x", "EDIT_MODES", "toggle_edit_mode", "mode", "toggle_scroll_lock", "force", "restore", "token", "columns", "overrides", "col", "value", "styles", "col_name", "controls", "make_color_record", "EDIT_MODES", "toggle_edit_mode", "toggle_scroll_lock", "datagrid", "restore_column_size_overrides", "PRIVATE_PLUGIN_SYMBOL", "save", "token", "column_size_overrides", "save_column_size_overrides", "col", "draw", "view", "old_sizes", "save_column_size_overrides", "restore_column_size_overrides", "column_style_opts", "type", "_group", "perspective_viewer_datagrid_default", "HTMLPerspectiveViewerDatagridPluginElement", "_HTMLPerspectiveViewerDatagridPluginElement", "#global_stylesheet_installed", "#sheet", "Elem", "perspective_viewer_datagrid_default", "parent", "view", "activate", "type", "_group", "group", "column_style_opts", "draw", "dimensions", "viewport", "json", "cols", "x", "nrows", "out", "ridx", "col_name", "col", "formatter", "format_raw", "PRIVATE_PLUGIN_SYMBOL", "save", "token", "columns_config", "restore", "perspective_viewer_datagrid_toolbar_default", "stylesheet", "perspective_viewer_datagrid_toolbar_default", "HTMLPerspectiveViewerDatagridToolbarElement", "viewer", "plugin", "toggle_scroll_lock", "toggle_edit_mode", "_register_element", "HTMLPerspectiveViewerDatagridToolbarElement", "HTMLPerspectiveViewerDatagridPluginElement"]
}
